
<!DOCTYPE html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="Documentation for the Nakama realtime and social server for games and apps.">
      
      
        <link rel="canonical" href="https://heroiclabs.com/storage-collections/">
      
      
        <meta name="author" content="Heroic Labs Team & contributors">
      
      
        <link rel="shortcut icon" href="../images/favicon.ico">
      
      <meta name="generator" content="mkdocs-0.16.3, mkdocs-material-1.7.4">
    
    
      
        <title>Collections - Nakama server</title>
      
    
    
      <script src="../assets/javascripts/modernizr-1df76c4e58.js"></script>
    
    
      <link rel="stylesheet" href="../assets/stylesheets/application-769c285a91.css">
      
        <link rel="stylesheet" href="../assets/stylesheets/application-02c2a4388f.palette.css">
      
    
    
      
        
        
        
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
      <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    
    
    
  </head>
  
  
  
  
    <body data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="drawer">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="search">
    <label class="md-overlay" data-md-component="overlay" for="drawer"></label>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <a href="https://heroiclabs.com/" title="Nakama server" class="md-logo md-header-nav__button">
            <img src="../images/logo-white.svg" width="24" height="24">
          </a>
        
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <span class="md-flex__ellipsis md-header-nav__title">
          
            
              
                <span class="md-header-nav__parent">
                  Storage Engine
                </span>
              
            
            Collections
          
        </span>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="search"></label>
          
<div class="md-search" data-md-component="search">
  <label class="md-search__overlay" for="search"></label>
  <div class="md-search__inner">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" required placeholder="Search" accesskey="s" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query">
      <label class="md-icon md-search__icon" for="search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset">close</button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result" data-md-lang-search="">
          <div class="md-search-result__meta" data-md-lang-result-none="No matching documents" data-md-lang-result-one="1 matching document" data-md-lang-result-other="# matching documents">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  


  <a href="https://github.com/heroiclabs/nakama" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      heroiclabs/nakama
    </div>
  </a>

          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="drawer">
    
      <i class="md-logo md-nav__button">
        <img src="../images/logo-white.svg">
      </i>
    
    Nakama server
  </label>
  
    <div class="md-nav__source">
      


  


  <a href="https://github.com/heroiclabs/nakama" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      heroiclabs/nakama
    </div>
  </a>

    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../nakama-download/" title="Download" class="md-nav__link">
      Download
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      Install and setup
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        Install and setup
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../install-docker-quickstart/" title="Docker quickstart" class="md-nav__link">
      Docker quickstart
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../install-binary/" title="Binary install" class="md-nav__link">
      Binary install
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../install-configuration/" title="Configuration" class="md-nav__link">
      Configuration
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../install-server-cli/" title="Nakama CLI" class="md-nav__link">
      Nakama CLI
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../install-nakama-upgrade/" title="Upgrades" class="md-nav__link">
      Upgrades
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../unity-client-guide/" title="Unity client guide" class="md-nav__link">
      Unity client guide
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../android-java-client-guide/" title="Android client guide" class="md-nav__link">
      Android client guide
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../javascript-client-guide/" title="JavaScript client guide" class="md-nav__link">
      JavaScript client guide
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../swift-ios-client-guide/" title="Swift/iOS client guide" class="md-nav__link">
      Swift/iOS client guide
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../authentication/" title="Authentication" class="md-nav__link">
      Authentication
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../user-accounts/" title="User accounts" class="md-nav__link">
      User accounts
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-10" type="checkbox" id="nav-10" checked>
    
    <label class="md-nav__link" for="nav-10">
      Storage Engine
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-10">
        Storage Engine
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="toc">
        Collections
      </label>
    
    <a href="./" title="Collections" class="md-nav__link md-nav__link--active">
      Collections
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#write-records" title="Write records" class="md-nav__link">
    Write records
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#conditional-writes" title="Conditional writes" class="md-nav__link">
    Conditional writes
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fetch-records" title="Fetch records" class="md-nav__link">
    Fetch records
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#list-records" title="List records" class="md-nav__link">
    List records
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#update-records" title="Update records" class="md-nav__link">
    Update records
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#operations" title="Operations" class="md-nav__link">
    Operations
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#paths" title="Paths" class="md-nav__link">
    Paths
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#remove-records" title="Remove records" class="md-nav__link">
    Remove records
  </a>
  
</li>
      
      
      
    </ul>
  
</nav>
    
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-11" type="checkbox" id="nav-11">
    
    <label class="md-nav__link" for="nav-11">
      Social
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-11">
        Social
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../social-friends/" title="Friends" class="md-nav__link">
      Friends
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../social-groups-clans/" title="Groups and Clans" class="md-nav__link">
      Groups and Clans
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../social-in-app-notifications/" title="In-app Notifications" class="md-nav__link">
      In-app Notifications
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../social-realtime-chat/" title="Realtime Chat" class="md-nav__link">
      Realtime Chat
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-12" type="checkbox" id="nav-12">
    
    <label class="md-nav__link" for="nav-12">
      Gameplay
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-12">
        Gameplay
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../gameplay-leaderboards/" title="Leaderboards" class="md-nav__link">
      Leaderboards
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../gameplay-matchmaker/" title="Matchmaker" class="md-nav__link">
      Matchmaker
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../gameplay-multiplayer-realtime/" title="Realtime Multiplayer" class="md-nav__link">
      Realtime Multiplayer
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../in-app-purchase-validation/" title="In-app Purchase Validation" class="md-nav__link">
      In-app Purchase Validation
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-14" type="checkbox" id="nav-14">
    
    <label class="md-nav__link" for="nav-14">
      Runtime Code
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-14">
        Runtime Code
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../runtime-code-basics/" title="Basics" class="md-nav__link">
      Basics
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../runtime-code-function-reference/" title="Function Reference" class="md-nav__link">
      Function Reference
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../benchmarks/" title="Benchmarks" class="md-nav__link">
      Benchmarks
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-16" type="checkbox" id="nav-16">
    
    <label class="md-nav__link" for="nav-16">
      Deployment
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-16">
        Deployment
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../deployment-digital-ocean/" title="Digital Ocean" class="md-nav__link">
      Digital Ocean
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-17" type="checkbox" id="nav-17">
    
    <label class="md-nav__link" for="nav-17">
      Tutorials
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-17">
        Tutorials
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../tutorial-develop-with-libgdx/" title="Develop with LibGDX" class="md-nav__link">
      Develop with LibGDX
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../tutorial-initialize-new-user/" title="Initialize a new user" class="md-nav__link">
      Initialize a new user
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../tutorial-remote-configuration/" title="Remote configuration" class="md-nav__link">
      Remote configuration
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../tutorial-send-push-messages/" title="Send push messages" class="md-nav__link">
      Send push messages
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#write-records" title="Write records" class="md-nav__link">
    Write records
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#conditional-writes" title="Conditional writes" class="md-nav__link">
    Conditional writes
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fetch-records" title="Fetch records" class="md-nav__link">
    Fetch records
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#list-records" title="List records" class="md-nav__link">
    List records
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#update-records" title="Update records" class="md-nav__link">
    Update records
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#operations" title="Operations" class="md-nav__link">
    Operations
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#paths" title="Paths" class="md-nav__link">
    Paths
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#remove-records" title="Remove records" class="md-nav__link">
    Remove records
  </a>
  
</li>
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="collections">Collections<a class="headerlink" href="#collections" title="Permanent link">&para;</a></h1>
<p>Every app or game has data which is specific to the project.</p>
<p>This information must be stored for users, updated, retrieved, and displayed within various parts of a UI. For this purpose the server incorporates a storage engine with a design optimized for record ownership, access permissions, and batch operations.</p>
<p>Data is stored in collections with one or more records which contain a unique key with JSON content. A collection is created without any configuration required and are grouped into buckets. This creates a simple nested namespace which represents the location of a record.</p>
<div class="codehilite"><pre><span></span>Bucket
+---------------------------------------------------------------------------+
|  Collection                                                               |
|  +---------------------------------------------------------------------+  |
|  |  Record                                                             |  |
|  |  +----------+------------+-------------+-----+-------------------+  |  |
|  |  | ?UserId? | Identifier | Permissions | ... |       Value       |  |  |
|  |  +---------------------------------------------------------------+  |  |
|  +---------------------------------------------------------------------+  |
+---------------------------------------------------------------------------+
</pre></div>


<p>This design gives great flexibility for developers to group sets of information which belong together within a game or app.</p>
<h2 id="write-records">Write records<a class="headerlink" href="#write-records" title="Permanent link">&para;</a></h2>
<p>A user can write one or more records which will be stored in the database server. These records will be written in a single transaction which guarantees the writes succeed together.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>In most cases you won't need to group data under multiple buckets so it can be easiest to just name it after your project. For example "Super Mario Run" could use a bucket name "smr" or similar.</p>
</div>
<p>
                <div class="code-nav-container">
                    
        <ul class="nav nav-tabs">
            
        <li class="nav-item active">
            <a href="#tab-0-csharp" aria-controls="tab-0-csharp" role="tab" data-toggle="tab" data-lang="csharp">Unity</a>
        </li>
    
        <li class="nav-item ">
            <a href="#tab-0-java" aria-controls="tab-0-java" role="tab" data-toggle="tab" data-lang="java">Android/Java</a>
        </li>
    
        <li class="nav-item ">
            <a href="#tab-0-swift" aria-controls="tab-0-swift" role="tab" data-toggle="tab" data-lang="swift">Swift</a>
        </li>
    
        </ul>
    
        <div class="tab-content">
            
        <div role="tabpanel" class="tab-pane active" id="tab-0-csharp">
            <div class="codehilite"><pre><span></span><span class="kt">byte</span><span class="p">[]</span> <span class="n">saveGame</span> <span class="p">=</span> <span class="n">Encoding</span><span class="p">.</span><span class="n">UTF8</span><span class="p">.</span><span class="n">GetBytes</span><span class="p">(</span><span class="s">&quot;{\&quot;progress\&quot;: 50}&quot;</span><span class="p">);</span>
<span class="kt">byte</span><span class="p">[]</span> <span class="n">myStats</span> <span class="p">=</span> <span class="n">Encoding</span><span class="p">.</span><span class="n">UTF8</span><span class="p">.</span><span class="n">GetBytes</span><span class="p">(</span><span class="s">&quot;{\&quot;skill\&quot;: 24}&quot;</span><span class="p">);</span>

<span class="kt">var</span> <span class="n">bucket</span> <span class="p">=</span> <span class="s">&quot;myapp&quot;</span><span class="p">;</span>

<span class="c1">// Write multiple different records across collections.</span>
<span class="kt">var</span> <span class="n">message</span> <span class="p">=</span> <span class="k">new</span> <span class="n">NStorageWriteMessage</span><span class="p">.</span><span class="n">Builder</span><span class="p">()</span>
    <span class="p">.</span><span class="n">Write</span><span class="p">(</span><span class="n">bucket</span><span class="p">,</span> <span class="s">&quot;saves&quot;</span><span class="p">,</span> <span class="s">&quot;savegame&quot;</span><span class="p">,</span> <span class="n">saveGame</span><span class="p">)</span>
    <span class="p">.</span><span class="n">Write</span><span class="p">(</span><span class="n">bucket</span><span class="p">,</span> <span class="s">&quot;stats&quot;</span><span class="p">,</span> <span class="s">&quot;mystats&quot;</span><span class="p">,</span> <span class="n">myStats</span><span class="p">)</span>
    <span class="p">.</span><span class="n">Build</span><span class="p">();</span>
<span class="n">client</span><span class="p">.</span><span class="n">Send</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="p">(</span><span class="n">INResultSet</span><span class="p">&lt;</span><span class="n">INStorageKey</span><span class="p">&gt;</span> <span class="n">list</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">record</span> <span class="k">in</span> <span class="n">list</span><span class="p">.</span><span class="n">Results</span><span class="p">)</span> <span class="p">{</span>
    <span class="kt">var</span> <span class="n">version</span> <span class="p">=</span> <span class="n">Encoding</span><span class="p">.</span><span class="n">UTF8</span><span class="p">.</span><span class="n">GetString</span><span class="p">(</span><span class="n">record</span><span class="p">.</span><span class="n">Version</span><span class="p">);</span>
    <span class="n">Debug</span><span class="p">.</span><span class="n">LogFormat</span><span class="p">(</span><span class="s">&quot;Stored record has version &#39;{0}&#39;&quot;</span><span class="p">,</span> <span class="n">version</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">},</span> <span class="p">(</span><span class="n">INError</span> <span class="n">err</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="n">Debug</span><span class="p">.</span><span class="n">LogErrorFormat</span><span class="p">(</span><span class="s">&quot;Error: code &#39;{0}&#39; with &#39;{1}&#39;.&quot;</span><span class="p">,</span> <span class="n">err</span><span class="p">.</span><span class="n">Code</span><span class="p">,</span> <span class="n">err</span><span class="p">.</span><span class="n">Message</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

        </div>
    
        <div role="tabpanel" class="tab-pane " id="tab-0-java">
            <div class="codehilite"><pre><span></span><span class="kt">byte</span><span class="o">[]</span> <span class="n">saveGame</span> <span class="o">=</span> <span class="s">&quot;{\&quot;progress\&quot;: 50}&quot;</span><span class="o">.</span><span class="na">getBytes</span><span class="o">();</span>
<span class="kt">byte</span><span class="o">[]</span> <span class="n">myStats</span> <span class="o">=</span> <span class="s">&quot;{\&quot;skill\&quot;: 24}&quot;</span><span class="o">.</span><span class="na">getBytes</span><span class="o">();</span>

<span class="n">String</span> <span class="n">bucket</span> <span class="o">=</span> <span class="s">&quot;myapp&quot;</span><span class="o">;</span>
<span class="n">CollatedMessage</span><span class="o">&lt;</span><span class="n">ResultSet</span><span class="o">&lt;</span><span class="n">RecordId</span><span class="o">&gt;&gt;</span> <span class="n">message</span> <span class="o">=</span> <span class="n">StorageWriteMessage</span><span class="o">.</span><span class="na">Builder</span><span class="o">.</span><span class="na">newBuilder</span><span class="o">()</span>
    <span class="o">.</span><span class="na">record</span><span class="o">(</span><span class="n">bucket</span><span class="o">,</span> <span class="s">&quot;saves&quot;</span><span class="o">,</span> <span class="s">&quot;savegame&quot;</span><span class="o">,</span> <span class="n">saveGame</span><span class="o">)</span>
    <span class="o">.</span><span class="na">record</span><span class="o">(</span><span class="n">bucket</span><span class="o">,</span> <span class="s">&quot;stats&quot;</span><span class="o">,</span> <span class="s">&quot;mystats&quot;</span><span class="o">,</span> <span class="n">myStats</span><span class="o">)</span>
    <span class="o">.</span><span class="na">build</span><span class="o">();</span>
<span class="n">Deferred</span><span class="o">&lt;</span><span class="n">ResultSet</span><span class="o">&lt;</span><span class="n">RecordId</span><span class="o">&gt;&gt;</span> <span class="n">deferred</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="na">send</span><span class="o">(</span><span class="n">message</span><span class="o">);</span>
<span class="n">deferred</span><span class="o">.</span><span class="na">addCallback</span><span class="o">(</span><span class="k">new</span> <span class="n">Callback</span><span class="o">&lt;</span><span class="n">ResultSet</span><span class="o">&lt;</span><span class="n">RecordId</span><span class="o">&gt;,</span> <span class="n">ResultSet</span><span class="o">&lt;</span><span class="n">RecordId</span><span class="o">&gt;&gt;()</span> <span class="o">{</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="n">ResultSet</span><span class="o">&lt;</span><span class="n">RecordId</span><span class="o">&gt;</span> <span class="nf">call</span><span class="o">(</span><span class="n">ResultSet</span><span class="o">&lt;</span><span class="n">RecordId</span><span class="o">&gt;</span> <span class="n">list</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
    <span class="k">for</span> <span class="o">(</span><span class="n">RecordId</span> <span class="n">recordId</span> <span class="o">:</span> <span class="n">list</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">String</span> <span class="n">version</span> <span class="o">=</span> <span class="k">new</span> <span class="n">String</span><span class="o">(</span><span class="n">recordId</span><span class="o">.</span><span class="na">getVersion</span><span class="o">());</span>
      <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">&quot;Stored record has version &#39;%s&#39;&quot;</span><span class="o">,</span> <span class="n">version</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="n">list</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}).</span><span class="na">addErrback</span><span class="o">(</span><span class="k">new</span> <span class="n">Callback</span><span class="o">&lt;</span><span class="n">Error</span><span class="o">,</span> <span class="n">Error</span><span class="o">&gt;()</span> <span class="o">{</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="n">Error</span> <span class="nf">call</span><span class="o">(</span><span class="n">Error</span> <span class="n">err</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
    <span class="n">System</span><span class="o">.</span><span class="na">err</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">&quot;Error(&#39;%s&#39;, &#39;%s&#39;)&quot;</span><span class="o">,</span> <span class="n">err</span><span class="o">.</span><span class="na">getCode</span><span class="o">(),</span> <span class="n">err</span><span class="o">.</span><span class="na">getMessage</span><span class="o">());</span>
    <span class="k">return</span> <span class="n">err</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">});</span>
</pre></div>

        </div>
    
        <div role="tabpanel" class="tab-pane " id="tab-0-swift">
            <div class="codehilite"><pre><span></span><span class="kd">let</span> <span class="nv">saveGame</span> <span class="p">=</span> <span class="s">&quot;{</span><span class="se">\&quot;</span><span class="s">progress</span><span class="se">\&quot;</span><span class="s">: 50}&quot;</span><span class="p">.</span><span class="n">data</span><span class="p">(</span><span class="n">using</span><span class="p">:</span> <span class="p">.</span><span class="n">utf8</span><span class="p">)</span><span class="o">!</span>
<span class="kd">let</span> <span class="nv">myStats</span> <span class="p">=</span> <span class="s">&quot;{</span><span class="se">\&quot;</span><span class="s">skill</span><span class="se">\&quot;</span><span class="s">: 24}&quot;</span><span class="p">.</span><span class="n">data</span><span class="p">(</span><span class="n">using</span><span class="p">:</span> <span class="p">.</span><span class="n">utf8</span><span class="p">)</span><span class="o">!</span>

<span class="kd">let</span> <span class="nv">bucket</span> <span class="p">=</span> <span class="s">&quot;myapp&quot;</span>
<span class="kd">var</span> <span class="nv">message</span> <span class="p">=</span> <span class="n">StorageWriteMessage</span><span class="p">()</span>
<span class="n">message</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">bucket</span><span class="p">:</span> <span class="n">bucket</span><span class="p">,</span> <span class="n">collection</span><span class="p">:</span> <span class="s">&quot;saves&quot;</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="s">&quot;savegame&quot;</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">saveGame</span><span class="p">)</span>
<span class="n">message</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">bucket</span><span class="p">:</span> <span class="n">bucket</span><span class="p">,</span> <span class="n">collection</span><span class="p">:</span> <span class="s">&quot;saves&quot;</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="s">&quot;mystats&quot;</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">myStats</span><span class="p">)</span>
<span class="n">client</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="n">message</span><span class="p">:</span> <span class="n">message</span><span class="p">).</span><span class="n">then</span> <span class="p">{</span> <span class="n">list</span> <span class="k">in</span>
  <span class="k">for</span> <span class="n">recordId</span> <span class="k">in</span> <span class="n">list</span> <span class="p">{</span>
    <span class="n">NSLog</span><span class="p">(</span><span class="s">&quot;Stored record has version &#39;@%&#39;&quot;</span><span class="p">,</span> <span class="n">recordId</span><span class="p">.</span><span class="n">version</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">}.</span><span class="k">catch</span> <span class="p">{</span> <span class="n">err</span> <span class="k">in</span>
  <span class="n">NSLog</span><span class="p">(</span><span class="s">&quot;Error @% : @%&quot;</span><span class="p">,</span> <span class="n">err</span><span class="p">,</span> <span class="p">(</span><span class="n">err</span> <span class="k">as</span><span class="p">!</span> <span class="n">NakamaError</span><span class="p">).</span><span class="n">message</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>

        </div>
    
        </div>
    
                </div>
                    </p>
<h3 id="conditional-writes">Conditional writes<a class="headerlink" href="#conditional-writes" title="Permanent link">&para;</a></h3>
<p>When records are successfully stored a version is returned which can be used with further updates to perform concurrent modification checks with the next write. This is often known as a conditional write.</p>
<p>A conditional write ensures a client can only update the record if they've seen the previous version of the record already. The goal is to prevent a change to the record if another client has changed the value between when the first client's read and it's next write.</p>
<p>
                <div class="code-nav-container">
                    
        <ul class="nav nav-tabs">
            
        <li class="nav-item active">
            <a href="#tab-1-csharp" aria-controls="tab-1-csharp" role="tab" data-toggle="tab" data-lang="csharp">Unity</a>
        </li>
    
        <li class="nav-item ">
            <a href="#tab-1-java" aria-controls="tab-1-java" role="tab" data-toggle="tab" data-lang="java">Android/Java</a>
        </li>
    
        <li class="nav-item ">
            <a href="#tab-1-swift" aria-controls="tab-1-swift" role="tab" data-toggle="tab" data-lang="swift">Swift</a>
        </li>
    
        </ul>
    
        <div class="tab-content">
            
        <div role="tabpanel" class="tab-pane active" id="tab-1-csharp">
            <div class="codehilite"><pre><span></span><span class="kt">byte</span><span class="p">[]</span> <span class="n">saveGame</span> <span class="p">=</span> <span class="n">Encoding</span><span class="p">.</span><span class="n">UTF8</span><span class="p">.</span><span class="n">GetBytes</span><span class="p">(</span><span class="s">&quot;{\&quot;progress\&quot;: 54}&quot;</span><span class="p">);</span>
<span class="kt">byte</span><span class="p">[]</span> <span class="n">version</span> <span class="p">=</span> <span class="n">record</span><span class="p">.</span><span class="n">Version</span><span class="p">;</span> <span class="c1">// an INStorageKey object.</span>

<span class="kt">var</span> <span class="n">message</span> <span class="p">=</span> <span class="k">new</span> <span class="n">NStorageWriteMessage</span><span class="p">.</span><span class="n">Builder</span><span class="p">()</span>
    <span class="p">.</span><span class="n">Write</span><span class="p">(</span><span class="s">&quot;myapp&quot;</span><span class="p">,</span> <span class="s">&quot;saves&quot;</span><span class="p">,</span> <span class="s">&quot;savegame&quot;</span><span class="p">,</span> <span class="n">saveGame</span><span class="p">,</span> <span class="n">version</span><span class="p">)</span>
    <span class="p">.</span><span class="n">Build</span><span class="p">();</span>
<span class="n">client</span><span class="p">.</span><span class="n">Send</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="p">(</span><span class="n">INResultSet</span><span class="p">&lt;</span><span class="n">INStorageKey</span><span class="p">&gt;</span> <span class="n">list</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="n">version</span> <span class="p">=</span> <span class="n">list</span><span class="p">.</span><span class="n">Results</span><span class="p">[</span><span class="m">0</span><span class="p">].</span><span class="n">Version</span><span class="p">;</span> <span class="c1">// cache updated version for next write.</span>
<span class="p">},</span> <span class="p">(</span><span class="n">INError</span> <span class="n">err</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="n">Debug</span><span class="p">.</span><span class="n">LogErrorFormat</span><span class="p">(</span><span class="s">&quot;Error: code &#39;{0}&#39; with &#39;{1}&#39;.&quot;</span><span class="p">,</span> <span class="n">err</span><span class="p">.</span><span class="n">Code</span><span class="p">,</span> <span class="n">err</span><span class="p">.</span><span class="n">Message</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

        </div>
    
        <div role="tabpanel" class="tab-pane " id="tab-1-java">
            <div class="codehilite"><pre><span></span><span class="kt">byte</span><span class="o">[]</span> <span class="n">saveGame</span> <span class="o">=</span> <span class="s">&quot;{\&quot;progress\&quot;: 54}&quot;</span><span class="o">.</span><span class="na">getBytes</span><span class="o">();</span>
<span class="kt">byte</span><span class="o">[]</span> <span class="n">version</span> <span class="o">=</span> <span class="n">record</span><span class="o">.</span><span class="na">getVersion</span><span class="o">();</span> <span class="c1">// a RecordId object&#39;s version.</span>

<span class="n">CollatedMessage</span><span class="o">&lt;</span><span class="n">ResultSet</span><span class="o">&lt;</span><span class="n">RecordId</span><span class="o">&gt;&gt;</span> <span class="n">message</span> <span class="o">=</span> <span class="n">StorageWriteMessage</span><span class="o">.</span><span class="na">Builder</span><span class="o">.</span><span class="na">newBuilder</span><span class="o">()</span>
    <span class="o">.</span><span class="na">record</span><span class="o">(</span><span class="s">&quot;myapp&quot;</span><span class="o">,</span> <span class="s">&quot;saves&quot;</span><span class="o">,</span> <span class="s">&quot;savegame&quot;</span><span class="o">,</span> <span class="n">saveGame</span><span class="o">,</span> <span class="n">version</span><span class="o">)</span>
    <span class="o">.</span><span class="na">build</span><span class="o">();</span>
<span class="n">Deferred</span><span class="o">&lt;</span><span class="n">ResultSet</span><span class="o">&lt;</span><span class="n">RecordId</span><span class="o">&gt;&gt;</span> <span class="n">deferred</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="na">send</span><span class="o">(</span><span class="n">message</span><span class="o">);</span>
<span class="n">deferred</span><span class="o">.</span><span class="na">addCallback</span><span class="o">(</span><span class="k">new</span> <span class="n">Callback</span><span class="o">&lt;</span><span class="n">ResultSet</span><span class="o">&lt;</span><span class="n">RecordId</span><span class="o">&gt;,</span> <span class="n">ResultSet</span><span class="o">&lt;</span><span class="n">RecordId</span><span class="o">&gt;&gt;()</span> <span class="o">{</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="n">ResultSet</span><span class="o">&lt;</span><span class="n">RecordId</span><span class="o">&gt;</span> <span class="nf">call</span><span class="o">(</span><span class="n">ResultSet</span><span class="o">&lt;</span><span class="n">RecordId</span><span class="o">&gt;</span> <span class="n">list</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
    <span class="c1">// Cache updated version for next write.</span>
    <span class="n">version</span> <span class="o">=</span> <span class="n">list</span><span class="o">.</span><span class="na">getResults</span><span class="o">().</span><span class="na">get</span><span class="o">(</span><span class="mi">0</span><span class="o">).</span><span class="na">getVersion</span><span class="o">();</span>
    <span class="k">return</span> <span class="n">list</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}).</span><span class="na">addErrback</span><span class="o">(</span><span class="k">new</span> <span class="n">Callback</span><span class="o">&lt;</span><span class="n">Error</span><span class="o">,</span> <span class="n">Error</span><span class="o">&gt;()</span> <span class="o">{</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="n">Error</span> <span class="nf">call</span><span class="o">(</span><span class="n">Error</span> <span class="n">err</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
    <span class="n">System</span><span class="o">.</span><span class="na">err</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">&quot;Error(&#39;%s&#39;, &#39;%s&#39;)&quot;</span><span class="o">,</span> <span class="n">err</span><span class="o">.</span><span class="na">getCode</span><span class="o">(),</span> <span class="n">err</span><span class="o">.</span><span class="na">getMessage</span><span class="o">());</span>
    <span class="k">return</span> <span class="n">err</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">});</span>
</pre></div>

        </div>
    
        <div role="tabpanel" class="tab-pane " id="tab-1-swift">
            <div class="codehilite"><pre><span></span><span class="kd">let</span> <span class="nv">saveGame</span> <span class="p">=</span> <span class="s">&quot;{</span><span class="se">\&quot;</span><span class="s">progress</span><span class="se">\&quot;</span><span class="s">: 54}&quot;</span><span class="p">.</span><span class="n">data</span><span class="p">(</span><span class="n">using</span><span class="p">:</span> <span class="p">.</span><span class="n">utf8</span><span class="p">)</span><span class="o">!</span>
<span class="kd">var</span> <span class="nv">version</span> <span class="p">=</span> <span class="n">record</span><span class="p">.</span><span class="n">version</span> <span class="c1">// a StorageRecordId object&#39;s version.</span>

<span class="kd">var</span> <span class="nv">message</span> <span class="p">=</span> <span class="n">StorageWriteMessage</span><span class="p">()</span>
<span class="n">message</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">bucket</span><span class="p">:</span> <span class="s">&quot;myapp&quot;</span><span class="p">,</span> <span class="n">collection</span><span class="p">:</span> <span class="s">&quot;saves&quot;</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="s">&quot;savegame&quot;</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">saveGame</span><span class="p">,</span> <span class="n">version</span><span class="p">:</span> <span class="n">version</span><span class="p">)</span>
<span class="n">client</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="n">message</span><span class="p">:</span> <span class="n">message</span><span class="p">).</span><span class="n">then</span> <span class="p">{</span> <span class="n">list</span> <span class="k">in</span>
  <span class="n">version</span> <span class="p">=</span> <span class="n">list</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">version</span> <span class="c1">// Cache updated version for next write.</span>
<span class="p">}.</span><span class="k">catch</span> <span class="p">{</span> <span class="n">err</span> <span class="k">in</span>
  <span class="n">NSLog</span><span class="p">(</span><span class="s">&quot;Error @% : @%&quot;</span><span class="p">,</span> <span class="n">err</span><span class="p">,</span> <span class="p">(</span><span class="n">err</span> <span class="k">as</span><span class="p">!</span> <span class="n">NakamaError</span><span class="p">).</span><span class="n">message</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>

        </div>
    
        </div>
    
                </div>
                    </p>
<p>We support another kind of conditional write which is used to write a record only if none already exists for that record's key name.</p>
<p>
                <div class="code-nav-container">
                    
        <ul class="nav nav-tabs">
            
        <li class="nav-item active">
            <a href="#tab-2-csharp" aria-controls="tab-2-csharp" role="tab" data-toggle="tab" data-lang="csharp">Unity</a>
        </li>
    
        <li class="nav-item ">
            <a href="#tab-2-java" aria-controls="tab-2-java" role="tab" data-toggle="tab" data-lang="java">Android/Java</a>
        </li>
    
        <li class="nav-item ">
            <a href="#tab-2-swift" aria-controls="tab-2-swift" role="tab" data-toggle="tab" data-lang="swift">Swift</a>
        </li>
    
        </ul>
    
        <div class="tab-content">
            
        <div role="tabpanel" class="tab-pane active" id="tab-2-csharp">
            <div class="codehilite"><pre><span></span><span class="kt">byte</span><span class="p">[]</span> <span class="n">saveGame</span> <span class="p">=</span> <span class="n">Encoding</span><span class="p">.</span><span class="n">UTF8</span><span class="p">.</span><span class="n">GetBytes</span><span class="p">(</span><span class="s">&quot;{\&quot;progress\&quot;: 1}&quot;</span><span class="p">);</span>
<span class="kt">byte</span><span class="p">[]</span> <span class="n">version</span> <span class="p">=</span> <span class="n">Encoding</span><span class="p">.</span><span class="n">UTF8</span><span class="p">.</span><span class="n">GetBytes</span><span class="p">(</span><span class="s">&quot;*&quot;</span><span class="p">);</span> <span class="c1">// represents &quot;no version&quot;.</span>

<span class="kt">var</span> <span class="n">message</span> <span class="p">=</span> <span class="k">new</span> <span class="n">NStorageWriteMessage</span><span class="p">.</span><span class="n">Builder</span><span class="p">()</span>
    <span class="p">.</span><span class="n">Write</span><span class="p">(</span><span class="s">&quot;myapp&quot;</span><span class="p">,</span> <span class="s">&quot;saves&quot;</span><span class="p">,</span> <span class="s">&quot;savegame&quot;</span><span class="p">,</span> <span class="n">saveGame</span><span class="p">,</span> <span class="n">version</span><span class="p">)</span>
    <span class="p">.</span><span class="n">Build</span><span class="p">();</span>
<span class="n">client</span><span class="p">.</span><span class="n">Send</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="p">(</span><span class="n">INResultSet</span><span class="p">&lt;</span><span class="n">INStorageKey</span><span class="p">&gt;</span> <span class="n">list</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="n">version</span> <span class="p">=</span> <span class="n">list</span><span class="p">.</span><span class="n">Results</span><span class="p">[</span><span class="m">0</span><span class="p">].</span><span class="n">Version</span><span class="p">;</span> <span class="c1">// cache updated version for next write.</span>
<span class="p">},</span> <span class="p">(</span><span class="n">INError</span> <span class="n">err</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="n">Debug</span><span class="p">.</span><span class="n">LogErrorFormat</span><span class="p">(</span><span class="s">&quot;Error: code &#39;{0}&#39; with &#39;{1}&#39;.&quot;</span><span class="p">,</span> <span class="n">err</span><span class="p">.</span><span class="n">Code</span><span class="p">,</span> <span class="n">err</span><span class="p">.</span><span class="n">Message</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

        </div>
    
        <div role="tabpanel" class="tab-pane " id="tab-2-java">
            <div class="codehilite"><pre><span></span><span class="kt">byte</span><span class="o">[]</span> <span class="n">saveGame</span> <span class="o">=</span> <span class="s">&quot;{\&quot;progress\&quot;: 1}&quot;</span><span class="o">.</span><span class="na">getBytes</span><span class="o">();</span>
<span class="kt">byte</span><span class="o">[]</span> <span class="n">version</span> <span class="o">=</span> <span class="s">&quot;*&quot;</span><span class="o">.</span><span class="na">getBytes</span><span class="o">();</span> <span class="c1">// represents &quot;no version&quot;.</span>

<span class="n">CollatedMessage</span><span class="o">&lt;</span><span class="n">ResultSet</span><span class="o">&lt;</span><span class="n">RecordId</span><span class="o">&gt;&gt;</span> <span class="n">message</span> <span class="o">=</span> <span class="n">StorageWriteMessage</span><span class="o">.</span><span class="na">Builder</span><span class="o">.</span><span class="na">newBuilder</span><span class="o">()</span>
    <span class="o">.</span><span class="na">record</span><span class="o">(</span><span class="s">&quot;myapp&quot;</span><span class="o">,</span> <span class="s">&quot;saves&quot;</span><span class="o">,</span> <span class="s">&quot;savegame&quot;</span><span class="o">,</span> <span class="n">saveGame</span><span class="o">,</span> <span class="n">version</span><span class="o">)</span>
    <span class="o">.</span><span class="na">build</span><span class="o">();</span>
<span class="n">Deferred</span><span class="o">&lt;</span><span class="n">ResultSet</span><span class="o">&lt;</span><span class="n">RecordId</span><span class="o">&gt;&gt;</span> <span class="n">deferred</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="na">send</span><span class="o">(</span><span class="n">message</span><span class="o">);</span>
<span class="n">deferred</span><span class="o">.</span><span class="na">addCallback</span><span class="o">(</span><span class="k">new</span> <span class="n">Callback</span><span class="o">&lt;</span><span class="n">ResultSet</span><span class="o">&lt;</span><span class="n">RecordId</span><span class="o">&gt;,</span> <span class="n">ResultSet</span><span class="o">&lt;</span><span class="n">RecordId</span><span class="o">&gt;&gt;()</span> <span class="o">{</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="n">ResultSet</span><span class="o">&lt;</span><span class="n">RecordId</span><span class="o">&gt;</span> <span class="nf">call</span><span class="o">(</span><span class="n">ResultSet</span><span class="o">&lt;</span><span class="n">RecordId</span><span class="o">&gt;</span> <span class="n">list</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
    <span class="c1">// Cache updated version for next write.</span>
    <span class="n">version</span> <span class="o">=</span> <span class="n">list</span><span class="o">.</span><span class="na">getResults</span><span class="o">().</span><span class="na">get</span><span class="o">(</span><span class="mi">0</span><span class="o">).</span><span class="na">getVersion</span><span class="o">();</span>
    <span class="k">return</span> <span class="n">list</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}).</span><span class="na">addErrback</span><span class="o">(</span><span class="k">new</span> <span class="n">Callback</span><span class="o">&lt;</span><span class="n">Error</span><span class="o">,</span> <span class="n">Error</span><span class="o">&gt;()</span> <span class="o">{</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="n">Error</span> <span class="nf">call</span><span class="o">(</span><span class="n">Error</span> <span class="n">err</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
    <span class="n">System</span><span class="o">.</span><span class="na">err</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">&quot;Error(&#39;%s&#39;, &#39;%s&#39;)&quot;</span><span class="o">,</span> <span class="n">err</span><span class="o">.</span><span class="na">getCode</span><span class="o">(),</span> <span class="n">err</span><span class="o">.</span><span class="na">getMessage</span><span class="o">());</span>
    <span class="k">return</span> <span class="n">err</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">});</span>
</pre></div>

        </div>
    
        <div role="tabpanel" class="tab-pane " id="tab-2-swift">
            <div class="codehilite"><pre><span></span><span class="kd">let</span> <span class="nv">saveGame</span> <span class="p">=</span> <span class="s">&quot;{</span><span class="se">\&quot;</span><span class="s">progress</span><span class="se">\&quot;</span><span class="s">: 1}&quot;</span><span class="p">.</span><span class="n">data</span><span class="p">(</span><span class="n">using</span><span class="p">:</span> <span class="p">.</span><span class="n">utf8</span><span class="p">)</span><span class="o">!</span>
<span class="kd">var</span> <span class="nv">version</span> <span class="p">=</span> <span class="s">&quot;*&quot;</span><span class="p">.</span><span class="n">data</span><span class="p">(</span><span class="n">using</span><span class="p">:</span> <span class="p">.</span><span class="n">utf8</span><span class="p">)</span><span class="o">!</span> <span class="c1">// represents &quot;no version&quot;.</span>

<span class="kd">var</span> <span class="nv">message</span> <span class="p">=</span> <span class="n">StorageWriteMessage</span><span class="p">()</span>
<span class="n">message</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">bucket</span><span class="p">:</span> <span class="s">&quot;myapp&quot;</span><span class="p">,</span> <span class="n">collection</span><span class="p">:</span> <span class="s">&quot;saves&quot;</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="s">&quot;savegame&quot;</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">saveGame</span><span class="p">,</span> <span class="n">version</span><span class="p">:</span> <span class="n">version</span><span class="p">)</span>
<span class="n">client</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="n">message</span><span class="p">:</span> <span class="n">message</span><span class="p">).</span><span class="n">then</span> <span class="p">{</span> <span class="n">list</span> <span class="k">in</span>
  <span class="n">version</span> <span class="p">=</span> <span class="n">list</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">version</span> <span class="c1">// Cache updated version for next write.</span>
<span class="p">}.</span><span class="k">catch</span> <span class="p">{</span> <span class="n">err</span> <span class="k">in</span>
  <span class="n">NSLog</span><span class="p">(</span><span class="s">&quot;Error @% : @%&quot;</span><span class="p">,</span> <span class="n">err</span><span class="p">,</span> <span class="p">(</span><span class="n">err</span> <span class="k">as</span><span class="p">!</span> <span class="n">NakamaError</span><span class="p">).</span><span class="n">message</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>

        </div>
    
        </div>
    
                </div>
                    </p>
<h2 id="fetch-records">Fetch records<a class="headerlink" href="#fetch-records" title="Permanent link">&para;</a></h2>
<p>Just like with <a href="#write-records">writing records</a> you can fetch one or more records from the database server.</p>
<p>Each record has an owner and permissions. A record can only be fetched if the permissions allow it. A record which has no owner can be fetched with <code>null</code> and is useful for global records which all users should be able to read.</p>
<p>
                <div class="code-nav-container">
                    
        <ul class="nav nav-tabs">
            
        <li class="nav-item active">
            <a href="#tab-3-csharp" aria-controls="tab-3-csharp" role="tab" data-toggle="tab" data-lang="csharp">Unity</a>
        </li>
    
        <li class="nav-item ">
            <a href="#tab-3-java" aria-controls="tab-3-java" role="tab" data-toggle="tab" data-lang="java">Android/Java</a>
        </li>
    
        <li class="nav-item ">
            <a href="#tab-3-swift" aria-controls="tab-3-swift" role="tab" data-toggle="tab" data-lang="swift">Swift</a>
        </li>
    
        </ul>
    
        <div class="tab-content">
            
        <div role="tabpanel" class="tab-pane active" id="tab-3-csharp">
            <div class="codehilite"><pre><span></span><span class="kt">byte</span><span class="p">[]</span> <span class="n">userId</span> <span class="p">=</span> <span class="n">session</span><span class="p">.</span><span class="n">Id</span><span class="p">;</span> <span class="c1">// an INSession object.</span>

<span class="kt">var</span> <span class="n">message</span> <span class="p">=</span> <span class="k">new</span> <span class="n">NStorageFetchMessage</span><span class="p">.</span><span class="n">Builder</span><span class="p">()</span>
    <span class="p">.</span><span class="n">Fetch</span><span class="p">(</span><span class="s">&quot;myapp&quot;</span><span class="p">,</span> <span class="s">&quot;saves&quot;</span><span class="p">,</span> <span class="s">&quot;savegame&quot;</span><span class="p">,</span> <span class="n">userId</span><span class="p">)</span>
    <span class="p">.</span><span class="n">Fetch</span><span class="p">(</span><span class="s">&quot;myapp&quot;</span><span class="p">,</span> <span class="s">&quot;configuration&quot;</span><span class="p">,</span> <span class="s">&quot;config&quot;</span><span class="p">,</span> <span class="k">null</span><span class="p">)</span>
    <span class="p">.</span><span class="n">Build</span><span class="p">();</span>
<span class="n">client</span><span class="p">.</span><span class="n">Send</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="p">(</span><span class="n">INResultSet</span><span class="p">&lt;</span><span class="n">INStorageData</span><span class="p">&gt;</span> <span class="n">list</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">record</span> <span class="k">in</span> <span class="n">list</span><span class="p">.</span><span class="n">Results</span><span class="p">)</span> <span class="p">{</span>
    <span class="kt">var</span> <span class="n">data</span> <span class="p">=</span> <span class="n">Encoding</span><span class="p">.</span><span class="n">UTF8</span><span class="p">.</span><span class="n">GetString</span><span class="p">(</span><span class="n">record</span><span class="p">.</span><span class="n">Data</span><span class="p">);</span>
    <span class="n">Debug</span><span class="p">.</span><span class="n">LogFormat</span><span class="p">(</span><span class="s">&quot;Record value &#39;{0}&#39;&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">);</span>
    <span class="n">Debug</span><span class="p">.</span><span class="n">LogFormat</span><span class="p">(</span><span class="s">&quot;Record permissions read &#39;{0}&#39; write &#39;{1}&#39;&quot;</span><span class="p">,</span>
        <span class="n">record</span><span class="p">.</span><span class="n">PermissionRead</span><span class="p">,</span> <span class="n">record</span><span class="p">.</span><span class="n">PermissionWrite</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">},</span> <span class="p">(</span><span class="n">INError</span> <span class="n">err</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="n">Debug</span><span class="p">.</span><span class="n">LogErrorFormat</span><span class="p">(</span><span class="s">&quot;Error: code &#39;{0}&#39; with &#39;{1}&#39;.&quot;</span><span class="p">,</span> <span class="n">err</span><span class="p">.</span><span class="n">Code</span><span class="p">,</span> <span class="n">err</span><span class="p">.</span><span class="n">Message</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

        </div>
    
        <div role="tabpanel" class="tab-pane " id="tab-3-java">
            <div class="codehilite"><pre><span></span><span class="kt">byte</span><span class="o">[]</span> <span class="n">userId</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">getId</span><span class="o">();</span> <span class="c1">// a Session object&#39;s Id.</span>

<span class="n">CollatedMessage</span><span class="o">&lt;</span><span class="n">ResultSet</span><span class="o">&lt;</span><span class="n">StorageRecord</span><span class="o">&gt;&gt;</span> <span class="n">message</span> <span class="o">=</span> <span class="n">StorageFetchMessage</span><span class="o">.</span><span class="na">Builder</span><span class="o">.</span><span class="na">newBuilder</span><span class="o">()</span>
    <span class="o">.</span><span class="na">record</span><span class="o">(</span><span class="s">&quot;myapp&quot;</span><span class="o">,</span> <span class="s">&quot;saves&quot;</span><span class="o">,</span> <span class="s">&quot;savegame&quot;</span><span class="o">,</span> <span class="n">userId</span><span class="o">)</span>
    <span class="o">.</span><span class="na">record</span><span class="o">(</span><span class="s">&quot;myapp&quot;</span><span class="o">,</span> <span class="s">&quot;configuration&quot;</span><span class="o">,</span> <span class="s">&quot;config&quot;</span><span class="o">,</span> <span class="kc">null</span><span class="o">)</span>
    <span class="o">.</span><span class="na">build</span><span class="o">();</span>
<span class="n">Deferred</span><span class="o">&lt;</span><span class="n">ResultSet</span><span class="o">&lt;</span><span class="n">StorageRecord</span><span class="o">&gt;&gt;</span> <span class="n">deferred</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="na">send</span><span class="o">(</span><span class="n">message</span><span class="o">);</span>
<span class="n">deferred</span><span class="o">.</span><span class="na">addCallback</span><span class="o">(</span><span class="k">new</span> <span class="n">Callback</span><span class="o">&lt;</span><span class="n">ResultSet</span><span class="o">&lt;</span><span class="n">StorageRecord</span><span class="o">&gt;,</span> <span class="n">ResultSet</span><span class="o">&lt;</span><span class="n">StorageRecord</span><span class="o">&gt;&gt;()</span> <span class="o">{</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="n">ResultSet</span><span class="o">&lt;</span><span class="n">StorageRecord</span><span class="o">&gt;</span> <span class="nf">call</span><span class="o">(</span><span class="n">ResultSet</span><span class="o">&lt;</span><span class="n">StorageRecord</span><span class="o">&gt;</span> <span class="n">list</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
    <span class="k">for</span> <span class="o">(</span><span class="n">StorageRecord</span> <span class="n">record</span> <span class="o">:</span> <span class="n">list</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">String</span> <span class="n">value</span> <span class="o">=</span> <span class="k">new</span> <span class="n">String</span><span class="o">(</span><span class="n">record</span><span class="o">.</span><span class="na">getValue</span><span class="o">());</span>
      <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">&quot;Record value &#39;%s&#39;&quot;</span><span class="o">,</span> <span class="n">value</span><span class="o">);</span>
      <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">&quot;Record permissions read &#39;%s&#39; write &#39;%s&#39;&quot;</span><span class="o">,</span>
          <span class="n">record</span><span class="o">.</span><span class="na">getPermissionRead</span><span class="o">(),</span> <span class="n">record</span><span class="o">.</span><span class="na">getPermissionWrite</span><span class="o">());</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="n">list</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}).</span><span class="na">addErrback</span><span class="o">(</span><span class="k">new</span> <span class="n">Callback</span><span class="o">&lt;</span><span class="n">Error</span><span class="o">,</span> <span class="n">Error</span><span class="o">&gt;()</span> <span class="o">{</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="n">Error</span> <span class="nf">call</span><span class="o">(</span><span class="n">Error</span> <span class="n">err</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
    <span class="n">System</span><span class="o">.</span><span class="na">err</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">&quot;Error(&#39;%s&#39;, &#39;%s&#39;)&quot;</span><span class="o">,</span> <span class="n">err</span><span class="o">.</span><span class="na">getCode</span><span class="o">(),</span> <span class="n">err</span><span class="o">.</span><span class="na">getMessage</span><span class="o">());</span>
    <span class="k">return</span> <span class="n">err</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">});</span>
</pre></div>

        </div>
    
        <div role="tabpanel" class="tab-pane " id="tab-3-swift">
            <div class="codehilite"><pre><span></span><span class="kd">let</span> <span class="nv">userId</span> <span class="p">=</span> <span class="n">session</span><span class="p">.</span><span class="n">userID</span> <span class="c1">// a Session object&#39;s Id.</span>

<span class="kd">var</span> <span class="nv">message</span> <span class="p">=</span> <span class="n">StorageFetchMessage</span><span class="p">()</span>
<span class="n">message</span><span class="p">.</span><span class="n">fetch</span><span class="p">(</span><span class="n">bucket</span><span class="p">:</span> <span class="s">&quot;myapp&quot;</span><span class="p">,</span> <span class="n">collection</span><span class="p">:</span> <span class="s">&quot;saves&quot;</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="s">&quot;savegame&quot;</span><span class="p">,</span> <span class="n">userID</span><span class="p">:</span> <span class="n">userId</span><span class="p">)</span>
<span class="n">message</span><span class="p">.</span><span class="n">fetch</span><span class="p">(</span><span class="n">bucket</span><span class="p">:</span> <span class="s">&quot;myapp&quot;</span><span class="p">,</span> <span class="n">collection</span><span class="p">:</span> <span class="s">&quot;configuration&quot;</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="s">&quot;config&quot;</span><span class="p">,</span> <span class="n">userID</span><span class="p">:</span> <span class="kc">nil</span><span class="p">)</span>
<span class="n">client</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="n">message</span><span class="p">:</span> <span class="n">message</span><span class="p">).</span><span class="n">then</span> <span class="p">{</span> <span class="n">list</span> <span class="k">in</span>
  <span class="k">for</span> <span class="n">record</span> <span class="k">in</span> <span class="n">list</span> <span class="p">{</span>
    <span class="n">NSLog</span><span class="p">(</span><span class="s">&quot;Record value &#39;@%&#39;&quot;</span><span class="p">,</span> <span class="n">record</span><span class="p">.</span><span class="n">value</span><span class="p">)</span>
    <span class="n">NSLog</span><span class="p">(</span><span class="s">&quot;Record permissions read &#39;@%&#39; write &#39;@%&#39;&quot;</span><span class="p">,</span>
        <span class="n">record</span><span class="p">.</span><span class="n">permissionRead</span><span class="p">,</span> <span class="n">record</span><span class="p">.</span><span class="n">permissionWrite</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">}.</span><span class="k">catch</span> <span class="p">{</span> <span class="n">err</span> <span class="k">in</span>
  <span class="n">NSLog</span><span class="p">(</span><span class="s">&quot;Error @% : @%&quot;</span><span class="p">,</span> <span class="n">err</span><span class="p">,</span> <span class="p">(</span><span class="n">err</span> <span class="k">as</span><span class="p">!</span> <span class="n">NakamaError</span><span class="p">).</span><span class="n">message</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>

        </div>
    
        </div>
    
                </div>
                    </p>
<h2 id="list-records">List records<a class="headerlink" href="#list-records" title="Permanent link">&para;</a></h2>
<p>You can list records in a collection and page through results. The records returned can be filter to those owned by the user or <code>"null"</code> for public records which aren't owned by a user.</p>
<p>
                <div class="code-nav-container">
                    
        <ul class="nav nav-tabs">
            
        <li class="nav-item active">
            <a href="#tab-4-csharp" aria-controls="tab-4-csharp" role="tab" data-toggle="tab" data-lang="csharp">Unity</a>
        </li>
    
        <li class="nav-item ">
            <a href="#tab-4-java" aria-controls="tab-4-java" role="tab" data-toggle="tab" data-lang="java">Android/Java</a>
        </li>
    
        <li class="nav-item ">
            <a href="#tab-4-swift" aria-controls="tab-4-swift" role="tab" data-toggle="tab" data-lang="swift">Swift</a>
        </li>
    
        </ul>
    
        <div class="tab-content">
            
        <div role="tabpanel" class="tab-pane active" id="tab-4-csharp">
            <div class="codehilite"><pre><span></span><span class="kt">byte</span><span class="p">[]</span> <span class="n">userId</span> <span class="p">=</span> <span class="n">session</span><span class="p">.</span><span class="n">Id</span><span class="p">;</span> <span class="c1">// an INSession object.</span>

<span class="kt">var</span> <span class="n">message</span> <span class="p">=</span> <span class="k">new</span> <span class="n">NStorageListMessage</span><span class="p">.</span><span class="n">Builder</span><span class="p">()</span>
    <span class="p">.</span><span class="n">Bucket</span><span class="p">(</span><span class="s">&quot;myapp&quot;</span><span class="p">)</span>
    <span class="p">.</span><span class="n">Collection</span><span class="p">(</span><span class="s">&quot;saves&quot;</span><span class="p">)</span>
    <span class="p">.</span><span class="n">UserId</span><span class="p">(</span><span class="n">userId</span><span class="p">)</span>
    <span class="p">.</span><span class="n">Build</span><span class="p">();</span>
<span class="n">client</span><span class="p">.</span><span class="n">Send</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="p">(</span><span class="n">INResultSet</span><span class="p">&lt;</span><span class="n">INStorageData</span><span class="p">&gt;</span> <span class="n">list</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">record</span> <span class="k">in</span> <span class="n">list</span><span class="p">.</span><span class="n">Results</span><span class="p">)</span> <span class="p">{</span>
    <span class="kt">var</span> <span class="n">data</span> <span class="p">=</span> <span class="n">Encoding</span><span class="p">.</span><span class="n">UTF8</span><span class="p">.</span><span class="n">GetString</span><span class="p">(</span><span class="n">record</span><span class="p">.</span><span class="n">Data</span><span class="p">);</span>
    <span class="n">Debug</span><span class="p">.</span><span class="n">LogFormat</span><span class="p">(</span><span class="s">&quot;Record value &#39;{0}&#39;&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">);</span>
    <span class="n">Debug</span><span class="p">.</span><span class="n">LogFormat</span><span class="p">(</span><span class="s">&quot;Record permissions read &#39;{0}&#39; write &#39;{1}&#39;&quot;</span><span class="p">,</span>
        <span class="n">record</span><span class="p">.</span><span class="n">PermissionRead</span><span class="p">,</span> <span class="n">record</span><span class="p">.</span><span class="n">PermissionWrite</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">},</span> <span class="p">(</span><span class="n">INError</span> <span class="n">err</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="n">Debug</span><span class="p">.</span><span class="n">LogErrorFormat</span><span class="p">(</span><span class="s">&quot;Error: code &#39;{0}&#39; with &#39;{1}&#39;.&quot;</span><span class="p">,</span> <span class="n">err</span><span class="p">.</span><span class="n">Code</span><span class="p">,</span> <span class="n">err</span><span class="p">.</span><span class="n">Message</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

        </div>
    
        <div role="tabpanel" class="tab-pane " id="tab-4-java">
            <div class="codehilite"><pre><span></span><span class="kt">byte</span><span class="o">[]</span> <span class="n">userId</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">getId</span><span class="o">();</span> <span class="c1">// a Session object&#39;s Id.</span>

<span class="n">CollatedMessage</span><span class="o">&lt;</span><span class="n">ResultSet</span><span class="o">&lt;</span><span class="n">StorageRecord</span><span class="o">&gt;&gt;</span> <span class="n">message</span> <span class="o">=</span> <span class="n">StorageListMessage</span><span class="o">.</span><span class="na">Builder</span><span class="o">.</span><span class="na">newBuilder</span><span class="o">(</span><span class="n">userId</span><span class="o">)</span>
    <span class="o">.</span><span class="na">bucket</span><span class="o">(</span><span class="s">&quot;myapp&quot;</span><span class="o">)</span>
    <span class="o">.</span><span class="na">collection</span><span class="o">(</span><span class="s">&quot;saves&quot;</span><span class="o">)</span>
    <span class="o">.</span><span class="na">build</span><span class="o">();</span>
<span class="n">Deferred</span><span class="o">&lt;</span><span class="n">ResultSet</span><span class="o">&lt;</span><span class="n">StorageRecord</span><span class="o">&gt;&gt;</span> <span class="n">deferred</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="na">send</span><span class="o">(</span><span class="n">message</span><span class="o">);</span>
<span class="n">deferred</span><span class="o">.</span><span class="na">addCallback</span><span class="o">(</span><span class="k">new</span> <span class="n">Callback</span><span class="o">&lt;</span><span class="n">ResultSet</span><span class="o">&lt;</span><span class="n">StorageRecord</span><span class="o">&gt;,</span> <span class="n">ResultSet</span><span class="o">&lt;</span><span class="n">StorageRecord</span><span class="o">&gt;&gt;()</span> <span class="o">{</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="n">ResultSet</span><span class="o">&lt;</span><span class="n">StorageRecord</span><span class="o">&gt;</span> <span class="nf">call</span><span class="o">(</span><span class="n">ResultSet</span><span class="o">&lt;</span><span class="n">StorageRecord</span><span class="o">&gt;</span> <span class="n">list</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
    <span class="k">for</span> <span class="o">(</span><span class="n">StorageRecord</span> <span class="n">record</span> <span class="o">:</span> <span class="n">list</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">String</span> <span class="n">value</span> <span class="o">=</span> <span class="k">new</span> <span class="n">String</span><span class="o">(</span><span class="n">record</span><span class="o">.</span><span class="na">getValue</span><span class="o">());</span>
      <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">&quot;Record value &#39;%s&#39;&quot;</span><span class="o">,</span> <span class="n">value</span><span class="o">);</span>
      <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">&quot;Record permissions read &#39;%s&#39; write &#39;%s&#39;&quot;</span><span class="o">,</span>
          <span class="n">record</span><span class="o">.</span><span class="na">getPermissionRead</span><span class="o">(),</span> <span class="n">record</span><span class="o">.</span><span class="na">getPermissionWrite</span><span class="o">());</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="n">list</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}).</span><span class="na">addErrback</span><span class="o">(</span><span class="k">new</span> <span class="n">Callback</span><span class="o">&lt;</span><span class="n">Error</span><span class="o">,</span> <span class="n">Error</span><span class="o">&gt;()</span> <span class="o">{</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="n">Error</span> <span class="nf">call</span><span class="o">(</span><span class="n">Error</span> <span class="n">err</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
    <span class="n">System</span><span class="o">.</span><span class="na">err</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">&quot;Error(&#39;%s&#39;, &#39;%s&#39;)&quot;</span><span class="o">,</span> <span class="n">err</span><span class="o">.</span><span class="na">getCode</span><span class="o">(),</span> <span class="n">err</span><span class="o">.</span><span class="na">getMessage</span><span class="o">());</span>
    <span class="k">return</span> <span class="n">err</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">});</span>
</pre></div>

        </div>
    
        <div role="tabpanel" class="tab-pane " id="tab-4-swift">
            <div class="codehilite"><pre><span></span><span class="kd">let</span> <span class="nv">userId</span> <span class="p">=</span> <span class="n">session</span><span class="p">.</span><span class="n">userID</span> <span class="c1">// a Session object&#39;s Id.</span>

<span class="kd">var</span> <span class="nv">message</span> <span class="p">=</span> <span class="n">StorageListMessage</span><span class="p">(</span><span class="n">bucket</span><span class="p">:</span> <span class="s">&quot;myapp&quot;</span><span class="p">)</span>
<span class="n">message</span><span class="p">.</span><span class="n">collection</span> <span class="p">=</span> <span class="s">&quot;saves&quot;</span>
<span class="n">message</span><span class="p">.</span><span class="n">userID</span> <span class="p">=</span> <span class="n">userId</span>
<span class="n">client</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="n">message</span><span class="p">:</span> <span class="n">message</span><span class="p">).</span><span class="n">then</span> <span class="p">{</span> <span class="n">list</span> <span class="k">in</span>
  <span class="k">for</span> <span class="n">record</span> <span class="k">in</span> <span class="n">list</span> <span class="p">{</span>
    <span class="n">NSLog</span><span class="p">(</span><span class="s">&quot;Record value &#39;@%&#39;&quot;</span><span class="p">,</span> <span class="n">record</span><span class="p">.</span><span class="n">value</span><span class="p">)</span>
    <span class="n">NSLog</span><span class="p">(</span><span class="s">&quot;Record permissions read &#39;@%&#39; write &#39;@%&#39;&quot;</span><span class="p">,</span>
        <span class="n">record</span><span class="p">.</span><span class="n">permissionRead</span><span class="p">,</span> <span class="n">record</span><span class="p">.</span><span class="n">permissionWrite</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">}.</span><span class="k">catch</span> <span class="p">{</span> <span class="n">err</span> <span class="k">in</span>
  <span class="n">NSLog</span><span class="p">(</span><span class="s">&quot;Error @% : @%&quot;</span><span class="p">,</span> <span class="n">err</span><span class="p">,</span> <span class="p">(</span><span class="n">err</span> <span class="k">as</span><span class="p">!</span> <span class="n">NakamaError</span><span class="p">).</span><span class="n">message</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>

        </div>
    
        </div>
    
                </div>
                    </p>
<h2 id="update-records">Update records<a class="headerlink" href="#update-records" title="Permanent link">&para;</a></h2>
<p>Every record's value is required to be a JSON object. To update the value you can fetch the object modify it and write it back; but a more efficient option is to update the value on the server based on a set of "operations".</p>
<h3 id="operations">Operations<a class="headerlink" href="#operations" title="Permanent link">&para;</a></h3>
<p>You can create a sequence of operations which are applied to the JSON object. If any of the operations fail, then the update is aborted, and none of the changes are applied. Each operation has a code and makes a specific change to the object.</p>
<table>
<thead>
<tr>
<th>Operation</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>add</td>
<td>Add field or value to array at the path.</td>
</tr>
<tr>
<td>append</td>
<td>Append a value or array of values at the path.</td>
</tr>
<tr>
<td>copy</td>
<td>Copy value at the path to another path.</td>
</tr>
<tr>
<td>incr</td>
<td>Add a positive/negative value to the value at the path.</td>
</tr>
<tr>
<td>init</td>
<td>Initialize the value at the path only if it's not already present.</td>
</tr>
<tr>
<td>merge</td>
<td>Perform a merge of the object at the path.</td>
</tr>
<tr>
<td>move</td>
<td>Move a value from one path to another and remove from the original path.</td>
</tr>
<tr>
<td>remove</td>
<td>Remove the value or array at the path.</td>
</tr>
<tr>
<td>replace</td>
<td>Replaces an existing value at the specified path.</td>
</tr>
<tr>
<td>test</td>
<td>Tests equality of the value at the path. The entire patch set fails if the test fails.</td>
</tr>
<tr>
<td>compare</td>
<td>Performs a comparator which returns -1, 0, or 1 depending on whether the value is less than, the same, or greater than the value in the path.</td>
</tr>
</tbody>
</table>
<h3 id="paths">Paths<a class="headerlink" href="#paths" title="Permanent link">&para;</a></h3>
<p>Paths are used to refer to certain parts of a JSON object. They're separated by forward slashes <code>"/name/first"</code> and will be interpreted as a <a href="http://tools.ietf.org/html/rfc6901" target="\_blank">JSON Pointer</a>.</p>
<p>Array positions in a path are indicated using a zero-indexed integer <code>"stash.4.item_name"</code>. You can append to the end of the array with the 'append' operation. If the value specified in the append is an array all of the entries in the value will be appended to the array in the path.</p>
<p>You can update one or more records with different update operations.</p>
<p>
                <div class="code-nav-container">
                    
        <ul class="nav nav-tabs">
            
        <li class="nav-item active">
            <a href="#tab-5-csharp" aria-controls="tab-5-csharp" role="tab" data-toggle="tab" data-lang="csharp">Unity</a>
        </li>
    
        <li class="nav-item ">
            <a href="#tab-5-java" aria-controls="tab-5-java" role="tab" data-toggle="tab" data-lang="java">Android/Java</a>
        </li>
    
        <li class="nav-item ">
            <a href="#tab-5-swift" aria-controls="tab-5-swift" role="tab" data-toggle="tab" data-lang="swift">Swift</a>
        </li>
    
        </ul>
    
        <div class="tab-content">
            
        <div role="tabpanel" class="tab-pane active" id="tab-5-csharp">
            <div class="codehilite"><pre><span></span><span class="kt">var</span> <span class="n">jsonString</span> <span class="p">=</span> <span class="s">&quot;{\&quot;coins\&quot;: 100, \&quot;gems\&quot;: 10, \&quot;artifacts\&quot;: 0}&quot;</span><span class="p">;</span>
<span class="kt">byte</span><span class="p">[]</span> <span class="n">json</span> <span class="p">=</span> <span class="n">Encoding</span><span class="p">.</span><span class="n">UTF8</span><span class="p">.</span><span class="n">GetBytes</span><span class="p">(</span><span class="n">jsonString</span><span class="p">);</span>

<span class="kt">var</span> <span class="n">message</span> <span class="p">=</span> <span class="k">new</span> <span class="n">NStorageUpdateMessage</span><span class="p">.</span><span class="n">Builder</span><span class="p">()</span>
    <span class="p">.</span><span class="n">Update</span><span class="p">(</span><span class="s">&quot;myapp&quot;</span><span class="p">,</span> <span class="s">&quot;wallets&quot;</span><span class="p">,</span> <span class="s">&quot;wallet&quot;</span><span class="p">,</span> <span class="k">new</span> <span class="n">NStorageUpdateMessage</span><span class="p">.</span><span class="n">StorageUpdateBuilder</span><span class="p">()</span>
        <span class="p">.</span><span class="n">Init</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">json</span><span class="p">)</span>
        <span class="p">.</span><span class="n">Incr</span><span class="p">(</span><span class="s">&quot;/coins&quot;</span><span class="p">,</span> <span class="m">10</span><span class="p">)</span>
        <span class="p">.</span><span class="n">Incr</span><span class="p">(</span><span class="s">&quot;/gems&quot;</span><span class="p">,</span> <span class="m">50</span><span class="p">)</span>
        <span class="p">.</span><span class="n">Build</span><span class="p">())</span>
    <span class="p">.</span><span class="n">Build</span><span class="p">();</span>
<span class="n">client</span><span class="p">.</span><span class="n">Send</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="p">(</span><span class="n">INResultSet</span><span class="p">&lt;</span><span class="n">INStorageKey</span><span class="p">&gt;</span> <span class="n">list</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">record</span> <span class="k">in</span> <span class="n">list</span><span class="p">.</span><span class="n">Results</span><span class="p">)</span> <span class="p">{</span>
    <span class="kt">var</span> <span class="n">version</span> <span class="p">=</span> <span class="n">Encoding</span><span class="p">.</span><span class="n">UTF8</span><span class="p">.</span><span class="n">GetString</span><span class="p">(</span><span class="n">record</span><span class="p">.</span><span class="n">Version</span><span class="p">);</span>
    <span class="n">Debug</span><span class="p">.</span><span class="n">LogFormat</span><span class="p">(</span><span class="s">&quot;Stored record has version &#39;{0}&#39;&quot;</span><span class="p">,</span> <span class="n">version</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">},</span> <span class="p">(</span><span class="n">INError</span> <span class="n">error</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="n">Debug</span><span class="p">.</span><span class="n">LogErrorFormat</span><span class="p">(</span><span class="s">&quot;Error: code &#39;{0}&#39; with &#39;{1}&#39;.&quot;</span><span class="p">,</span> <span class="n">err</span><span class="p">.</span><span class="n">Code</span><span class="p">,</span> <span class="n">err</span><span class="p">.</span><span class="n">Message</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

        </div>
    
        <div role="tabpanel" class="tab-pane " id="tab-5-java">
            <div class="codehilite"><pre><span></span><span class="kt">byte</span><span class="o">[]</span> <span class="n">json</span> <span class="o">=</span> <span class="s">&quot;{\&quot;coins\&quot;: 100, \&quot;gems\&quot;: 10, \&quot;artifacts\&quot;: 0}&quot;</span><span class="o">.</span><span class="na">getBytes</span><span class="o">();</span>

<span class="n">CollatedMessage</span><span class="o">&lt;</span><span class="n">ResultSet</span><span class="o">&lt;</span><span class="n">RecordId</span><span class="o">&gt;&gt;</span> <span class="n">message</span> <span class="o">=</span> <span class="n">StorageUpdateMessage</span><span class="o">.</span><span class="na">Builder</span><span class="o">.</span><span class="na">newBuilder</span><span class="o">()</span>
    <span class="o">.</span><span class="na">record</span><span class="o">(</span><span class="s">&quot;myapp&quot;</span><span class="o">,</span> <span class="s">&quot;wallets&quot;</span><span class="o">,</span> <span class="s">&quot;wallet&quot;</span><span class="o">,</span> <span class="k">new</span> <span class="n">StorageUpdateMessage</span><span class="o">.</span><span class="na">OpBuilder</span><span class="o">.</span><span class="na">newBuilder</span><span class="o">()</span>
        <span class="o">.</span><span class="na">init</span><span class="o">(</span><span class="s">&quot;&quot;</span><span class="o">,</span> <span class="n">json</span><span class="o">)</span>
        <span class="o">.</span><span class="na">incr</span><span class="o">(</span><span class="s">&quot;/coins&quot;</span><span class="o">,</span> <span class="mi">10</span><span class="o">)</span>
        <span class="o">.</span><span class="na">incr</span><span class="o">(</span><span class="s">&quot;/gems&quot;</span><span class="o">,</span> <span class="mi">50</span><span class="o">)</span>
        <span class="o">.</span><span class="na">build</span><span class="o">())</span>
    <span class="o">.</span><span class="na">build</span><span class="o">();</span>
<span class="n">Deferred</span><span class="o">&lt;</span><span class="n">ResultSet</span><span class="o">&lt;</span><span class="n">RecordId</span><span class="o">&gt;&gt;</span> <span class="n">deferred</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="na">send</span><span class="o">(</span><span class="n">message</span><span class="o">);</span>
<span class="n">deferred</span><span class="o">.</span><span class="na">addCallback</span><span class="o">(</span><span class="k">new</span> <span class="n">Callback</span><span class="o">&lt;</span><span class="n">ResultSet</span><span class="o">&lt;</span><span class="n">RecordId</span><span class="o">&gt;,</span> <span class="n">ResultSet</span><span class="o">&lt;</span><span class="n">RecordId</span><span class="o">&gt;&gt;()</span> <span class="o">{</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="n">ResultSet</span><span class="o">&lt;</span><span class="n">RecordId</span><span class="o">&gt;</span> <span class="nf">call</span><span class="o">(</span><span class="n">ResultSet</span><span class="o">&lt;</span><span class="n">RecordId</span><span class="o">&gt;</span> <span class="n">list</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
    <span class="k">for</span> <span class="o">(</span><span class="n">RecordId</span> <span class="n">recordId</span> <span class="o">:</span> <span class="n">list</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">String</span> <span class="n">version</span> <span class="o">=</span> <span class="k">new</span> <span class="n">String</span><span class="o">(</span><span class="n">recordId</span><span class="o">.</span><span class="na">getVersion</span><span class="o">());</span>
      <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">&quot;Stored record has version &#39;%s&#39;&quot;</span><span class="o">,</span> <span class="n">version</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="n">list</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}).</span><span class="na">addErrback</span><span class="o">(</span><span class="k">new</span> <span class="n">Callback</span><span class="o">&lt;</span><span class="n">Error</span><span class="o">,</span> <span class="n">Error</span><span class="o">&gt;()</span> <span class="o">{</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="n">Error</span> <span class="nf">call</span><span class="o">(</span><span class="n">Error</span> <span class="n">err</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
    <span class="n">System</span><span class="o">.</span><span class="na">err</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">&quot;Error(&#39;%s&#39;, &#39;%s&#39;)&quot;</span><span class="o">,</span> <span class="n">err</span><span class="o">.</span><span class="na">getCode</span><span class="o">(),</span> <span class="n">err</span><span class="o">.</span><span class="na">getMessage</span><span class="o">());</span>
    <span class="k">return</span> <span class="n">err</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">});</span>
</pre></div>

        </div>
    
        <div role="tabpanel" class="tab-pane " id="tab-5-swift">
            <div class="codehilite"><pre><span></span><span class="kd">let</span> <span class="nv">json</span> <span class="p">=</span> <span class="s">&quot;{</span><span class="se">\&quot;</span><span class="s">coins</span><span class="se">\&quot;</span><span class="s">: 100, </span><span class="se">\&quot;</span><span class="s">gems</span><span class="se">\&quot;</span><span class="s">: 10, </span><span class="se">\&quot;</span><span class="s">artifacts</span><span class="se">\&quot;</span><span class="s">: 0}&quot;</span>
<span class="kd">let</span> <span class="nv">value</span> <span class="p">=</span> <span class="n">json</span><span class="p">.</span><span class="n">data</span><span class="p">(</span><span class="n">using</span><span class="p">:</span> <span class="p">.</span><span class="n">utf8</span><span class="p">)</span><span class="o">!</span>

<span class="kd">let</span> <span class="nv">ops</span> <span class="p">=</span> <span class="p">[</span>
  <span class="n">StorageOp</span><span class="p">(</span><span class="n">init_</span><span class="p">:</span> <span class="s">&quot;/foo&quot;</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">value</span><span class="p">),</span>
  <span class="n">StorageOp</span><span class="p">(</span><span class="n">incr</span><span class="p">:</span> <span class="s">&quot;/foo/coins&quot;</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="mi">10</span><span class="p">)</span>
  <span class="n">StorageOp</span><span class="p">(</span><span class="n">incr</span><span class="p">:</span> <span class="s">&quot;/foo/gems&quot;</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="mi">50</span><span class="p">)</span>
<span class="p">]</span>

<span class="kd">var</span> <span class="nv">message</span> <span class="p">=</span> <span class="n">StorageUpdateMessage</span><span class="p">()</span>
<span class="n">message</span><span class="p">.</span><span class="n">update</span><span class="p">(</span><span class="n">bucket</span><span class="p">:</span> <span class="s">&quot;myapp&quot;</span><span class="p">,</span> <span class="n">collection</span><span class="p">:</span> <span class="s">&quot;wallets&quot;</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="s">&quot;wallet&quot;</span><span class="p">,</span> <span class="n">ops</span><span class="p">:</span> <span class="n">ops</span><span class="p">)</span>
<span class="n">client</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="n">message</span><span class="p">:</span> <span class="n">message</span><span class="p">).</span><span class="n">then</span> <span class="p">{</span> <span class="n">list</span> <span class="k">in</span>
  <span class="k">for</span> <span class="n">record</span> <span class="k">in</span> <span class="n">list</span> <span class="p">{</span>
    <span class="n">NSLog</span><span class="p">(</span><span class="s">&quot;Stored record has version &#39;@%&#39;&quot;</span><span class="p">,</span> <span class="n">record</span><span class="p">.</span><span class="n">version</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">}.</span><span class="k">catch</span> <span class="p">{</span> <span class="n">err</span> <span class="k">in</span>
  <span class="n">NSLog</span><span class="p">(</span><span class="s">&quot;Error @% : @%&quot;</span><span class="p">,</span> <span class="n">err</span><span class="p">,</span> <span class="p">(</span><span class="n">err</span> <span class="k">as</span><span class="p">!</span> <span class="n">NakamaError</span><span class="p">).</span><span class="n">message</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>

        </div>
    
        </div>
    
                </div>
                    </p>
<h2 id="remove-records">Remove records<a class="headerlink" href="#remove-records" title="Permanent link">&para;</a></h2>
<p>A user can remove a record if it has the correct permissions and they own it.</p>
<div class="admonition note">
<p class="admonition-title">Soft delete</p>
<p>A record is not permanently deleted from the server when removed. It remains until overwritten but cannot be read by the client. This is useful in case you need to restore a user's records later.</p>
</div>
<p>
                <div class="code-nav-container">
                    
        <ul class="nav nav-tabs">
            
        <li class="nav-item active">
            <a href="#tab-6-csharp" aria-controls="tab-6-csharp" role="tab" data-toggle="tab" data-lang="csharp">Unity</a>
        </li>
    
        <li class="nav-item ">
            <a href="#tab-6-java" aria-controls="tab-6-java" role="tab" data-toggle="tab" data-lang="java">Android/Java</a>
        </li>
    
        <li class="nav-item ">
            <a href="#tab-6-swift" aria-controls="tab-6-swift" role="tab" data-toggle="tab" data-lang="swift">Swift</a>
        </li>
    
        </ul>
    
        <div class="tab-content">
            
        <div role="tabpanel" class="tab-pane active" id="tab-6-csharp">
            <div class="codehilite"><pre><span></span><span class="kt">var</span> <span class="n">message</span> <span class="p">=</span> <span class="k">new</span> <span class="n">NStorageRemoveMessage</span><span class="p">.</span><span class="n">Builder</span><span class="p">()</span>
    <span class="p">.</span><span class="n">Remove</span><span class="p">(</span><span class="s">&quot;myapp&quot;</span><span class="p">,</span> <span class="s">&quot;saves&quot;</span><span class="p">,</span> <span class="s">&quot;savegame&quot;</span><span class="p">)</span>
    <span class="p">.</span><span class="n">Build</span><span class="p">();</span>
<span class="n">client</span><span class="p">.</span><span class="n">Send</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="p">(</span><span class="kt">bool</span> <span class="n">done</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="n">Debug</span><span class="p">.</span><span class="n">Log</span><span class="p">(</span><span class="s">&quot;Removed user&#39;s record(s).&quot;</span><span class="p">);</span>
<span class="p">},</span> <span class="p">(</span><span class="n">INError</span> <span class="n">err</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="n">Debug</span><span class="p">.</span><span class="n">LogErrorFormat</span><span class="p">(</span><span class="s">&quot;Error: code &#39;{0}&#39; with &#39;{1}&#39;.&quot;</span><span class="p">,</span> <span class="n">err</span><span class="p">.</span><span class="n">Code</span><span class="p">,</span> <span class="n">err</span><span class="p">.</span><span class="n">Message</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

        </div>
    
        <div role="tabpanel" class="tab-pane " id="tab-6-java">
            <div class="codehilite"><pre><span></span><span class="n">CollatedMessage</span><span class="o">&lt;</span><span class="n">Boolean</span><span class="o">&gt;</span> <span class="n">message</span> <span class="o">=</span> <span class="n">StorageRemoveMessage</span><span class="o">.</span><span class="na">Builder</span><span class="o">.</span><span class="na">newBuilder</span><span class="o">()</span>
    <span class="o">.</span><span class="na">record</span><span class="o">(</span><span class="s">&quot;myapp&quot;</span><span class="o">,</span> <span class="s">&quot;saves&quot;</span><span class="o">,</span> <span class="s">&quot;savegame&quot;</span><span class="o">)</span>
    <span class="o">.</span><span class="na">build</span><span class="o">();</span>
<span class="n">Deferred</span><span class="o">&lt;</span><span class="n">Boolean</span><span class="o">&gt;</span> <span class="n">deferred</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="na">send</span><span class="o">(</span><span class="n">message</span><span class="o">);</span>
<span class="n">deferred</span><span class="o">.</span><span class="na">addCallback</span><span class="o">(</span><span class="k">new</span> <span class="n">Callback</span><span class="o">&lt;</span><span class="n">Boolean</span><span class="o">,</span> <span class="n">Boolean</span><span class="o">&gt;()</span> <span class="o">{</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="n">Boolean</span> <span class="nf">call</span><span class="o">(</span><span class="n">Boolean</span> <span class="n">done</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Removed user&#39;s record(s).&quot;</span><span class="o">);</span>
    <span class="k">return</span> <span class="n">done</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}).</span><span class="na">addErrback</span><span class="o">(</span><span class="k">new</span> <span class="n">Callback</span><span class="o">&lt;</span><span class="n">Error</span><span class="o">,</span> <span class="n">Error</span><span class="o">&gt;()</span> <span class="o">{</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="n">Error</span> <span class="nf">call</span><span class="o">(</span><span class="n">Error</span> <span class="n">err</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
    <span class="n">System</span><span class="o">.</span><span class="na">err</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">&quot;Error(&#39;%s&#39;, &#39;%s&#39;)&quot;</span><span class="o">,</span> <span class="n">err</span><span class="o">.</span><span class="na">getCode</span><span class="o">(),</span> <span class="n">err</span><span class="o">.</span><span class="na">getMessage</span><span class="o">());</span>
    <span class="k">return</span> <span class="n">err</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">});</span>
</pre></div>

        </div>
    
        <div role="tabpanel" class="tab-pane " id="tab-6-swift">
            <div class="codehilite"><pre><span></span><span class="kd">var</span> <span class="nv">message</span> <span class="p">=</span> <span class="n">StorageRemoveMessage</span><span class="p">()</span>
<span class="n">message</span><span class="p">.</span><span class="n">remove</span><span class="p">(</span><span class="n">bucket</span><span class="p">:</span> <span class="s">&quot;myapp&quot;</span><span class="p">,</span> <span class="n">collection</span><span class="p">:</span> <span class="s">&quot;saves&quot;</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="s">&quot;savegame&quot;</span><span class="p">)</span>
<span class="n">client</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="n">message</span><span class="p">:</span> <span class="n">message</span><span class="p">).</span><span class="n">then</span> <span class="p">{</span>
  <span class="n">NSLog</span><span class="p">(</span><span class="s">&quot;Removed user&#39;s record(s).&quot;</span><span class="p">)</span>
<span class="p">}.</span><span class="k">catch</span> <span class="p">{</span> <span class="n">err</span> <span class="k">in</span>
  <span class="n">NSLog</span><span class="p">(</span><span class="s">&quot;Error @% : @%&quot;</span><span class="p">,</span> <span class="n">err</span><span class="p">,</span> <span class="p">(</span><span class="n">err</span> <span class="k">as</span><span class="p">!</span> <span class="n">NakamaError</span><span class="p">).</span><span class="n">message</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>

        </div>
    
        </div>
    
                </div>
                    </p>
<p>You can also conditionally remove an object if the object version matches the version sent by the client.</p>
<p>
                <div class="code-nav-container">
                    
        <ul class="nav nav-tabs">
            
        <li class="nav-item active">
            <a href="#tab-25-csharp" aria-controls="tab-25-csharp" role="tab" data-toggle="tab" data-lang="csharp">Unity</a>
        </li>
    
        <li class="nav-item ">
            <a href="#tab-25-java" aria-controls="tab-25-java" role="tab" data-toggle="tab" data-lang="java">Android/Java</a>
        </li>
    
        <li class="nav-item ">
            <a href="#tab-25-swift" aria-controls="tab-25-swift" role="tab" data-toggle="tab" data-lang="swift">Swift</a>
        </li>
    
        </ul>
    
        <div class="tab-content">
            
        <div role="tabpanel" class="tab-pane active" id="tab-25-csharp">
            <div class="codehilite"><pre><span></span><span class="kt">byte</span><span class="p">[]</span> <span class="n">version</span> <span class="p">=</span> <span class="n">record</span><span class="p">.</span><span class="n">Version</span><span class="p">;</span> <span class="c1">// an INStorageKey object.</span>

<span class="kt">var</span> <span class="n">message</span> <span class="p">=</span> <span class="k">new</span> <span class="n">NStorageRemoveMessage</span><span class="p">.</span><span class="n">Builder</span><span class="p">()</span>
    <span class="p">.</span><span class="n">Remove</span><span class="p">(</span><span class="s">&quot;myapp&quot;</span><span class="p">,</span> <span class="s">&quot;saves&quot;</span><span class="p">,</span> <span class="s">&quot;savegame&quot;</span><span class="p">,</span> <span class="n">version</span><span class="p">)</span>
    <span class="p">.</span><span class="n">Build</span><span class="p">();</span>
<span class="n">client</span><span class="p">.</span><span class="n">Send</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="p">(</span><span class="kt">bool</span> <span class="n">done</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="n">Debug</span><span class="p">.</span><span class="n">Log</span><span class="p">(</span><span class="s">&quot;Removed user&#39;s record(s).&quot;</span><span class="p">);</span>
<span class="p">},</span> <span class="p">(</span><span class="n">INError</span> <span class="n">err</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="n">Debug</span><span class="p">.</span><span class="n">LogErrorFormat</span><span class="p">(</span><span class="s">&quot;Error: code &#39;{0}&#39; with &#39;{1}&#39;.&quot;</span><span class="p">,</span> <span class="n">err</span><span class="p">.</span><span class="n">Code</span><span class="p">,</span> <span class="n">err</span><span class="p">.</span><span class="n">Message</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

        </div>
    
        <div role="tabpanel" class="tab-pane " id="tab-25-java">
            <div class="codehilite"><pre><span></span><span class="kt">byte</span><span class="o">[]</span> <span class="n">version</span> <span class="o">=</span> <span class="n">record</span><span class="o">.</span><span class="na">getVersion</span><span class="o">();</span> <span class="c1">// a RecordId object&#39;s version.</span>

<span class="n">CollatedMessage</span><span class="o">&lt;</span><span class="n">Boolean</span><span class="o">&gt;</span> <span class="n">message</span> <span class="o">=</span> <span class="n">StorageRemoveMessage</span><span class="o">.</span><span class="na">Builder</span><span class="o">.</span><span class="na">newBuilder</span><span class="o">()</span>
    <span class="o">.</span><span class="na">record</span><span class="o">(</span><span class="s">&quot;myapp&quot;</span><span class="o">,</span> <span class="s">&quot;saves&quot;</span><span class="o">,</span> <span class="s">&quot;savegame&quot;</span><span class="o">,</span> <span class="n">version</span><span class="o">)</span>
    <span class="o">.</span><span class="na">build</span><span class="o">();</span>
<span class="n">Deferred</span><span class="o">&lt;</span><span class="n">Boolean</span><span class="o">&gt;</span> <span class="n">deferred</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="na">send</span><span class="o">(</span><span class="n">message</span><span class="o">);</span>
<span class="n">deferred</span><span class="o">.</span><span class="na">addCallback</span><span class="o">(</span><span class="k">new</span> <span class="n">Callback</span><span class="o">&lt;</span><span class="n">Boolean</span><span class="o">,</span> <span class="n">Boolean</span><span class="o">&gt;()</span> <span class="o">{</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="n">Boolean</span> <span class="nf">call</span><span class="o">(</span><span class="n">Boolean</span> <span class="n">done</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Removed user&#39;s record(s).&quot;</span><span class="o">);</span>
    <span class="k">return</span> <span class="n">done</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}).</span><span class="na">addErrback</span><span class="o">(</span><span class="k">new</span> <span class="n">Callback</span><span class="o">&lt;</span><span class="n">Error</span><span class="o">,</span> <span class="n">Error</span><span class="o">&gt;()</span> <span class="o">{</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="n">Error</span> <span class="nf">call</span><span class="o">(</span><span class="n">Error</span> <span class="n">err</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
    <span class="n">System</span><span class="o">.</span><span class="na">err</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">&quot;Error(&#39;%s&#39;, &#39;%s&#39;)&quot;</span><span class="o">,</span> <span class="n">err</span><span class="o">.</span><span class="na">getCode</span><span class="o">(),</span> <span class="n">err</span><span class="o">.</span><span class="na">getMessage</span><span class="o">());</span>
    <span class="k">return</span> <span class="n">err</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">});</span>
</pre></div>

        </div>
    
        <div role="tabpanel" class="tab-pane " id="tab-25-swift">
            <div class="codehilite"><pre><span></span><span class="kd">let</span> <span class="nv">version</span> <span class="p">=</span> <span class="n">record</span><span class="p">.</span><span class="n">version</span> <span class="c1">// a StorageRecordId object&#39;s version.</span>

<span class="kd">var</span> <span class="nv">message</span> <span class="p">=</span> <span class="n">StorageRemoveMessage</span><span class="p">()</span>
<span class="n">message</span><span class="p">.</span><span class="n">remove</span><span class="p">(</span><span class="n">bucket</span><span class="p">:</span> <span class="s">&quot;myapp&quot;</span><span class="p">,</span> <span class="n">collection</span><span class="p">:</span> <span class="s">&quot;saves&quot;</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="s">&quot;savegame&quot;</span><span class="p">,</span> <span class="n">version</span><span class="p">:</span> <span class="n">version</span><span class="p">)</span>
<span class="n">client</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="n">message</span><span class="p">:</span> <span class="n">message</span><span class="p">).</span><span class="n">then</span> <span class="p">{</span>
  <span class="n">NSLog</span><span class="p">(</span><span class="s">&quot;Removed user&#39;s record(s).&quot;</span><span class="p">)</span>
<span class="p">}.</span><span class="k">catch</span> <span class="p">{</span> <span class="n">err</span> <span class="k">in</span>
  <span class="n">NSLog</span><span class="p">(</span><span class="s">&quot;Error @% : @%&quot;</span><span class="p">,</span> <span class="n">err</span><span class="p">,</span> <span class="p">(</span><span class="n">err</span> <span class="k">as</span><span class="p">!</span> <span class="n">NakamaError</span><span class="p">).</span><span class="n">message</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>

        </div>
    
        </div>
    
                </div>
                    </p>
                
                  
                
              
              
                
              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../user-accounts/" title="User accounts" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                User accounts
              </span>
            </div>
          </a>
        
        
          <a href="../social-friends/" title="Friends" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Friends
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; 2017 Heroic Labs
          </div>
        
        powered by
        <a href="http://www.mkdocs.org" title="MkDocs">MkDocs</a>
        and
        <a href="http://squidfunk.github.io/mkdocs-material/" title="Material for MkDocs">
          Material for MkDocs</a>
      </div>
      
        
  <div class="md-footer-social">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    
      <a href="https://heroiclabs.com" class="md-footer-social__link fa fa-globe"></a>
    
      <a href="https://github.com/heroiclabs" class="md-footer-social__link fa fa-github"></a>
    
      <a href="https://twitter.com/heroicdev" class="md-footer-social__link fa fa-twitter"></a>
    
      <a href="https://www.linkedin.com/company/heroic-labs" class="md-footer-social__link fa fa-linkedin"></a>
    
  </div>

      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/application-c35428f87f.js"></script>
      
      
      <script>app.initialize({url:{base:".."}})</script>
      
        <script src="../js/main.js"></script>
      
    
    
      
    
  </body>
</html>