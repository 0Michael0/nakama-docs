



<!DOCTYPE html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="Documentation for the Nakama realtime and social server for games and apps.">
      
      
        <link rel="canonical" href="https://heroiclabs.com/gameplay-matchmaker/">
      
      
        <meta name="author" content="Heroic Labs Team & contributors">
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../images/favicon.ico">
      <meta name="generator" content="mkdocs-0.17.2, mkdocs-material-2.2.0">
    
    
      
        <title>Matchmaker - Nakama server</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/application.5d3fffba.css">
      
        <link rel="stylesheet" href="../assets/stylesheets/application-palette.fbd935c7.css">
      
    
    
      <script src="../assets/javascripts/modernizr.1aa3b519.js"></script>
    
    
      
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
      <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    
    
      <link rel="stylesheet" href="../stylesheets/code-tabs.css">
    
    
  </head>
  
    
    
    
      <body data-md-color-primary="indigo" data-md-color-accent="indigo">
    
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="drawer">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="search">
    <label class="md-overlay" data-md-component="overlay" for="drawer"></label>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="https://heroiclabs.com/" title="Nakama server" class="md-header-nav__button md-logo">
          
            <img src="../images/logo-white.svg" width="24" height="24">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            
              <span class="md-header-nav__topic">
                Nakama server
              </span>
              <span class="md-header-nav__topic">
                Matchmaker
              </span>
            
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          
            <label class="md-icon md-icon--search md-header-nav__button" for="search"></label>
            
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="search"></label>
  <div class="md-search__inner">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" required placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query">
      <label class="md-icon md-search__icon" for="search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset">&#xE5CD;</button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
          
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  


  <a href="https://github.com/heroiclabs/nakama/" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      heroiclabs/nakama
    </div>
  </a>

          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="drawer">
    <span class="md-nav__button md-logo">
      
        <img src="../images/logo-white.svg" width="24" height="24">
      
    </span>
    Nakama server
  </label>
  
    <div class="md-nav__source">
      


  


  <a href="https://github.com/heroiclabs/nakama/" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      heroiclabs/nakama
    </div>
  </a>

    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../nakama-download/" title="Download" class="md-nav__link">
      Download
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      Install and setup
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        Install and setup
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../install-docker-quickstart/" title="Docker quickstart" class="md-nav__link">
      Docker quickstart
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../install-binary/" title="Binary install" class="md-nav__link">
      Binary install
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../install-configuration/" title="Configuration" class="md-nav__link">
      Configuration
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../install-server-cli/" title="Nakama CLI" class="md-nav__link">
      Nakama CLI
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../install-nakama-upgrade/" title="Upgrades" class="md-nav__link">
      Upgrades
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../unity-client-guide/" title="Unity client guide" class="md-nav__link">
      Unity client guide
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../android-java-client-guide/" title="Android client guide" class="md-nav__link">
      Android client guide
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../javascript-client-guide/" title="JavaScript client guide" class="md-nav__link">
      JavaScript client guide
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../swift-ios-client-guide/" title="Swift/iOS client guide" class="md-nav__link">
      Swift/iOS client guide
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../authentication/" title="Authentication" class="md-nav__link">
      Authentication
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../user-accounts/" title="User accounts" class="md-nav__link">
      User accounts
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-10" type="checkbox" id="nav-10">
    
    <label class="md-nav__link" for="nav-10">
      Storage Engine
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-10">
        Storage Engine
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../storage-collections/" title="Collections" class="md-nav__link">
      Collections
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-11" type="checkbox" id="nav-11">
    
    <label class="md-nav__link" for="nav-11">
      Social
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-11">
        Social
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../social-friends/" title="Friends" class="md-nav__link">
      Friends
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../social-groups-clans/" title="Groups and Clans" class="md-nav__link">
      Groups and Clans
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../social-in-app-notifications/" title="In-app Notifications" class="md-nav__link">
      In-app Notifications
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../social-realtime-chat/" title="Realtime Chat" class="md-nav__link">
      Realtime Chat
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-12" type="checkbox" id="nav-12" checked>
    
    <label class="md-nav__link" for="nav-12">
      Gameplay
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-12">
        Gameplay
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../gameplay-leaderboards/" title="Leaderboards" class="md-nav__link">
      Leaderboards
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="toc">
        Matchmaker
      </label>
    
    <a href="./" title="Matchmaker" class="md-nav__link md-nav__link--active">
      Matchmaker
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#properties-and-filters" title="Properties and filters" class="md-nav__link">
    Properties and filters
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#request-opponents" title="Request opponents" class="md-nav__link">
    Request opponents
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#receive-matchmake-results" title="Receive matchmake results" class="md-nav__link">
    Receive matchmake results
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#advanced-matchmaking" title="Advanced matchmaking" class="md-nav__link">
    Advanced matchmaking
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#using-term-filters" title="Using term filters" class="md-nav__link">
    Using term filters
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#using-range-filters" title="Using range filters" class="md-nav__link">
    Using range filters
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#multi-filter-matchmaking" title="Multi-filter matchmaking" class="md-nav__link">
    Multi-filter matchmaking
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cancel-a-request" title="Cancel a request" class="md-nav__link">
    Cancel a request
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#join-a-match" title="Join a match" class="md-nav__link">
    Join a match
  </a>
  
</li>
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../gameplay-multiplayer-realtime/" title="Realtime Multiplayer" class="md-nav__link">
      Realtime Multiplayer
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../in-app-purchase-validation/" title="In-app Purchase Validation" class="md-nav__link">
      In-app Purchase Validation
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-14" type="checkbox" id="nav-14">
    
    <label class="md-nav__link" for="nav-14">
      Runtime Code
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-14">
        Runtime Code
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../runtime-code-basics/" title="Basics" class="md-nav__link">
      Basics
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../runtime-code-function-reference/" title="Function Reference" class="md-nav__link">
      Function Reference
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../benchmarks/" title="Benchmarks" class="md-nav__link">
      Benchmarks
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-16" type="checkbox" id="nav-16">
    
    <label class="md-nav__link" for="nav-16">
      Deployment
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-16">
        Deployment
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../deployment-digital-ocean/" title="Digital Ocean" class="md-nav__link">
      Digital Ocean
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-17" type="checkbox" id="nav-17">
    
    <label class="md-nav__link" for="nav-17">
      Tutorials
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-17">
        Tutorials
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../tutorial-develop-with-libgdx/" title="Develop with LibGDX" class="md-nav__link">
      Develop with LibGDX
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../tutorial-initialize-new-user/" title="Initialize a new user" class="md-nav__link">
      Initialize a new user
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../tutorial-remote-configuration/" title="Remote configuration" class="md-nav__link">
      Remote configuration
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../tutorial-send-push-messages/" title="Send push messages" class="md-nav__link">
      Send push messages
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#properties-and-filters" title="Properties and filters" class="md-nav__link">
    Properties and filters
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#request-opponents" title="Request opponents" class="md-nav__link">
    Request opponents
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#receive-matchmake-results" title="Receive matchmake results" class="md-nav__link">
    Receive matchmake results
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#advanced-matchmaking" title="Advanced matchmaking" class="md-nav__link">
    Advanced matchmaking
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#using-term-filters" title="Using term filters" class="md-nav__link">
    Using term filters
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#using-range-filters" title="Using range filters" class="md-nav__link">
    Using range filters
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#multi-filter-matchmaking" title="Multi-filter matchmaking" class="md-nav__link">
    Multi-filter matchmaking
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cancel-a-request" title="Cancel a request" class="md-nav__link">
    Cancel a request
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#join-a-match" title="Join a match" class="md-nav__link">
    Join a match
  </a>
  
</li>
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/heroiclabs/nakama/edit/master/docs/gameplay-matchmaker.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="matchmaker">Matchmaker<a class="headerlink" href="#matchmaker" title="Permanent link">&para;</a></h1>
<p>In realtime and turn-based games it's important to be able to find active opponents to play against. A matchmaker system is designed to provide this kind of behavior.</p>
<p>In the server we've taken the design further and decoupled how you're matched from the realtime multiplayer engine. This makes it easy to use the matchmaker system to find opponents even if the gameplay isn't realtime. It could be a casual social game where you want to find random new users to become friends with or an asynchronous PvP game where gameplay happens in a simulated battle.</p>
<p>The matchmaker receives and tracks matchmaking requests, then groups users together based on the criteria they've expressed in their properties and filters.</p>
<h2 id="properties-and-filters">Properties and filters<a class="headerlink" href="#properties-and-filters" title="Permanent link">&para;</a></h2>
<p>The matchmaking system has the concept of <strong>Properties</strong> and <strong>Filters</strong>, which clients send to the server to decide how their teammates or opponents are selected.</p>
<p><strong>Properties</strong> are key-value pairs that describe the user's state in the game. Rank information, connecting region information, or selected match types are good examples of data that should be stored in Properties. When matchmaking completes these properties are visible to the matched users, so if needed you can store extra information without affecting the matchmaking process itself if it's useful to clients.</p>
<p>These properties define information about the user. Good examples of properties are "skill rating = 150" or "player level = 20".</p>
<p><strong>Filters</strong> are criteria definitions the server will check against the properties of other users in the matchmaking pool. These determine if the user would accept being matched with others.</p>
<p>Filters define information about how the user wants their matched users to be selected. Good examples of filters are "skill rating 100 to 200" or "player level 15 to 25" indicating the user is looking for others that have properties in the given ranges.</p>
<p>The matchmaker can filter users using 4 different filtering criteria:</p>
<ul>
<li>User Count: The exact number of total users required to form a match. This is a required parameter that determines when the matchmaking algorithm has found enough users to satisfy the matchmaking request.</li>
<li>Term Filter: String terms that must match. You can set this filter to match any of the supplied terms, or all the terms.</li>
<li>Numeric Range Filter: An integer filter with lowerbound and upperbound requirements. If the property value is not within the specified range, the user is filtered out.</li>
<li>Boolean check filters: A simple boolean check.</li>
</ul>
<p>A matchmaking request can have complex criteria by using a combination of these filters. Once the matchmaker is successful, the properties and filters of each matched user will be redistributed to every matched user.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>The <a href="#advanced-matchmaking">Advanced matchmaking</a> section has details on how each filter type works and how to compose filters to achieve complex matchmaking rules.</p>
</div>
<h2 id="request-opponents">Request opponents<a class="headerlink" href="#request-opponents" title="Permanent link">&para;</a></h2>
<p>The server maintains a pool of users who've requested to be matched together with a specific number of opponents and each user's properties and filters if specified. Each user can add themselves to the matchmaker pool and register an event handler to be notified when enough users meet their criteria to be matched.</p>
<p>You can send a message to add the user to the matchmaker pool.</p>
<p>
                <div class="code-nav-container">
                    
        <ul class="nav nav-tabs">
            
        <li class="nav-item active">
            <a href="#tab-0-csharp" aria-controls="tab-0-csharp" role="tab" data-toggle="tab" data-lang="csharp">Unity</a>
        </li>
    
        <li class="nav-item ">
            <a href="#tab-0-js" aria-controls="tab-0-js" role="tab" data-toggle="tab" data-lang="js">Javascript</a>
        </li>
    
        </ul>
    
        <div class="tab-content">
            
        <div role="tabpanel" class="tab-pane active" id="tab-0-csharp">
            <div class="codehilite"><pre><span></span><span class="n">INMatchmakeTicket</span> <span class="n">matchmake</span> <span class="p">=</span> <span class="k">null</span><span class="p">;</span>

<span class="c1">// Look for a match for two participants. Yourself and one more.</span>
<span class="kt">var</span> <span class="n">message</span> <span class="p">=</span> <span class="n">NMatchmakeAddMessage</span><span class="p">.</span><span class="n">Default</span><span class="p">(</span><span class="m">2</span><span class="p">);</span>
<span class="n">client</span><span class="p">.</span><span class="n">Send</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="p">(</span><span class="n">INMatchmakeTicket</span> <span class="n">result</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="n">Debug</span><span class="p">.</span><span class="n">Log</span><span class="p">(</span><span class="s">&quot;Added user to matchmaker pool.&quot;</span><span class="p">);</span>

  <span class="kt">var</span> <span class="n">cancelTicket</span> <span class="p">=</span> <span class="n">result</span><span class="p">.</span><span class="n">Ticket</span><span class="p">;</span>
  <span class="n">Debug</span><span class="p">.</span><span class="n">LogFormat</span><span class="p">(</span><span class="s">&quot;The cancellation code {0}&quot;</span><span class="p">,</span> <span class="n">cancelTicket</span><span class="p">);</span>
<span class="p">},</span> <span class="p">(</span><span class="n">INError</span> <span class="n">err</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="n">Debug</span><span class="p">.</span><span class="n">LogErrorFormat</span><span class="p">(</span><span class="s">&quot;Error: code &#39;{0}&#39; with &#39;{1}&#39;.&quot;</span><span class="p">,</span> <span class="n">err</span><span class="p">.</span><span class="n">Code</span><span class="p">,</span> <span class="n">err</span><span class="p">.</span><span class="n">Message</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

        </div>
    
        <div role="tabpanel" class="tab-pane " id="tab-0-js">
            <div class="codehilite"><pre><span></span><span class="kd">var</span> <span class="nx">matchmakeTicket</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>

<span class="c1">// Look for a match for two participants. Yourself and one more.</span>
<span class="kd">var</span> <span class="nx">message</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">nakamajs</span><span class="p">.</span><span class="nx">MatchmakeAddRequest</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
<span class="nx">client</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">message</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">ticket</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Added user to matchmaker pool.&quot;</span><span class="p">);</span>
  <span class="nx">matchmakeTicket</span> <span class="o">=</span> <span class="nx">ticket</span><span class="p">.</span><span class="nx">ticket</span><span class="p">;</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;The cancellation ticket is %o&quot;</span><span class="p">,</span> <span class="nx">matchmakeTicket</span><span class="p">);</span>
<span class="p">}).</span><span class="k">catch</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">error</span><span class="p">){</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;An error occured: %o&quot;</span><span class="p">,</span> <span class="nx">error</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

        </div>
    
        </div>
    
                </div>
                    </p>
<p>The message returns a ticket which can be used to cancel the matchmake attempt. A user can remove themselves from the pool if wanted. This is useful for some games where a user can cancel their action to matchmake at some later point and remove themselves being matched with other users.</p>
<p>Have a look at <a href="#advanced-matchmaking">this section</a> for more advanced matchmaking examples.</p>
<h3 id="receive-matchmake-results">Receive matchmake results<a class="headerlink" href="#receive-matchmake-results" title="Permanent link">&para;</a></h3>
<p>You can register an event handler which is called when the server has found opponents for the user.</p>
<p>
                <div class="code-nav-container">
                    
        <ul class="nav nav-tabs">
            
        <li class="nav-item active">
            <a href="#tab-1-csharp" aria-controls="tab-1-csharp" role="tab" data-toggle="tab" data-lang="csharp">Unity</a>
        </li>
    
        <li class="nav-item ">
            <a href="#tab-1-js" aria-controls="tab-1-js" role="tab" data-toggle="tab" data-lang="js">Javascript</a>
        </li>
    
        </ul>
    
        <div class="tab-content">
            
        <div role="tabpanel" class="tab-pane active" id="tab-1-csharp">
            <div class="codehilite"><pre><span></span><span class="n">client</span><span class="p">.</span><span class="n">OnMatchmakeMatched</span> <span class="p">=</span> <span class="p">(</span><span class="n">INMatchmakeMatched</span> <span class="n">matched</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="c1">// a match token is used to join the match.</span>
  <span class="n">Debug</span><span class="p">.</span><span class="n">LogFormat</span><span class="p">(</span><span class="s">&quot;Match token: &#39;{0}&#39;&quot;</span><span class="p">,</span> <span class="n">matched</span><span class="p">.</span><span class="n">Token</span><span class="p">);</span>

  <span class="c1">// a list of users who&#39;ve been matched as opponents.</span>
  <span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">presence</span> <span class="k">in</span> <span class="n">matched</span><span class="p">.</span><span class="n">Presence</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">Debug</span><span class="p">.</span><span class="n">LogFormat</span><span class="p">(</span><span class="s">&quot;User id: &#39;{0}&#39;.&quot;</span><span class="p">,</span> <span class="n">presence</span><span class="p">.</span><span class="n">UserId</span><span class="p">);</span>
    <span class="n">Debug</span><span class="p">.</span><span class="n">LogFormat</span><span class="p">(</span><span class="s">&quot;User handle: &#39;{0}&#39;.&quot;</span><span class="p">,</span> <span class="n">presence</span><span class="p">.</span><span class="n">Handle</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="c1">// list of all match properties</span>
  <span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">userProperty</span> <span class="k">in</span> <span class="n">matched</span><span class="p">.</span><span class="n">UserProperties</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">foreach</span><span class="p">(</span><span class="n">KeyValuePair</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">,</span> <span class="kt">string</span><span class="p">&gt;</span> <span class="n">entry</span> <span class="k">in</span> <span class="n">userProperty</span><span class="p">.</span><span class="n">Properties</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">Debug</span><span class="p">.</span><span class="n">LogFormat</span><span class="p">(</span><span class="s">&quot;Property &#39;{0}&#39; for user &#39;{1}&#39; has value &#39;{2}&#39;.&quot;</span><span class="p">,</span> <span class="n">entry</span><span class="p">.</span><span class="n">Key</span><span class="p">,</span> <span class="n">userProperty</span><span class="p">.</span><span class="n">Id</span><span class="p">,</span> <span class="n">entry</span><span class="p">.</span><span class="n">Value</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">foreach</span><span class="p">(</span><span class="n">KeyValuePair</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">,</span> <span class="n">INMatchmakeFilter</span><span class="p">&gt;</span> <span class="n">entry</span> <span class="k">in</span> <span class="n">userProperty</span><span class="p">.</span><span class="n">Filters</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">Debug</span><span class="p">.</span><span class="n">LogFormat</span><span class="p">(</span><span class="s">&quot;Filter &#39;{0}&#39; for user &#39;{1}&#39; has value &#39;{2}&#39;.&quot;</span><span class="p">,</span> <span class="n">entry</span><span class="p">.</span><span class="n">Key</span><span class="p">,</span> <span class="n">userProperty</span><span class="p">.</span><span class="n">Id</span><span class="p">,</span> <span class="n">entry</span><span class="p">.</span><span class="n">Value</span><span class="p">.</span><span class="n">ToString</span><span class="p">());</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">};</span>
</pre></div>

        </div>
    
        <div role="tabpanel" class="tab-pane " id="tab-1-js">
            <div class="codehilite"><pre><span></span><span class="nx">client</span><span class="p">.</span><span class="nx">onmatchmakematched</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">matched</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// a match token is used to join the match.</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Match token: %o&quot;</span><span class="p">,</span> <span class="nx">matched</span><span class="p">.</span><span class="nx">token</span><span class="p">);</span>

  <span class="c1">// a list of users who&#39;ve been matched as opponents.</span>
  <span class="nx">matched</span><span class="p">.</span><span class="nx">presences</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">presence</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;User id: %o.&quot;</span><span class="p">,</span> <span class="nx">presence</span><span class="p">.</span><span class="nx">userId</span><span class="p">);</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;User handle: %o.&quot;</span><span class="p">,</span> <span class="nx">presence</span><span class="p">.</span><span class="nx">handle</span><span class="p">);</span>
  <span class="p">});</span>

  <span class="c1">// list of all match properties</span>
  <span class="nx">matched</span><span class="p">.</span><span class="nx">properties</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">property</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;User %o has properties: %o&quot;</span><span class="p">,</span> <span class="nx">property</span><span class="p">.</span><span class="nx">userId</span><span class="p">,</span> <span class="nx">property</span><span class="p">.</span><span class="nx">properties</span><span class="p">);</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;User %o has filter: %o&quot;</span><span class="p">,</span> <span class="nx">property</span><span class="p">.</span><span class="nx">userId</span><span class="p">,</span> <span class="nx">property</span><span class="p">.</span><span class="nx">filters</span><span class="p">);</span>
  <span class="p">});</span>
<span class="p">};</span>
</pre></div>

        </div>
    
        </div>
    
                </div>
                    </p>
<h2 id="advanced-matchmaking">Advanced matchmaking<a class="headerlink" href="#advanced-matchmaking" title="Permanent link">&para;</a></h2>
<p>In the example above, only the required user count was set. This is the most loose matchmaking request that will select users randomly. Below we'll look at more complex matchmaking requests and how they are represented in Nakama.</p>
<p>We'll use a popular car racing game as an example to demonstrate how matchmaking can be set up. In this game a player can play as a cop or a racer, and has two different ranks based on whichever character they play. The player can have a custom car with specific boosters which other players will need to know about.</p>
<h3 id="using-term-filters">Using term filters<a class="headerlink" href="#using-term-filters" title="Permanent link">&para;</a></h3>
<p>Term filters use one or more string terms as matching criteria. This is useful to match users who are all interested in certain game types, only want to play certain maps, or battle opponents with specific characteristics.</p>
<p>
                <div class="code-nav-container">
                    
        <ul class="nav nav-tabs">
            
        <li class="nav-item active">
            <a href="#tab-2-csharp" aria-controls="tab-2-csharp" role="tab" data-toggle="tab" data-lang="csharp">Unity</a>
        </li>
    
        <li class="nav-item ">
            <a href="#tab-2-js" aria-controls="tab-2-js" role="tab" data-toggle="tab" data-lang="js">Javascript</a>
        </li>
    
        </ul>
    
        <div class="tab-content">
            
        <div role="tabpanel" class="tab-pane active" id="tab-2-csharp">
            <div class="codehilite"><pre><span></span><span class="c1">// Look for a match for 8 participants. Yourself and 7 more.</span>
<span class="kt">var</span> <span class="n">message</span> <span class="p">=</span> <span class="k">new</span> <span class="n">NMatchmakeAddMessage</span><span class="p">.</span><span class="n">Builder</span><span class="p">(</span><span class="m">8</span><span class="p">);</span>

<span class="c1">// Set player&#39;s properties.</span>
<span class="c1">// Whitelist of maps that the player is willing to play.</span>
<span class="n">message</span><span class="p">.</span><span class="n">AddProperty</span><span class="p">(</span><span class="s">&quot;interested-maps&quot;</span><span class="p">,</span> <span class="k">new</span> <span class="n">HashSet</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;</span> <span class="p">{</span><span class="s">&quot;vegas&quot;</span><span class="p">,</span> <span class="s">&quot;downtown-la&quot;</span><span class="p">});</span>

<span class="c1">// This player is playing as a &quot;cop&quot;.</span>
<span class="n">message</span><span class="p">.</span><span class="n">AddProperty</span><span class="p">(</span><span class="s">&quot;player-type&quot;</span><span class="p">,</span> <span class="k">new</span> <span class="n">HashSet</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;</span> <span class="p">{</span><span class="s">&quot;cop&quot;</span><span class="p">});</span>

<span class="c1">// This player&#39;s car boosters - this is only used as extra metadata information.</span>
<span class="n">message</span><span class="p">.</span><span class="n">AddProperty</span><span class="p">(</span><span class="s">&quot;car-boosters&quot;</span><span class="p">,</span> <span class="k">new</span> <span class="n">HashSet</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;</span> <span class="p">{</span><span class="s">&quot;bullets&quot;</span><span class="p">,</span> <span class="s">&quot;spikes&quot;</span><span class="p">,</span> <span class="s">&quot;emp-shockwave&quot;</span><span class="p">});</span>

<span class="c1">// Let&#39;s add the matchmaking criteria.</span>
<span class="c1">// Whitelist of maps that the opponents must be willing to play.</span>
<span class="n">message</span><span class="p">.</span><span class="n">AddTermFilter</span><span class="p">(</span><span class="s">&quot;interested-maps&quot;</span><span class="p">,</span> <span class="k">new</span> <span class="n">HashSet</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;</span> <span class="p">{</span><span class="s">&quot;vegas&quot;</span><span class="p">,</span> <span class="s">&quot;downtown-la&quot;</span><span class="p">,</span> <span class="s">&quot;santa-cruz&quot;</span><span class="p">},</span> <span class="k">false</span><span class="p">);</span>

<span class="c1">// The player wants to only play with racers.</span>
<span class="n">message</span><span class="p">.</span><span class="n">AddTermFilter</span><span class="p">(</span><span class="s">&quot;player-type&quot;</span><span class="p">,</span> <span class="k">new</span> <span class="n">HashSet</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;</span> <span class="p">{</span><span class="s">&quot;racer&quot;</span><span class="p">},</span> <span class="k">true</span><span class="p">);</span>

<span class="n">client</span><span class="p">.</span><span class="n">Send</span><span class="p">(</span><span class="n">message</span><span class="p">.</span><span class="n">Build</span><span class="p">(),</span> <span class="p">(</span><span class="n">INMatchmakeTicket</span> <span class="n">ticket</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="c1">//... save ticket for later cancellation, if needed.</span>
<span class="p">},</span> <span class="p">(</span><span class="n">INError</span> <span class="n">err</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="n">Debug</span><span class="p">.</span><span class="n">LogErrorFormat</span><span class="p">(</span><span class="s">&quot;Error: code &#39;{0}&#39; with &#39;{1}&#39;.&quot;</span><span class="p">,</span> <span class="n">err</span><span class="p">.</span><span class="n">Code</span><span class="p">,</span> <span class="n">err</span><span class="p">.</span><span class="n">Message</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

        </div>
    
        <div role="tabpanel" class="tab-pane " id="tab-2-js">
            <div class="codehilite"><pre><span></span><span class="c1">// Look for a match for 8 participants. Yourself and 7 more.</span>
<span class="kd">var</span> <span class="nx">message</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">nakamajs</span><span class="p">.</span><span class="nx">MatchmakeAddRequest</span><span class="p">(</span><span class="mi">8</span><span class="p">);</span>

<span class="c1">// Set player&#39;s properties.</span>
<span class="c1">// Whitelist of maps that the player is willing to play.</span>
<span class="nx">message</span><span class="p">.</span><span class="nx">addStringSetProperty</span><span class="p">(</span><span class="s2">&quot;interested-maps&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;vegas&quot;</span><span class="p">,</span> <span class="s2">&quot;downtown-la&quot;</span><span class="p">]);</span>

<span class="c1">// This player is playing as a &quot;cop&quot;.</span>
<span class="nx">message</span><span class="p">.</span><span class="nx">addStringSetProperty</span><span class="p">(</span><span class="s2">&quot;player-type&quot;</span><span class="p">,</span> <span class="s2">&quot;cop&quot;</span><span class="p">);</span>

<span class="c1">// This player&#39;s car boosters - this is only used as extra metadata information.</span>
<span class="nx">message</span><span class="p">.</span><span class="nx">addStringSetProperty</span><span class="p">(</span><span class="s2">&quot;car-boosters&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;bullets&quot;</span><span class="p">,</span> <span class="s2">&quot;spikes&quot;</span><span class="p">,</span> <span class="s2">&quot;emp-shockwave&quot;</span><span class="p">]);</span>

<span class="c1">// Let&#39;s add the matchmaking criteria.</span>
<span class="c1">// Whitelist of maps that the opponents must be willing to play.</span>
<span class="nx">message</span><span class="p">.</span><span class="nx">addTermFilter</span><span class="p">(</span><span class="s2">&quot;interested-maps&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;vegas&quot;</span><span class="p">,</span> <span class="s2">&quot;downtown-la&quot;</span><span class="p">,</span> <span class="s2">&quot;santa-cruz&quot;</span><span class="p">],</span> <span class="kc">false</span><span class="p">);</span>

<span class="c1">// The player wants to only play with racers.</span>
<span class="nx">message</span><span class="p">.</span><span class="nx">addTermFilter</span><span class="p">(</span><span class="s2">&quot;player-type&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;racer&quot;</span><span class="p">],</span> <span class="kc">true</span><span class="p">);</span>

<span class="nx">client</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">message</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">ticket</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">//... save ticket for later cancellation, if needed.</span>
<span class="p">}).</span><span class="k">catch</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">error</span><span class="p">){</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;An error occured: %o&quot;</span><span class="p">,</span> <span class="nx">error</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

        </div>
    
        </div>
    
                </div>
                    </p>
<h3 id="using-range-filters">Using range filters<a class="headerlink" href="#using-range-filters" title="Permanent link">&para;</a></h3>
<p>Range filters operate on an inclusive lowerbound and an inclusive upperbound integer. The property should be within the two numbers for the matchmaking candidate to be considered.</p>
<p>
                <div class="code-nav-container">
                    
        <ul class="nav nav-tabs">
            
        <li class="nav-item active">
            <a href="#tab-3-csharp" aria-controls="tab-3-csharp" role="tab" data-toggle="tab" data-lang="csharp">Unity</a>
        </li>
    
        <li class="nav-item ">
            <a href="#tab-3-js" aria-controls="tab-3-js" role="tab" data-toggle="tab" data-lang="js">Javascript</a>
        </li>
    
        </ul>
    
        <div class="tab-content">
            
        <div role="tabpanel" class="tab-pane active" id="tab-3-csharp">
            <div class="codehilite"><pre><span></span><span class="c1">// Look for a match for 2 participants. Yourself and someone else.</span>
<span class="kt">var</span> <span class="n">message</span> <span class="p">=</span> <span class="k">new</span> <span class="n">NMatchmakeAddMessage</span><span class="p">.</span><span class="n">Builder</span><span class="p">(</span><span class="m">2</span><span class="p">);</span>

<span class="c1">// Set the player&#39;s cop rank.</span>
<span class="n">message</span><span class="p">.</span><span class="n">AddProperty</span><span class="p">(</span><span class="s">&quot;cop-rank&quot;</span><span class="p">,</span> <span class="m">12</span><span class="p">);</span>
<span class="n">message</span><span class="p">.</span><span class="n">AddProperty</span><span class="p">(</span><span class="s">&quot;racer-rank&quot;</span><span class="p">,</span> <span class="m">41</span><span class="p">);</span>

<span class="c1">// Look for players with between given ranks, to ensure the match is fair.</span>
<span class="n">message</span><span class="p">.</span><span class="n">AddRangeFilter</span><span class="p">(</span><span class="s">&quot;cop-rank&quot;</span><span class="p">,</span> <span class="m">8</span><span class="p">,</span> <span class="m">12</span><span class="p">);</span>
<span class="n">message</span><span class="p">.</span><span class="n">AddRangeFilter</span><span class="p">(</span><span class="s">&quot;racer-rank&quot;</span><span class="p">,</span> <span class="m">30</span><span class="p">,</span> <span class="m">50</span><span class="p">);</span>

<span class="n">client</span><span class="p">.</span><span class="n">Send</span><span class="p">(</span><span class="n">message</span><span class="p">.</span><span class="n">Build</span><span class="p">(),</span> <span class="p">(</span><span class="n">INMatchmakeTicket</span> <span class="n">ticket</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="c1">// ... save ticket for later cancellation, if needed.</span>
<span class="p">},</span> <span class="p">(</span><span class="n">INError</span> <span class="n">err</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="n">Debug</span><span class="p">.</span><span class="n">LogErrorFormat</span><span class="p">(</span><span class="s">&quot;Error: code &#39;{0}&#39; with &#39;{1}&#39;.&quot;</span><span class="p">,</span> <span class="n">err</span><span class="p">.</span><span class="n">Code</span><span class="p">,</span> <span class="n">err</span><span class="p">.</span><span class="n">Message</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

        </div>
    
        <div role="tabpanel" class="tab-pane " id="tab-3-js">
            <div class="codehilite"><pre><span></span><span class="c1">// Look for a match for 2 participants. Yourself and someone else.</span>
<span class="kd">var</span> <span class="nx">message</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">nakamajs</span><span class="p">.</span><span class="nx">MatchmakeAddRequest</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>

<span class="c1">// Set the player&#39;s cop rank.</span>
<span class="nx">message</span><span class="p">.</span><span class="nx">addIntegerProperty</span><span class="p">(</span><span class="s2">&quot;cop-rank&quot;</span><span class="p">,</span> <span class="mi">12</span><span class="p">);</span>
<span class="nx">message</span><span class="p">.</span><span class="nx">addIntegerProperty</span><span class="p">(</span><span class="s2">&quot;racer-rank&quot;</span><span class="p">,</span> <span class="mi">41</span><span class="p">);</span>

<span class="c1">// Look for players with between given ranks, to ensure the match is fair.</span>
<span class="nx">message</span><span class="p">.</span><span class="nx">addRangeFilter</span><span class="p">(</span><span class="s2">&quot;cop-rank&quot;</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">12</span><span class="p">);</span>
<span class="nx">message</span><span class="p">.</span><span class="nx">addRangeFilter</span><span class="p">(</span><span class="s2">&quot;racer-rank&quot;</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">50</span><span class="p">);</span>

<span class="nx">client</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">message</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">ticket</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">//... save ticket for later cancellation, if needed.</span>
<span class="p">}).</span><span class="k">catch</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">error</span><span class="p">){</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;An error occured: %o&quot;</span><span class="p">,</span> <span class="nx">error</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

        </div>
    
        </div>
    
                </div>
                    </p>
<h3 id="multi-filter-matchmaking">Multi-filter matchmaking<a class="headerlink" href="#multi-filter-matchmaking" title="Permanent link">&para;</a></h3>
<p>You can of course mix and match various filters to enhance the matchmaking search.</p>
<p>
                <div class="code-nav-container">
                    
        <ul class="nav nav-tabs">
            
        <li class="nav-item active">
            <a href="#tab-4-csharp" aria-controls="tab-4-csharp" role="tab" data-toggle="tab" data-lang="csharp">Unity</a>
        </li>
    
        <li class="nav-item ">
            <a href="#tab-4-js" aria-controls="tab-4-js" role="tab" data-toggle="tab" data-lang="js">Javascript</a>
        </li>
    
        </ul>
    
        <div class="tab-content">
            
        <div role="tabpanel" class="tab-pane active" id="tab-4-csharp">
            <div class="codehilite"><pre><span></span><span class="c1">// Look for a match for 4 participants. Yourself and 3 other users.</span>
<span class="kt">var</span> <span class="n">message</span> <span class="p">=</span> <span class="k">new</span> <span class="n">NMatchmakeAddMessage</span><span class="p">.</span><span class="n">Builder</span><span class="p">(</span><span class="m">4</span><span class="p">);</span>

<span class="c1">// This player is playing as a &quot;cop&quot;.</span>
<span class="n">message</span><span class="p">.</span><span class="n">AddProperty</span><span class="p">(</span><span class="s">&quot;player-type&quot;</span><span class="p">,</span> <span class="k">new</span> <span class="n">HashSet</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;</span> <span class="p">{</span><span class="s">&quot;cop&quot;</span><span class="p">});</span>

<span class="c1">// Set the player&#39;s ranks.</span>
<span class="n">message</span><span class="p">.</span><span class="n">AddProperty</span><span class="p">(</span><span class="s">&quot;cop-rank&quot;</span><span class="p">,</span> <span class="m">12</span><span class="p">);</span>
<span class="n">message</span><span class="p">.</span><span class="n">AddProperty</span><span class="p">(</span><span class="s">&quot;racer-rank&quot;</span><span class="p">,</span> <span class="m">41</span><span class="p">);</span>

<span class="c1">// Set a boolean property on whether the player has prestiged or not.</span>
<span class="n">message</span><span class="p">.</span><span class="n">AddProperty</span><span class="p">(</span><span class="s">&quot;has-prestiged&quot;</span><span class="p">,</span> <span class="k">true</span><span class="p">);</span>

<span class="c1">// The player wants to only play with either racers or cops.</span>
<span class="n">message</span><span class="p">.</span><span class="n">AddTermFilter</span><span class="p">(</span><span class="s">&quot;player-type&quot;</span><span class="p">,</span> <span class="k">new</span> <span class="n">HashSet</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;</span> <span class="p">{</span><span class="s">&quot;racer&quot;</span><span class="p">,</span> <span class="s">&quot;cop&quot;</span><span class="p">},</span> <span class="k">false</span><span class="p">);</span>

<span class="c1">// Look for players with between two ranks, to ensure the match is fair.</span>
<span class="n">message</span><span class="p">.</span><span class="n">AddRangeFilter</span><span class="p">(</span><span class="s">&quot;cop-rank&quot;</span><span class="p">,</span> <span class="m">8</span><span class="p">,</span> <span class="m">12</span><span class="p">);</span>
<span class="n">message</span><span class="p">.</span><span class="n">AddRangeFilter</span><span class="p">(</span><span class="s">&quot;racer-rank&quot;</span><span class="p">,</span> <span class="m">40</span><span class="p">,</span> <span class="m">45</span><span class="p">);</span>

<span class="c1">// Look only for players that have prestiged.</span>
<span class="n">message</span><span class="p">.</span><span class="n">AddCheckFilter</span><span class="p">(</span><span class="s">&quot;has-prestiged&quot;</span><span class="p">,</span> <span class="k">true</span><span class="p">)</span>

<span class="n">client</span><span class="p">.</span><span class="n">Send</span><span class="p">(</span><span class="n">message</span><span class="p">.</span><span class="n">Build</span><span class="p">(),</span> <span class="p">(</span><span class="n">INMatchmakeTicket</span> <span class="n">ticket</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="c1">//... save ticket for later cancellation, if needed.</span>
<span class="p">},</span> <span class="p">(</span><span class="n">INError</span> <span class="n">err</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="n">Debug</span><span class="p">.</span><span class="n">LogErrorFormat</span><span class="p">(</span><span class="s">&quot;Error: code &#39;{0}&#39; with &#39;{1}&#39;.&quot;</span><span class="p">,</span> <span class="n">err</span><span class="p">.</span><span class="n">Code</span><span class="p">,</span> <span class="n">err</span><span class="p">.</span><span class="n">Message</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

        </div>
    
        <div role="tabpanel" class="tab-pane " id="tab-4-js">
            <div class="codehilite"><pre><span></span><span class="c1">// Look for a match for 3 participants. Yourself and 3 more.</span>
<span class="kd">var</span> <span class="nx">message</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">nakamajs</span><span class="p">.</span><span class="nx">MatchmakeAddRequest</span><span class="p">(</span><span class="mi">4</span><span class="p">);</span>

<span class="c1">// This player is playing as a &quot;cop&quot;.</span>
<span class="nx">message</span><span class="p">.</span><span class="nx">addStringSetProperty</span><span class="p">(</span><span class="s2">&quot;player-type&quot;</span><span class="p">,</span> <span class="s2">&quot;cop&quot;</span><span class="p">);</span>

<span class="c1">// Set the player&#39;s ranks.</span>
<span class="nx">message</span><span class="p">.</span><span class="nx">addIntegerProperty</span><span class="p">(</span><span class="s2">&quot;cop-rank&quot;</span><span class="p">,</span> <span class="mi">12</span><span class="p">);</span>
<span class="nx">message</span><span class="p">.</span><span class="nx">addIntegerProperty</span><span class="p">(</span><span class="s2">&quot;racer-rank&quot;</span><span class="p">,</span> <span class="mi">41</span><span class="p">);</span>

<span class="c1">// Set a boolean property on whether the player has prestiged or not.</span>
<span class="nx">message</span><span class="p">.</span><span class="nx">addBooleanProperty</span><span class="p">(</span><span class="s2">&quot;has-prestiged&quot;</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>

<span class="c1">// The player wants to only play with either racers or cops.</span>
<span class="nx">message</span><span class="p">.</span><span class="nx">addTermFilter</span><span class="p">(</span><span class="s2">&quot;player-type&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;racer&quot;</span><span class="p">,</span> <span class="s2">&quot;cop&quot;</span><span class="p">],</span> <span class="kc">false</span><span class="p">);</span>

<span class="c1">// Look for players with between two ranks, to ensure the match is fair.</span>
<span class="nx">message</span><span class="p">.</span><span class="nx">addRangeFilter</span><span class="p">(</span><span class="s2">&quot;cop-rank&quot;</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">12</span><span class="p">);</span>
<span class="nx">message</span><span class="p">.</span><span class="nx">addRangeFilter</span><span class="p">(</span><span class="s2">&quot;racer-rank&quot;</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">45</span><span class="p">);</span>

<span class="c1">// Look only for players that have prestiged.</span>
<span class="nx">message</span><span class="p">.</span><span class="nx">addCheckFilter</span><span class="p">(</span><span class="s2">&quot;has-prestiged&quot;</span><span class="p">,</span> <span class="kc">true</span><span class="p">)</span>

<span class="nx">client</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">message</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">ticket</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">//... save ticket for later cancellation, if needed.</span>
<span class="p">}).</span><span class="k">catch</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">error</span><span class="p">){</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;An error occured: %o&quot;</span><span class="p">,</span> <span class="nx">error</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

        </div>
    
        </div>
    
                </div>
                    </p>
<h2 id="cancel-a-request">Cancel a request<a class="headerlink" href="#cancel-a-request" title="Permanent link">&para;</a></h2>
<p>After a user has sent a message to add themselves to the matchmaker pool you'll receive a ticket which can be used to cancel the action at some later point.</p>
<p>Users may cancel matchmake actions at any point after they've added themselves to the pool but before they've been matched. Once matching completes for the ticket it can no longer be used to cancel.</p>
<p>
                <div class="code-nav-container">
                    
        <ul class="nav nav-tabs">
            
        <li class="nav-item active">
            <a href="#tab-5-csharp" aria-controls="tab-5-csharp" role="tab" data-toggle="tab" data-lang="csharp">Unity</a>
        </li>
    
        <li class="nav-item ">
            <a href="#tab-5-js" aria-controls="tab-5-js" role="tab" data-toggle="tab" data-lang="js">Javascript</a>
        </li>
    
        </ul>
    
        <div class="tab-content">
            
        <div role="tabpanel" class="tab-pane active" id="tab-5-csharp">
            <div class="codehilite"><pre><span></span><span class="n">INMatchmakeTicket</span> <span class="n">cancelTicket</span> <span class="p">=</span> <span class="n">result</span><span class="p">;</span> <span class="c1">// See above.</span>

<span class="kt">var</span> <span class="n">message</span> <span class="p">=</span> <span class="n">NMatchmakeRemoveMessage</span><span class="p">.</span><span class="n">Default</span><span class="p">(</span><span class="n">cancelTicket</span><span class="p">);</span>
<span class="n">client</span><span class="p">.</span><span class="n">Send</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="p">(</span><span class="kt">bool</span> <span class="n">done</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="n">Debug</span><span class="p">.</span><span class="n">Log</span><span class="p">(</span><span class="s">&quot;User removed from matchmaker pool.&quot;</span><span class="p">);</span>
<span class="p">},</span> <span class="p">(</span><span class="n">INError</span> <span class="n">err</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="n">Debug</span><span class="p">.</span><span class="n">LogErrorFormat</span><span class="p">(</span><span class="s">&quot;Error: code &#39;{0}&#39; with &#39;{1}&#39;.&quot;</span><span class="p">,</span> <span class="n">err</span><span class="p">.</span><span class="n">Code</span><span class="p">,</span> <span class="n">err</span><span class="p">.</span><span class="n">Message</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

        </div>
    
        <div role="tabpanel" class="tab-pane " id="tab-5-js">
            <div class="codehilite"><pre><span></span><span class="kd">var</span> <span class="nx">matchmakeTicket</span> <span class="o">=</span> <span class="nx">result</span><span class="p">;</span> <span class="c1">// See above.</span>

<span class="kd">var</span> <span class="nx">message</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">nakamajs</span><span class="p">.</span><span class="nx">MatchmakeRemoveRequest</span><span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">ticket</span><span class="p">);</span>
<span class="nx">client</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">message</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;User removed from matchmaker pool.&quot;</span><span class="p">);</span>
<span class="p">}).</span><span class="k">catch</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">error</span><span class="p">){</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;An error occured: %o&quot;</span><span class="p">,</span> <span class="nx">error</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

        </div>
    
        </div>
    
                </div>
                    </p>
<p>The user is now removed from the matchmaker pool.</p>
<div class="admonition note">
<p class="admonition-title">Removed on disconnect</p>
<p>A user will automatically be removed from the matchmaker pool by the server when they disconnect.</p>
</div>
<h2 id="join-a-match">Join a match<a class="headerlink" href="#join-a-match" title="Permanent link">&para;</a></h2>
<p>To join a match after the event handler has notified the user their criteria is met and they've been given opponents you can use the match token.</p>
<p>
                <div class="code-nav-container">
                    
        <ul class="nav nav-tabs">
            
        <li class="nav-item active">
            <a href="#tab-6-csharp" aria-controls="tab-6-csharp" role="tab" data-toggle="tab" data-lang="csharp">Unity</a>
        </li>
    
        <li class="nav-item ">
            <a href="#tab-6-js" aria-controls="tab-6-js" role="tab" data-toggle="tab" data-lang="js">Javascript</a>
        </li>
    
        </ul>
    
        <div class="tab-content">
            
        <div role="tabpanel" class="tab-pane active" id="tab-6-csharp">
            <div class="codehilite"><pre><span></span><span class="n">client</span><span class="p">.</span><span class="n">OnMatchmakeMatched</span> <span class="p">=</span> <span class="p">(</span><span class="n">INMatchmakeMatched</span> <span class="n">matched</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="c1">// The match token is used to join a multiplayer match.</span>
  <span class="kt">var</span> <span class="n">message</span> <span class="p">=</span> <span class="n">NMatchJoinMessage</span><span class="p">.</span><span class="n">Default</span><span class="p">(</span><span class="n">matched</span><span class="p">.</span><span class="n">Token</span><span class="p">);</span>
  <span class="n">client</span><span class="p">.</span><span class="n">Send</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="p">(</span><span class="n">INResultSet</span><span class="p">&lt;</span><span class="n">INMatch</span><span class="p">&gt;</span> <span class="n">matches</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="n">Debug</span><span class="p">.</span><span class="n">Log</span><span class="p">(</span><span class="s">&quot;Successfully joined match.&quot;</span><span class="p">);</span>
  <span class="p">},</span> <span class="p">(</span><span class="n">INError</span> <span class="n">error</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="n">Debug</span><span class="p">.</span><span class="n">LogErrorFormat</span><span class="p">(</span><span class="s">&quot;Error: code &#39;{0}&#39; with &#39;{1}&#39;.&quot;</span><span class="p">,</span> <span class="n">err</span><span class="p">.</span><span class="n">Code</span><span class="p">,</span> <span class="n">err</span><span class="p">.</span><span class="n">Message</span><span class="p">);</span>
  <span class="p">});</span>
<span class="p">};</span>
</pre></div>

        </div>
    
        <div role="tabpanel" class="tab-pane " id="tab-6-js">
            <div class="codehilite"><pre><span></span><span class="nx">client</span><span class="p">.</span><span class="nx">onmatchmakematched</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">matched</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// The match token is used to join a multiplayer match.</span>
  <span class="kd">var</span> <span class="nx">message</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">nakamajs</span><span class="p">.</span><span class="nx">MatchesJoinRequest</span><span class="p">();</span>
  <span class="nx">message</span><span class="p">.</span><span class="nx">tokens</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">matched</span><span class="p">.</span><span class="nx">token</span><span class="p">);</span>
  <span class="nx">client</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">message</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">matches</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Successfully joined match.&quot;</span><span class="p">);</span>
  <span class="p">}).</span><span class="k">catch</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">error</span><span class="p">){</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;An error occured: %o&quot;</span><span class="p">,</span> <span class="nx">error</span><span class="p">);</span>
  <span class="p">});</span>
<span class="p">};</span>
</pre></div>

        </div>
    
        </div>
    
                </div>
                    </p>
<p>The token makes it easy to join a match. The token enables the server to know that these users wanted to join a match and is able to create a match dynamically for them.</p>
<p>Tokens are short-lived and must be used to join a match as soon as possible. When a token expires it can no longer be used or refreshed.</p>
<p>The match token is also used to prevent unwanted users from attempting to join a match they were not matched into. The rest of the multiplayer match code in the same as in the <a href="../gameplay-multiplayer-realtime/">realtime multiplayer section</a>.</p>
                
                  
                
              
              
                
              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../gameplay-leaderboards/" title="Leaderboards" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Leaderboards
              </span>
            </div>
          </a>
        
        
          <a href="../gameplay-multiplayer-realtime/" title="Realtime Multiplayer" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Realtime Multiplayer
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; 2017 Heroic Labs
          </div>
        
        powered by
        <a href="http://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
        
  <div class="md-footer-social">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    
      <a href="https://heroiclabs.com" class="md-footer-social__link fa fa-globe"></a>
    
      <a href="https://github.com/heroiclabs" class="md-footer-social__link fa fa-github"></a>
    
      <a href="https://twitter.com/heroicdev" class="md-footer-social__link fa fa-twitter"></a>
    
      <a href="https://www.linkedin.com/company/heroic-labs" class="md-footer-social__link fa fa-linkedin"></a>
    
  </div>

      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/application.6cdc17f0.js"></script>
      
      <script>app.initialize({version:"0.17.2",url:{base:".."}})</script>
      
        <script src="../javascripts/main.js"></script>
      
    
    
      
    
  </body>
</html>