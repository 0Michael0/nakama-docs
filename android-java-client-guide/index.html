
<!DOCTYPE html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="Documentation for the Nakama realtime and social server for games and apps.">
      
      
        <link rel="canonical" href="https://heroiclabs.com/docs/android-java-client-guide/">
      
      
        <meta name="author" content="Heroic Labs Team & contributors">
      
      
        <link rel="shortcut icon" href="../images/favicon.ico">
      
      <meta name="generator" content="mkdocs-0.16.3, mkdocs-material-1.7.4">
    
    
      
        <title>Android client guide - Nakama server</title>
      
    
    
      <script src="../assets/javascripts/modernizr-1df76c4e58.js"></script>
    
    
      <link rel="stylesheet" href="../assets/stylesheets/application-769c285a91.css">
      
        <link rel="stylesheet" href="../assets/stylesheets/application-02c2a4388f.palette.css">
      
    
    
      
        
        
        
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
      <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    
    
    
  </head>
  
  
  
  
    <body data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="drawer">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="search">
    <label class="md-overlay" data-md-component="overlay" for="drawer"></label>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <a href="https://heroiclabs.com/docs/" title="Nakama server" class="md-logo md-header-nav__button">
            <img src="../images/logo-white.svg" width="24" height="24">
          </a>
        
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <span class="md-flex__ellipsis md-header-nav__title">
          
            
              
            
            Android client guide
          
        </span>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="search"></label>
          
<div class="md-search" data-md-component="search">
  <label class="md-search__overlay" for="search"></label>
  <div class="md-search__inner">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" required placeholder="Search" accesskey="s" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query">
      <label class="md-icon md-search__icon" for="search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset">close</button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result" data-md-lang-search="">
          <div class="md-search-result__meta" data-md-lang-result-none="No matching documents" data-md-lang-result-one="1 matching document" data-md-lang-result-other="# matching documents">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  


  <a href="https://github.com/heroiclabs/nakama" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      heroiclabs/nakama
    </div>
  </a>

          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="drawer">
    
      <i class="md-logo md-nav__button">
        <img src="../images/logo-white.svg">
      </i>
    
    Nakama server
  </label>
  
    <div class="md-nav__source">
      


  


  <a href="https://github.com/heroiclabs/nakama" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      heroiclabs/nakama
    </div>
  </a>

    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      Install and setup
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        Install and setup
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../install-docker-quickstart/" title="Docker quickstart" class="md-nav__link">
      Docker quickstart
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../install-binary/" title="Binary install" class="md-nav__link">
      Binary install
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../install-configuration/" title="Configuration" class="md-nav__link">
      Configuration
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../install-server-cli/" title="Nakama CLI" class="md-nav__link">
      Nakama CLI
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../install-nakama-upgrade/" title="Upgrades" class="md-nav__link">
      Upgrades
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../unity-client-guide/" title="Unity client guide" class="md-nav__link">
      Unity client guide
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="toc">
        Android client guide
      </label>
    
    <a href="./" title="Android client guide" class="md-nav__link md-nav__link--active">
      Android client guide
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#download" title="Download" class="md-nav__link">
    Download
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#install-and-setup" title="Install and setup" class="md-nav__link">
    Install and setup
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#for-android" title="For Android" class="md-nav__link">
    For Android
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#authenticate" title="Authenticate" class="md-nav__link">
    Authenticate
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#send-messages" title="Send messages" class="md-nav__link">
    Send messages
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#promise-chains" title="Promise chains" class="md-nav__link">
    Promise chains
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#logs-and-errors" title="Logs and errors" class="md-nav__link">
    Logs and errors
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#full-android-example" title="Full Android example" class="md-nav__link">
    Full Android example
  </a>
  
</li>
      
      
      
    </ul>
  
</nav>
    
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../javascript-client-guide/" title="JavaScript client guide" class="md-nav__link">
      JavaScript client guide
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../swift-ios-client-guide/" title="Swift/iOS client guide" class="md-nav__link">
      Swift/iOS client guide
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../authentication/" title="Authentication" class="md-nav__link">
      Authentication
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../user-accounts/" title="User accounts" class="md-nav__link">
      User accounts
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-9" type="checkbox" id="nav-9">
    
    <label class="md-nav__link" for="nav-9">
      Storage Engine
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-9">
        Storage Engine
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../storage-collections/" title="Collections" class="md-nav__link">
      Collections
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-10" type="checkbox" id="nav-10">
    
    <label class="md-nav__link" for="nav-10">
      Social
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-10">
        Social
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../social-friends/" title="Friends" class="md-nav__link">
      Friends
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../social-groups-clans/" title="Groups and Clans" class="md-nav__link">
      Groups and Clans
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../social-in-app-notifications/" title="In-app Notifications" class="md-nav__link">
      In-app Notifications
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../social-realtime-chat/" title="Realtime Chat" class="md-nav__link">
      Realtime Chat
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-11" type="checkbox" id="nav-11">
    
    <label class="md-nav__link" for="nav-11">
      Gameplay
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-11">
        Gameplay
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../gameplay-leaderboards/" title="Leaderboards" class="md-nav__link">
      Leaderboards
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../gameplay-matchmaker/" title="Matchmaker" class="md-nav__link">
      Matchmaker
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../gameplay-multiplayer-realtime/" title="Realtime Multiplayer" class="md-nav__link">
      Realtime Multiplayer
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../in-app-purchase-validation/" title="In-app Purchase Validation" class="md-nav__link">
      In-app Purchase Validation
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-13" type="checkbox" id="nav-13">
    
    <label class="md-nav__link" for="nav-13">
      Runtime Code
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-13">
        Runtime Code
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../runtime-code-basics/" title="Basics" class="md-nav__link">
      Basics
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../runtime-code-function-reference/" title="Function Reference" class="md-nav__link">
      Function Reference
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-14" type="checkbox" id="nav-14">
    
    <label class="md-nav__link" for="nav-14">
      Deployment
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-14">
        Deployment
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../deployment-digital-ocean/" title="Digital Ocean" class="md-nav__link">
      Digital Ocean
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-15" type="checkbox" id="nav-15">
    
    <label class="md-nav__link" for="nav-15">
      Tutorials
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-15">
        Tutorials
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../tutorial-develop-with-libgdx/" title="Develop with LibGDX" class="md-nav__link">
      Develop with LibGDX
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../tutorial-initialize-new-user/" title="Initialize a new user" class="md-nav__link">
      Initialize a new user
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../tutorial-remote-configuration/" title="Remote configuration" class="md-nav__link">
      Remote configuration
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#download" title="Download" class="md-nav__link">
    Download
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#install-and-setup" title="Install and setup" class="md-nav__link">
    Install and setup
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#for-android" title="For Android" class="md-nav__link">
    For Android
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#authenticate" title="Authenticate" class="md-nav__link">
    Authenticate
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#send-messages" title="Send messages" class="md-nav__link">
    Send messages
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#promise-chains" title="Promise chains" class="md-nav__link">
    Promise chains
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#logs-and-errors" title="Logs and errors" class="md-nav__link">
    Logs and errors
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#full-android-example" title="Full Android example" class="md-nav__link">
    Full Android example
  </a>
  
</li>
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="androidjava-client-guide">Android/Java client guide<a class="headerlink" href="#androidjava-client-guide" title="Permanent link">&para;</a></h1>
<p>The official Java client handles all communication in realtime with the server and is specifically optimized for Android projects. It implements all features in the server and is compatible with Java 1.7+ and Android 2.3+. To work with the Java client you'll need a build tool like <a href="https://gradle.org/" target="\_blank">Gradle</a> and an editor/IDE like <a href="https://www.jetbrains.com/idea/" target="\_blank">IntelliJ</a> or <a href="https://eclipse.org/ide/" target="\_blank">Eclipse</a>.</p>
<h2 id="download">Download<a class="headerlink" href="#download" title="Permanent link">&para;</a></h2>
<p>The client can be downloaded from <a href="https://github.com/heroiclabs/nakama-java/releases/latest" target="\_blank">GitHub releases</a>. You can download "nakama-java-$version.jar" or "nakama-java-$version-all.jar" which includes a shadowed copy of all dependencies. If you use a build tool like Gradle you can skip the download and fetch it from the <a href="#install-and-setup">central repository</a>.</p>
<p>For upgrades you can see changes and enhancements in the <a href="https://github.com/heroiclabs/nakama-java/blob/master/CHANGELOG.md" target="\_blank">CHANGELOG</a> before you update to newer versions.</p>
<div class="admonition bug">
<p class="admonition-title">Help and contribute</p>
<p>The Java client is <a href="https://github.com/heroiclabs/nakama-java" target="\_blank">open source on GitHub</a>. Please report issues and contribute code to help us improve it.</p>
</div>
<h2 id="install-and-setup">Install and setup<a class="headerlink" href="#install-and-setup" title="Permanent link">&para;</a></h2>
<p>When you've downloaded the jar package you should include it in your project or if you use Gradle add the client as a dependency to your "build.gradle".</p>
<div class="codehilite"><pre><span></span><span class="n">repositories</span> <span class="o">{</span>
    <span class="n">maven</span> <span class="o">{</span>
        <span class="n">url</span> <span class="s1">&#39;https://dl.bintray.com/heroiclabs/default/&#39;</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="n">dependencies</span> <span class="o">{</span>
  <span class="n">compile</span><span class="o">(</span><span class="nl">group:</span> <span class="s1">&#39;com.heroiclabs.nakama&#39;</span><span class="o">,</span> <span class="nl">name:</span> <span class="s1">&#39;client&#39;</span><span class="o">,</span> <span class="nl">version:</span> <span class="s1">&#39;+&#39;</span><span class="o">)</span>
<span class="o">}</span>
</pre></div>


<p>The client object is used to execute all logic against the server.</p>
<div class="codehilite"><pre><span></span><span class="kn">import</span> <span class="nn">com.heroiclabs.nakama.Client</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">NakamaSessionManager</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">Client</span> <span class="n">client</span><span class="o">;</span>

  <span class="kd">public</span> <span class="nf">NakamaSessionManager</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">client</span> <span class="o">=</span> <span class="n">DefaultClient</span><span class="o">.</span><span class="na">builder</span><span class="o">(</span><span class="s">&quot;defaultkey&quot;</span><span class="o">)</span>
        <span class="o">.</span><span class="na">host</span><span class="o">(</span><span class="s">&quot;127.0.0.1&quot;</span><span class="o">)</span>
        <span class="o">.</span><span class="na">port</span><span class="o">(</span><span class="mi">7350</span><span class="o">)</span>
        <span class="o">.</span><span class="na">ssl</span><span class="o">(</span><span class="kc">false</span><span class="o">)</span>
        <span class="o">.</span><span class="na">build</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>


<p>We use the builder pattern with many classes in the Java client. Most classes have a shorthand ".defaults()" method to construct an object with default values.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>By default the client uses connection settings "127.0.0.1" and 7350 to connect to a local Nakama server.</p>
</div>
<div class="codehilite"><pre><span></span><span class="c1">// Quickly setup a client for a local server.</span>
<span class="n">Client</span> <span class="n">client</span> <span class="o">=</span> <span class="n">DefaultClient</span><span class="o">.</span><span class="na">defaults</span><span class="o">(</span><span class="s">&quot;defaultkey&quot;</span><span class="o">);</span>
</pre></div>


<h3 id="for-android">For Android<a class="headerlink" href="#for-android" title="Permanent link">&para;</a></h3>
<p>Android uses a permissions system which determines which platform services the application will request to use and ask permission for from the user. The client uses the network to communicate with the server so you must add the "INTERNET" permission.</p>
<div class="codehilite"><pre><span></span><span class="nt">&lt;uses-permission</span> <span class="na">android:name=</span><span class="s">&quot;android.permission.INTERNET&quot;</span><span class="nt">/&gt;</span>
</pre></div>


<h2 id="authenticate">Authenticate<a class="headerlink" href="#authenticate" title="Permanent link">&para;</a></h2>
<p>With a client object you can authenticate against the server. You can register or login a <a href="../user-accounts/">user</a> with one of the <a href="../authentication/">authenticate options</a>.</p>
<p>To authenticate you should follow our recommended pattern in your client code:</p>
<p>&nbsp;&nbsp; 1. Build an instance of the client.</p>
<div class="codehilite"><pre><span></span><span class="n">Client</span> <span class="n">client</span> <span class="o">=</span> <span class="n">DefaultClient</span><span class="o">.</span><span class="na">defaults</span><span class="o">(</span><span class="s">&quot;defaultkey&quot;</span><span class="o">);</span>
</pre></div>


<p>&nbsp;&nbsp; 2. Login or register a user.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>It's good practice to cache a device identifier on Android when it's used to authenticate because they can change with device OS updates.</p>
</div>
<div class="codehilite"><pre><span></span><span class="n">String</span> <span class="n">id</span> <span class="o">=</span> <span class="n">UUID</span><span class="o">.</span><span class="na">randomUUID</span><span class="o">().</span><span class="na">toString</span><span class="o">();</span>
<span class="n">AuthenticateMessage</span> <span class="n">message</span> <span class="o">=</span> <span class="n">AuthenticateMessage</span><span class="o">.</span><span class="na">Builder</span><span class="o">.</span><span class="na">device</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
<span class="n">Deferred</span><span class="o">&lt;</span><span class="n">Session</span><span class="o">&gt;</span> <span class="n">deferred</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="na">login</span><span class="o">(</span><span class="n">message</span><span class="o">)</span>
<span class="n">deferred</span><span class="o">.</span><span class="na">addCallbackDeferring</span><span class="o">(</span><span class="k">new</span> <span class="n">Callback</span><span class="o">&lt;</span><span class="n">Deferred</span><span class="o">&lt;</span><span class="n">Session</span><span class="o">&gt;,</span> <span class="n">Session</span><span class="o">&gt;()</span> <span class="o">{</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="n">Deferred</span><span class="o">&lt;</span><span class="n">Session</span><span class="o">&gt;</span> <span class="nf">call</span><span class="o">(</span><span class="n">Session</span> <span class="n">session</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">client</span><span class="o">.</span><span class="na">connect</span><span class="o">(</span><span class="n">session</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}).</span><span class="na">addErrback</span><span class="o">(</span><span class="k">new</span> <span class="n">Callback</span><span class="o">&lt;</span><span class="n">Deferred</span><span class="o">&lt;</span><span class="n">Session</span><span class="o">&gt;,</span> <span class="n">Error</span><span class="o">&gt;()</span> <span class="o">{</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="n">Deferred</span><span class="o">&lt;</span><span class="n">Session</span><span class="o">&gt;</span> <span class="nf">call</span><span class="o">(</span><span class="n">Error</span> <span class="n">err</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">err</span><span class="o">.</span><span class="na">getCode</span><span class="o">()</span> <span class="o">==</span> <span class="n">Error</span><span class="o">.</span><span class="na">ErrorCode</span><span class="o">.</span><span class="na">USER_NOT_FOUND</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;User not found, we&#39;ll register the user.&quot;</span><span class="o">);</span>
      <span class="k">return</span> <span class="n">client</span><span class="o">.</span><span class="na">register</span><span class="o">(</span><span class="n">message</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="k">throw</span> <span class="n">err</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}).</span><span class="na">addCallbackDeferring</span><span class="o">(</span><span class="k">new</span> <span class="n">Callback</span><span class="o">&lt;</span><span class="n">Deferred</span><span class="o">&lt;</span><span class="n">Session</span><span class="o">&gt;,</span> <span class="n">Session</span><span class="o">&gt;()</span> <span class="o">{</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="n">Deferred</span><span class="o">&lt;</span><span class="n">Session</span><span class="o">&gt;</span> <span class="nf">call</span><span class="o">(</span><span class="n">Session</span> <span class="n">session</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">client</span><span class="o">.</span><span class="na">connect</span><span class="o">(</span><span class="n">session</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}).</span><span class="na">addCallback</span><span class="o">(</span><span class="k">new</span> <span class="n">Callback</span><span class="o">&lt;</span><span class="n">Session</span><span class="o">,</span> <span class="n">Session</span><span class="o">&gt;()</span> <span class="o">{</span> <span class="c1">// See step (3).</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="n">Session</span> <span class="nf">call</span><span class="o">(</span><span class="n">Session</span> <span class="n">session</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">&quot;Session connected: &#39;%s&#39;&quot;</span><span class="o">,</span> <span class="n">session</span><span class="o">.</span><span class="na">getToken</span><span class="o">());</span>
    <span class="k">return</span> <span class="n">session</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}).</span><span class="na">addErrback</span><span class="o">(</span><span class="k">new</span> <span class="n">Callback</span><span class="o">&lt;</span><span class="n">Error</span><span class="o">,</span> <span class="n">Error</span><span class="o">&gt;()</span> <span class="o">{</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="n">Error</span> <span class="nf">call</span><span class="o">(</span><span class="n">Error</span> <span class="n">err</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
    <span class="n">System</span><span class="o">.</span><span class="na">err</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">&quot;Error(&#39;%s&#39;, &#39;%s&#39;)&quot;</span><span class="o">,</span> <span class="n">err</span><span class="o">.</span><span class="na">getCode</span><span class="o">(),</span> <span class="n">err</span><span class="o">.</span><span class="na">getMessage</span><span class="o">());</span>
    <span class="k">return</span> <span class="n">err</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">});</span>
</pre></div>


<p>In the code above we use <code>AuthenticateMessage.Builder.device(id)</code> but for other authentication options have a look at the <a href="../authentication/#register-or-login">code examples</a>.</p>
<p>The client uses <a href="#promise-chains">promise chains</a> for an easy way to execute asynchronous callbacks.</p>
<p>&nbsp;&nbsp; 3. Store session for quick reconnects.</p>
<p>We can replace the callback marked in step 2 with a callback which stores the session object on Android.</p>
<div class="codehilite"><pre><span></span><span class="n">Callback</span><span class="o">&lt;</span><span class="n">Session</span><span class="o">,</span> <span class="n">Session</span><span class="o">&gt;</span> <span class="n">callback</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Callback</span><span class="o">&lt;</span><span class="n">Session</span><span class="o">,</span> <span class="n">Session</span><span class="o">&gt;()</span> <span class="o">{</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="n">Session</span> <span class="nf">call</span><span class="o">(</span><span class="n">Session</span> <span class="n">session</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">&quot;Session connected: &#39;%s&#39;&quot;</span><span class="o">,</span> <span class="n">session</span><span class="o">.</span><span class="na">getToken</span><span class="o">());</span>
    <span class="c1">// Android code.</span>
    <span class="n">SharedPreferences</span> <span class="n">pref</span> <span class="o">=</span> <span class="n">getActivity</span><span class="o">().</span><span class="na">getPreferences</span><span class="o">(</span><span class="n">Context</span><span class="o">.</span><span class="na">MODE_PRIVATE</span><span class="o">);</span>
    <span class="n">SharedPreferences</span><span class="o">.</span><span class="na">Editor</span> <span class="n">editor</span> <span class="o">=</span> <span class="n">pref</span><span class="o">.</span><span class="na">edit</span><span class="o">();</span>
    <span class="n">editor</span><span class="o">.</span><span class="na">putString</span><span class="o">(</span><span class="s">&quot;nk.session&quot;</span><span class="o">,</span> <span class="n">session</span><span class="o">.</span><span class="na">getToken</span><span class="o">());</span>
    <span class="n">editor</span><span class="o">.</span><span class="na">commit</span><span class="o">();</span>
    <span class="k">return</span> <span class="n">session</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">};</span>
</pre></div>


<p>A <strong>full example</strong> class with all code above is <a href="#full-android-example">here</a>.</p>
<h2 id="send-messages">Send messages<a class="headerlink" href="#send-messages" title="Permanent link">&para;</a></h2>
<p>When a user has been authenticated a session is used to connect with the server. You can then send messages for all the different features in the server.</p>
<p>This could be to <a href="../social-friends/">add friends</a>, join <a href="../social-groups-clans/">groups</a> and <a href="../social-realtime-chat/">chat</a>, or submit scores in <a href="../gameplay-leaderboards/">leaderboards</a>, and <a href="../gameplay-matchmaker/">matchmake</a> into a <a href="../gameplay-multiplayer-realtime/">multiplayer match</a>. You can also execute remote code on the server via <a href="../runtime-code-basics/">RPC</a>.</p>
<p>The server also provides a <a href="../storage-collections/">storage engine</a> to keep preferences and other records owned by users. We'll use storage to introduce how messages are sent.</p>
<div class="codehilite"><pre><span></span><span class="kt">byte</span><span class="o">[]</span> <span class="n">json</span> <span class="o">=</span> <span class="s">&quot;{\&quot;jsonkey\&quot;:\&quot;jsonvalue\&quot;}&quot;</span><span class="o">.</span><span class="na">getBytes</span><span class="o">();</span>

<span class="n">CollatedMessage</span><span class="o">&lt;</span><span class="n">ResultSet</span><span class="o">&lt;</span><span class="n">RecordId</span><span class="o">&gt;&gt;</span> <span class="n">message</span> <span class="o">=</span> <span class="n">StorageWriteMessage</span><span class="o">.</span><span class="na">Builder</span><span class="o">.</span><span class="na">newBuilder</span><span class="o">()</span>
    <span class="o">.</span><span class="na">record</span><span class="o">(</span><span class="s">&quot;someBucket&quot;</span><span class="o">,</span> <span class="s">&quot;someCollection&quot;</span><span class="o">,</span> <span class="s">&quot;myRecord&quot;</span><span class="o">,</span> <span class="n">json</span><span class="o">)</span>
    <span class="o">.</span><span class="na">build</span><span class="o">();</span>
<span class="n">Deferred</span><span class="o">&lt;</span><span class="n">ResultSet</span><span class="o">&lt;</span><span class="n">RecordId</span><span class="o">&gt;&gt;</span> <span class="n">deferred</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="na">send</span><span class="o">(</span><span class="n">message</span><span class="o">)</span>
<span class="n">deferred</span><span class="o">.</span><span class="na">addCallback</span><span class="o">(</span><span class="k">new</span> <span class="n">Callback</span><span class="o">&lt;</span><span class="n">ResultSet</span><span class="o">&lt;</span><span class="n">RecordId</span><span class="o">&gt;,</span> <span class="n">ResultSet</span><span class="o">&lt;</span><span class="n">RecordId</span><span class="o">&gt;&gt;()</span> <span class="o">{</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="n">ResultSet</span><span class="o">&lt;</span><span class="n">RecordId</span><span class="o">&gt;</span> <span class="nf">call</span><span class="o">(</span><span class="n">ResultSet</span><span class="o">&lt;</span><span class="n">RecordId</span><span class="o">&gt;</span> <span class="n">list</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
    <span class="k">for</span> <span class="o">(</span><span class="n">RecordId</span> <span class="n">recordId</span> <span class="o">:</span> <span class="n">list</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">String</span> <span class="n">version</span> <span class="o">=</span> <span class="k">new</span> <span class="n">String</span><span class="o">(</span><span class="n">recordId</span><span class="o">.</span><span class="na">getVersion</span><span class="o">());</span>
      <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">&quot;Record stored &#39;%s&#39;&quot;</span><span class="o">,</span> <span class="n">version</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="n">list</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}).</span><span class="na">addErrback</span><span class="o">(</span><span class="k">new</span> <span class="n">Callback</span><span class="o">&lt;</span><span class="n">Error</span><span class="o">,</span> <span class="n">Error</span><span class="o">&gt;()</span> <span class="o">{</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="n">Error</span> <span class="nf">call</span><span class="o">(</span><span class="n">Error</span> <span class="n">err</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
    <span class="n">System</span><span class="o">.</span><span class="na">err</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">&quot;Error(&#39;%s&#39;, &#39;%s&#39;)&quot;</span><span class="o">,</span> <span class="n">err</span><span class="o">.</span><span class="na">getCode</span><span class="o">(),</span> <span class="n">err</span><span class="o">.</span><span class="na">getMessage</span><span class="o">());</span>
    <span class="k">return</span> <span class="n">err</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">});</span>
</pre></div>


<p>Have a look at other sections of documentation for more code examples.</p>
<!--
## Handle events

The client has listeners which are called on various events received from the server.





wzxhzdk:8

Some events only need to be implemented for the features you want to use.

| Callbacks | Description |
| --------- | ----------- |
| a | Handles an event for when the client is disconnected from the server. |
| b | Receives events about server errors. |
| c | Handles [realtime match](gameplay-multiplayer-realtime.md) messages. |
| d | Receives events when the [matchmaker](gameplay-matchmaker.md) has found match participants. |
| e | When in a [realtime match](gameplay-multiplayer-realtime.md) receives events for when users join or leave. |
| f | Receives live [in-app notifications](social-in-app-notifications.md) sent from the server. |
| g | Receives [realtime chat](social-realtime-chat.md) messages sent by other users. |
| h | Similar to "OnMatchPresence" it handles join and leave events but within [chat](social-realtime-chat.md). |
-->

<h2 id="promise-chains">Promise chains<a class="headerlink" href="#promise-chains" title="Permanent link">&para;</a></h2>
<p>The client uses promises to represent asynchronous actions with the <a href="http://tsunanet.net/~tsuna/async/1.0/com/stumbleupon/async/Deferred.html" target="\_blank">Deferred</a> library. This makes it easy to chain together actions which must occur in sequence and handle errors.</p>
<p>A deferred object is created when messages are sent and can attach callbacks and error handlers for working on the deferred result.</p>
<div class="codehilite"><pre><span></span><span class="n">Callback</span><span class="o">&lt;</span><span class="n">Session</span><span class="o">,</span> <span class="n">Session</span><span class="o">&gt;</span> <span class="n">callback</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Callback</span><span class="o">&lt;</span><span class="n">Session</span><span class="o">,</span> <span class="n">Session</span><span class="o">&gt;()</span> <span class="o">{</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="n">Session</span> <span class="nf">call</span><span class="o">(</span><span class="n">Session</span> <span class="n">session</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">&quot;Session connected: &#39;%s&#39;&quot;</span><span class="o">,</span> <span class="n">session</span><span class="o">.</span><span class="na">getToken</span><span class="o">());</span>
    <span class="k">return</span> <span class="n">session</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">};</span>

<span class="n">Callback</span><span class="o">&lt;</span><span class="n">Error</span><span class="o">,</span> <span class="n">Error</span><span class="o">&gt;</span> <span class="n">errback</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Callback</span><span class="o">&lt;</span><span class="n">Error</span><span class="o">,</span> <span class="n">Error</span><span class="o">&gt;()</span> <span class="o">{</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="n">Error</span> <span class="nf">call</span><span class="o">(</span><span class="n">Error</span> <span class="n">err</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
    <span class="n">System</span><span class="o">.</span><span class="na">err</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">&quot;Error(&#39;%s&#39;, &#39;%s&#39;)&quot;</span><span class="o">,</span> <span class="n">err</span><span class="o">.</span><span class="na">getCode</span><span class="o">(),</span> <span class="n">err</span><span class="o">.</span><span class="na">getMessage</span><span class="o">());</span>
    <span class="k">return</span> <span class="n">err</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">};</span>
</pre></div>


<p>You can chain callbacks because each callback returns a <code>Deferred&lt;T&gt;</code>. Each method on the <code>Client</code> returns a <code>Deferred&lt;T&gt;</code> so you can chain calls with <code>deferred.addCallbackDeferring(...)</code>.</p>
<div class="codehilite"><pre><span></span><span class="n">String</span> <span class="n">id</span> <span class="o">=</span> <span class="n">UUID</span><span class="o">.</span><span class="na">randomUUID</span><span class="o">().</span><span class="na">toString</span><span class="o">();</span>
<span class="n">AuthenticateMessage</span> <span class="n">message</span> <span class="o">=</span> <span class="n">AuthenticateMessage</span><span class="o">.</span><span class="na">Builder</span><span class="o">.</span><span class="na">device</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
<span class="n">Deferred</span><span class="o">&lt;</span><span class="n">Session</span><span class="o">&gt;</span> <span class="n">deferred</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="na">register</span><span class="o">(</span><span class="n">message</span><span class="o">)</span>
<span class="n">deferred</span><span class="o">.</span><span class="na">addCallbackDeferring</span><span class="o">(</span><span class="k">new</span> <span class="n">Callback</span><span class="o">&lt;</span><span class="n">Deferred</span><span class="o">&lt;</span><span class="n">Session</span><span class="o">&gt;,</span> <span class="n">Session</span><span class="o">&gt;()</span> <span class="o">{</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="n">Deferred</span><span class="o">&lt;</span><span class="n">Session</span><span class="o">&gt;</span> <span class="nf">call</span><span class="o">(</span><span class="n">Session</span> <span class="n">session</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">client</span><span class="o">.</span><span class="na">connect</span><span class="o">(</span><span class="n">session</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}).</span><span class="na">addCallback</span><span class="o">(</span><span class="k">new</span> <span class="n">Callback</span><span class="o">&lt;</span><span class="n">Session</span><span class="o">,</span> <span class="n">Session</span><span class="o">&gt;()</span> <span class="o">{</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="n">Session</span> <span class="nf">call</span><span class="o">(</span><span class="n">Session</span> <span class="n">session</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">&quot;Session connected: &#39;%s&#39;&quot;</span><span class="o">,</span> <span class="n">session</span><span class="o">.</span><span class="na">getToken</span><span class="o">());</span>
    <span class="k">return</span> <span class="n">session</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">});</span>
</pre></div>


<h2 id="logs-and-errors">Logs and errors<a class="headerlink" href="#logs-and-errors" title="Permanent link">&para;</a></h2>
<p>The <a href="../install-configuration/#log">server</a> and the client can generate logs which are helpful to debug code. To log all messages sent by the client you can enable "trace" when you build a <code>"Client"</code>.</p>
<div class="codehilite"><pre><span></span><span class="n">Client</span> <span class="n">client</span> <span class="o">=</span> <span class="n">DefaultClient</span><span class="o">.</span><span class="na">builder</span><span class="o">(</span><span class="s">&quot;defaultkey&quot;</span><span class="o">)</span>
    <span class="o">.</span><span class="na">trace</span><span class="o">(</span><span class="kc">true</span><span class="o">)</span>
    <span class="o">.</span><span class="na">build</span><span class="o">();</span>
</pre></div>


<p>The client uses <a href="https://www.slf4j.org/manual.html" target="\_blank">SLF4J</a> as the logging facade framework. This lets you choose whatever underlying logging framework you want to use. You should add one to your dependencies.</p>
<div class="codehilite"><pre><span></span><span class="n">dependencies</span> <span class="o">{</span>
  <span class="n">compile</span><span class="o">(</span><span class="nl">group:</span> <span class="s1">&#39;org.slf4j&#39;</span><span class="o">,</span> <span class="nl">name:</span> <span class="s1">&#39;slf4j-simple&#39;</span><span class="o">,</span> <span class="nl">version:</span> <span class="s1">&#39;1.7.+&#39;</span><span class="o">)</span>
<span class="o">}</span>
</pre></div>


<p>With Android you may want to use "slf4j-android" instead.</p>
<div class="codehilite"><pre><span></span><span class="n">dependencies</span> <span class="o">{</span>
  <span class="n">compile</span><span class="o">(</span><span class="nl">group:</span> <span class="s1">&#39;org.slf4j&#39;</span><span class="o">,</span> <span class="nl">name:</span> <span class="s1">&#39;slf4j-android&#39;</span><span class="o">,</span> <span class="nl">version:</span> <span class="s1">&#39;1.7.+&#39;</span><span class="o">)</span>
<span class="o">}</span>
</pre></div>


<p>Every error in the Java client implements the <code>"Error"</code> class. It contains details on the source and content of an error:</p>
<div class="codehilite"><pre><span></span><span class="n">Callback</span><span class="o">&lt;</span><span class="n">Error</span><span class="o">,</span> <span class="n">Error</span><span class="o">&gt;</span> <span class="n">errback</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Callback</span><span class="o">&lt;</span><span class="n">Error</span><span class="o">,</span> <span class="n">Error</span><span class="o">&gt;()</span> <span class="o">{</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="n">Error</span> <span class="nf">call</span><span class="o">(</span><span class="n">Error</span> <span class="n">err</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
    <span class="n">System</span><span class="o">.</span><span class="na">err</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">&quot;Error code &#39;%s&#39;&quot;</span><span class="o">,</span> <span class="n">err</span><span class="o">.</span><span class="na">getCode</span><span class="o">());</span>
    <span class="n">System</span><span class="o">.</span><span class="na">err</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">&quot;Error message &#39;%s&#39;&quot;</span><span class="o">,</span> <span class="n">err</span><span class="o">.</span><span class="na">getMessage</span><span class="o">());</span>
    <span class="k">return</span> <span class="n">err</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">};</span>
</pre></div>


<h2 id="full-android-example">Full Android example<a class="headerlink" href="#full-android-example" title="Permanent link">&para;</a></h2>
<p>An example class used to manage a session with the Java client.</p>
<div class="codehilite"><pre><span></span><span class="kn">package</span> <span class="nn">com.heroiclabs.nakama.example</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">android.app.Activity</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.content.Context</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.content.SharedPreferences</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.heroiclabs.nakama.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.heroiclabs.nakama.Error</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.heroiclabs.nakama.Error.ErrorCode</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.stumbleupon.async.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">NakamaSessionManager</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">Client</span> <span class="n">client</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">Callback</span><span class="o">&lt;</span><span class="n">Error</span><span class="o">,</span> <span class="n">Error</span><span class="o">&gt;</span> <span class="n">errback</span><span class="o">;</span>
  <span class="kd">private</span> <span class="n">Session</span> <span class="n">session</span><span class="o">;</span>

  <span class="kd">public</span> <span class="nf">NakamaSessionManager</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">client</span> <span class="o">=</span> <span class="n">DefaultClient</span><span class="o">.</span><span class="na">builder</span><span class="o">(</span><span class="s">&quot;defaultkey&quot;</span><span class="o">).</span><span class="na">build</span><span class="o">();</span>
    <span class="n">errback</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Callback</span><span class="o">&lt;</span><span class="n">Error</span><span class="o">,</span> <span class="n">Error</span><span class="o">&gt;()</span> <span class="o">{</span>
      <span class="nd">@Override</span>
      <span class="kd">public</span> <span class="n">Error</span> <span class="nf">call</span><span class="o">(</span><span class="n">Error</span> <span class="n">err</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
        <span class="n">System</span><span class="o">.</span><span class="na">err</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">&quot;Error(&#39;%s&#39;, &#39;%s&#39;)&quot;</span><span class="o">,</span> <span class="n">err</span><span class="o">.</span><span class="na">getCode</span><span class="o">(),</span> <span class="n">err</span><span class="o">.</span><span class="na">getMessage</span><span class="o">());</span>
        <span class="k">return</span> <span class="n">err</span><span class="o">;</span>
      <span class="o">}</span>
    <span class="o">};</span>
  <span class="o">}</span>

  <span class="cm">/** Get the Client reference to send/receive messages from the server. */</span>
  <span class="kd">public</span> <span class="n">Client</span> <span class="nf">getClient</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">client</span><span class="o">;</span>
  <span class="o">}</span>

  <span class="cm">/**</span>
<span class="cm">   * Login (or register) and connect a user using a device ID.</span>
<span class="cm">   * @param activity The Activity calling this method.</span>
<span class="cm">   * @param deviceId The Device ID to login with.</span>
<span class="cm">   */</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">connect</span><span class="o">(</span><span class="kd">final</span> <span class="n">Activity</span> <span class="n">activity</span><span class="o">,</span> <span class="n">String</span> <span class="n">deviceId</span><span class="o">)</span> <span class="o">{</span>
    <span class="kd">final</span> <span class="n">AuthenticateMessage</span> <span class="n">message</span> <span class="o">=</span> <span class="n">AuthenticateMessage</span><span class="o">.</span><span class="na">Builder</span><span class="o">.</span><span class="na">device</span><span class="o">(</span><span class="n">deviceId</span><span class="o">);</span>
    <span class="n">client</span><span class="o">.</span><span class="na">login</span><span class="o">(</span><span class="n">message</span><span class="o">)</span>
      <span class="o">.</span><span class="na">addCallbackDeferring</span><span class="o">(</span><span class="k">new</span> <span class="n">Callback</span><span class="o">&lt;</span><span class="n">Deferred</span><span class="o">&lt;</span><span class="n">Session</span><span class="o">&gt;,</span> <span class="n">Session</span><span class="o">&gt;()</span> <span class="o">{</span>
        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="n">Deferred</span><span class="o">&lt;</span><span class="n">Session</span><span class="o">&gt;</span> <span class="nf">call</span><span class="o">(</span><span class="n">Session</span> <span class="n">session</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
          <span class="c1">// Login was successful.</span>
          <span class="c1">// Store the session for later use.</span>
          <span class="n">SharedPreferences</span> <span class="n">pref</span> <span class="o">=</span> <span class="n">activity</span><span class="o">.</span><span class="na">getPreferences</span><span class="o">(</span><span class="n">Context</span><span class="o">.</span><span class="na">MODE_PRIVATE</span><span class="o">);</span>
          <span class="n">pref</span><span class="o">.</span><span class="na">edit</span><span class="o">()</span>
            <span class="o">.</span><span class="na">putString</span><span class="o">(</span><span class="s">&quot;nk.session&quot;</span><span class="o">,</span> <span class="n">session</span><span class="o">.</span><span class="na">getToken</span><span class="o">())</span>
            <span class="o">.</span><span class="na">apply</span><span class="o">();</span>

          <span class="k">return</span> <span class="n">client</span><span class="o">.</span><span class="na">connect</span><span class="o">(</span><span class="n">session</span><span class="o">);</span>
        <span class="o">}</span>
      <span class="o">})</span>
      <span class="o">.</span><span class="na">addErrback</span><span class="o">(</span><span class="k">new</span> <span class="n">Callback</span><span class="o">&lt;</span><span class="n">Deferred</span><span class="o">&lt;</span><span class="n">Session</span><span class="o">&gt;,</span> <span class="n">Error</span><span class="o">&gt;()</span> <span class="o">{</span>
        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="n">Deferred</span><span class="o">&lt;</span><span class="n">Session</span><span class="o">&gt;</span> <span class="nf">call</span><span class="o">(</span><span class="n">Error</span> <span class="n">err</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
          <span class="k">if</span> <span class="o">(</span><span class="n">err</span><span class="o">.</span><span class="na">getCode</span><span class="o">()</span> <span class="o">==</span> <span class="n">ErrorCode</span><span class="o">.</span><span class="na">USER_NOT_FOUND</span><span class="o">)</span> <span class="o">{</span>
            <span class="c1">// Login failed because this is a new user.</span>
            <span class="c1">// Let&#39;s register instead.</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;User not found, registering.&quot;</span><span class="o">);</span>
            <span class="k">return</span> <span class="n">client</span><span class="o">.</span><span class="na">register</span><span class="o">(</span><span class="n">message</span><span class="o">);</span>
          <span class="o">}</span>
          <span class="k">throw</span> <span class="n">err</span><span class="o">;</span>
        <span class="o">}</span>
      <span class="o">})</span>
      <span class="o">.</span><span class="na">addCallbackDeferring</span><span class="o">(</span><span class="k">new</span> <span class="n">Callback</span><span class="o">&lt;</span><span class="n">Deferred</span><span class="o">&lt;</span><span class="n">Session</span><span class="o">&gt;,</span> <span class="n">Session</span><span class="o">&gt;()</span> <span class="o">{</span>
        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="n">Deferred</span><span class="o">&lt;</span><span class="n">Session</span><span class="o">&gt;</span> <span class="nf">call</span><span class="o">(</span><span class="n">Session</span> <span class="n">session</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
          <span class="c1">// Registration has succeeded, try connecting again.</span>
          <span class="c1">// Store the session for later use.</span>
          <span class="n">SharedPreferences</span> <span class="n">pref</span> <span class="o">=</span> <span class="n">activity</span><span class="o">.</span><span class="na">getPreferences</span><span class="o">(</span><span class="n">Context</span><span class="o">.</span><span class="na">MODE_PRIVATE</span><span class="o">);</span>
          <span class="n">pref</span><span class="o">.</span><span class="na">edit</span><span class="o">().</span><span class="na">putString</span><span class="o">(</span><span class="s">&quot;nk.session&quot;</span><span class="o">,</span> <span class="n">session</span><span class="o">.</span><span class="na">getToken</span><span class="o">()).</span><span class="na">apply</span><span class="o">();</span>

          <span class="k">return</span> <span class="n">client</span><span class="o">.</span><span class="na">connect</span><span class="o">(</span><span class="n">session</span><span class="o">);</span>
        <span class="o">}</span>
      <span class="o">})</span>
      <span class="o">.</span><span class="na">addCallback</span><span class="o">(</span><span class="k">new</span> <span class="n">Callback</span><span class="o">&lt;</span><span class="n">Session</span><span class="o">,</span> <span class="n">Session</span><span class="o">&gt;()</span> <span class="o">{</span>
        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="n">Session</span> <span class="nf">call</span><span class="o">(</span><span class="n">Session</span> <span class="n">session</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
          <span class="c1">// We&#39;re connected to the server!</span>
          <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Connected!&quot;</span><span class="o">);</span>
          <span class="k">return</span> <span class="n">session</span><span class="o">;</span>
        <span class="o">}</span>
      <span class="o">})</span>
      <span class="o">.</span><span class="na">addErrback</span><span class="o">(</span><span class="n">errback</span><span class="o">);</span>
  <span class="o">}</span>

  <span class="cm">/**</span>
<span class="cm">   * Attempt to restore a Session from SharedPreferences and connect.</span>
<span class="cm">   * @param activity The Activity calling this method.</span>
<span class="cm">   */</span>
  <span class="kd">private</span> <span class="kt">void</span> <span class="nf">restoreSessionAndConnect</span><span class="o">(</span><span class="n">Activity</span> <span class="n">activity</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">SharedPreferences</span> <span class="n">pref</span> <span class="o">=</span> <span class="n">activity</span><span class="o">.</span><span class="na">getPreferences</span><span class="o">(</span><span class="n">Context</span><span class="o">.</span><span class="na">MODE_PRIVATE</span><span class="o">);</span>
    <span class="c1">// Lets check if we can restore a cached session.</span>
    <span class="n">String</span> <span class="n">sessionString</span> <span class="o">=</span> <span class="n">pref</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="s">&quot;nk.session&quot;</span><span class="o">,</span> <span class="kc">null</span><span class="o">);</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">sessionString</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">||</span> <span class="n">sessionString</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">())</span> <span class="o">{</span>
      <span class="k">return</span><span class="o">;</span> <span class="c1">// We have no session to restore.</span>
    <span class="o">}</span>

    <span class="n">Session</span> <span class="n">session</span> <span class="o">=</span> <span class="n">DefaultSession</span><span class="o">.</span><span class="na">restore</span><span class="o">(</span><span class="n">sessionString</span><span class="o">);</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">session</span><span class="o">.</span><span class="na">isExpired</span><span class="o">(</span><span class="n">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">()))</span> <span class="o">{</span>
      <span class="k">return</span><span class="o">;</span> <span class="c1">// We can&#39;t restore an expired session.</span>
    <span class="o">}</span>

    <span class="kd">final</span> <span class="n">NakamaSessionManager</span> <span class="n">self</span> <span class="o">=</span> <span class="k">this</span><span class="o">;</span>
    <span class="n">client</span><span class="o">.</span><span class="na">connect</span><span class="o">(</span><span class="n">session</span><span class="o">)</span>
      <span class="o">.</span><span class="na">addCallback</span><span class="o">(</span><span class="k">new</span> <span class="n">Callback</span><span class="o">&lt;</span><span class="n">Session</span><span class="o">,</span> <span class="n">Session</span><span class="o">&gt;()</span> <span class="o">{</span>
        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="n">Session</span> <span class="nf">call</span><span class="o">(</span><span class="n">Session</span> <span class="n">session</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
          <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">&quot;Session connected: &#39;%s&#39;.&quot;</span><span class="o">,</span> <span class="n">session</span><span class="o">.</span><span class="na">getToken</span><span class="o">());</span>
          <span class="n">self</span><span class="o">.</span><span class="na">session</span> <span class="o">=</span> <span class="n">session</span><span class="o">;</span>
          <span class="k">return</span> <span class="n">session</span><span class="o">;</span>
        <span class="o">}</span>
      <span class="o">});</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>
                
                  
                
              
              
                
              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../unity-client-guide/" title="Unity client guide" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Unity client guide
              </span>
            </div>
          </a>
        
        
          <a href="../javascript-client-guide/" title="JavaScript client guide" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                JavaScript client guide
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; 2017 Heroic Labs
          </div>
        
        powered by
        <a href="http://www.mkdocs.org" title="MkDocs">MkDocs</a>
        and
        <a href="http://squidfunk.github.io/mkdocs-material/" title="Material for MkDocs">
          Material for MkDocs</a>
      </div>
      
        
  <div class="md-footer-social">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    
      <a href="https://heroiclabs.com" class="md-footer-social__link fa fa-globe"></a>
    
      <a href="https://github.com/heroiclabs" class="md-footer-social__link fa fa-github"></a>
    
      <a href="https://twitter.com/heroicdev" class="md-footer-social__link fa fa-twitter"></a>
    
      <a href="https://www.linkedin.com/company/heroic-labs" class="md-footer-social__link fa fa-linkedin"></a>
    
  </div>

      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/application-c35428f87f.js"></script>
      
      
      <script>app.initialize({url:{base:".."}})</script>
      
        <script src="../js/main.js"></script>
      
    
    
      
    
  </body>
</html>