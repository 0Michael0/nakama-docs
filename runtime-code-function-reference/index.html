



<!DOCTYPE html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="Documentation for the Nakama realtime and social server for games and apps.">
      
      
        <link rel="canonical" href="https://heroiclabs.com/runtime-code-function-reference/">
      
      
        <meta name="author" content="Heroic Labs Team & contributors">
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../images/favicon.ico">
      <meta name="generator" content="mkdocs-0.17.2, mkdocs-material-2.2.0">
    
    
      
        <title>Function Reference - Nakama server</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/application.5d3fffba.css">
      
        <link rel="stylesheet" href="../assets/stylesheets/application-palette.fbd935c7.css">
      
    
    
      <script src="../assets/javascripts/modernizr.1aa3b519.js"></script>
    
    
      
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
      <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    
    
      <link rel="stylesheet" href="../stylesheets/code-tabs.css">
    
    
  </head>
  
    
    
    
      <body data-md-color-primary="indigo" data-md-color-accent="indigo">
    
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="drawer">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="search">
    <label class="md-overlay" data-md-component="overlay" for="drawer"></label>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="https://heroiclabs.com/" title="Nakama server" class="md-header-nav__button md-logo">
          
            <img src="../images/logo-white.svg" width="24" height="24">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            
              <span class="md-header-nav__topic">
                Nakama server
              </span>
              <span class="md-header-nav__topic">
                Function Reference
              </span>
            
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          
            <label class="md-icon md-icon--search md-header-nav__button" for="search"></label>
            
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="search"></label>
  <div class="md-search__inner">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" required placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query">
      <label class="md-icon md-search__icon" for="search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset">&#xE5CD;</button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
          
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  


  <a href="https://github.com/heroiclabs/nakama/" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      heroiclabs/nakama
    </div>
  </a>

          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="drawer">
    <span class="md-nav__button md-logo">
      
        <img src="../images/logo-white.svg" width="24" height="24">
      
    </span>
    Nakama server
  </label>
  
    <div class="md-nav__source">
      


  


  <a href="https://github.com/heroiclabs/nakama/" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      heroiclabs/nakama
    </div>
  </a>

    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../nakama-download/" title="Download" class="md-nav__link">
      Download
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      Install and setup
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        Install and setup
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../install-docker-quickstart/" title="Docker quickstart" class="md-nav__link">
      Docker quickstart
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../install-binary/" title="Binary install" class="md-nav__link">
      Binary install
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../install-configuration/" title="Configuration" class="md-nav__link">
      Configuration
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../install-server-cli/" title="Nakama CLI" class="md-nav__link">
      Nakama CLI
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../install-nakama-upgrade/" title="Upgrades" class="md-nav__link">
      Upgrades
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../unity-client-guide/" title="Unity client guide" class="md-nav__link">
      Unity client guide
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../android-java-client-guide/" title="Android client guide" class="md-nav__link">
      Android client guide
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../javascript-client-guide/" title="JavaScript client guide" class="md-nav__link">
      JavaScript client guide
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../swift-ios-client-guide/" title="Swift/iOS client guide" class="md-nav__link">
      Swift/iOS client guide
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../authentication/" title="Authentication" class="md-nav__link">
      Authentication
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../user-accounts/" title="User accounts" class="md-nav__link">
      User accounts
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-10" type="checkbox" id="nav-10">
    
    <label class="md-nav__link" for="nav-10">
      Storage Engine
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-10">
        Storage Engine
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../storage-collections/" title="Collections" class="md-nav__link">
      Collections
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-11" type="checkbox" id="nav-11">
    
    <label class="md-nav__link" for="nav-11">
      Social
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-11">
        Social
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../social-friends/" title="Friends" class="md-nav__link">
      Friends
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../social-groups-clans/" title="Groups and Clans" class="md-nav__link">
      Groups and Clans
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../social-in-app-notifications/" title="In-app Notifications" class="md-nav__link">
      In-app Notifications
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../social-realtime-chat/" title="Realtime Chat" class="md-nav__link">
      Realtime Chat
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-12" type="checkbox" id="nav-12">
    
    <label class="md-nav__link" for="nav-12">
      Gameplay
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-12">
        Gameplay
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../gameplay-leaderboards/" title="Leaderboards" class="md-nav__link">
      Leaderboards
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../gameplay-matchmaker/" title="Matchmaker" class="md-nav__link">
      Matchmaker
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../gameplay-multiplayer-realtime/" title="Realtime Multiplayer" class="md-nav__link">
      Realtime Multiplayer
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../in-app-purchase-validation/" title="In-app Purchase Validation" class="md-nav__link">
      In-app Purchase Validation
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-14" type="checkbox" id="nav-14" checked>
    
    <label class="md-nav__link" for="nav-14">
      Runtime Code
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-14">
        Runtime Code
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../runtime-code-basics/" title="Basics" class="md-nav__link">
      Basics
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="toc">
        Function Reference
      </label>
    
    <a href="./" title="Function Reference" class="md-nav__link md-nav__link--active">
      Function Reference
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#nakama-module" title="Nakama module" class="md-nav__link">
    Nakama module
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#base16" title="base16" class="md-nav__link">
    base16
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#base64" title="base64" class="md-nav__link">
    base64
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cron" title="cron" class="md-nav__link">
    cron
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#groups" title="groups" class="md-nav__link">
    groups
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#http" title="http" class="md-nav__link">
    http
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#json" title="json" class="md-nav__link">
    json
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#leaderboard" title="leaderboard" class="md-nav__link">
    leaderboard
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#logger" title="logger" class="md-nav__link">
    logger
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#notifications" title="notifications" class="md-nav__link">
    notifications
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#register-hooks" title="register hooks" class="md-nav__link">
    register hooks
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#storage" title="storage" class="md-nav__link">
    storage
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#users" title="users" class="md-nav__link">
    users
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#uuid" title="uuid" class="md-nav__link">
    uuid
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sql" title="sql" class="md-nav__link">
    sql
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
    </ul>
  
</nav>
    
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../benchmarks/" title="Benchmarks" class="md-nav__link">
      Benchmarks
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-16" type="checkbox" id="nav-16">
    
    <label class="md-nav__link" for="nav-16">
      Deployment
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-16">
        Deployment
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../deployment-digital-ocean/" title="Digital Ocean" class="md-nav__link">
      Digital Ocean
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-17" type="checkbox" id="nav-17">
    
    <label class="md-nav__link" for="nav-17">
      Tutorials
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-17">
        Tutorials
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../tutorial-develop-with-libgdx/" title="Develop with LibGDX" class="md-nav__link">
      Develop with LibGDX
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../tutorial-initialize-new-user/" title="Initialize a new user" class="md-nav__link">
      Initialize a new user
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../tutorial-remote-configuration/" title="Remote configuration" class="md-nav__link">
      Remote configuration
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../tutorial-send-push-messages/" title="Send push messages" class="md-nav__link">
      Send push messages
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#nakama-module" title="Nakama module" class="md-nav__link">
    Nakama module
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#base16" title="base16" class="md-nav__link">
    base16
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#base64" title="base64" class="md-nav__link">
    base64
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cron" title="cron" class="md-nav__link">
    cron
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#groups" title="groups" class="md-nav__link">
    groups
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#http" title="http" class="md-nav__link">
    http
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#json" title="json" class="md-nav__link">
    json
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#leaderboard" title="leaderboard" class="md-nav__link">
    leaderboard
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#logger" title="logger" class="md-nav__link">
    logger
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#notifications" title="notifications" class="md-nav__link">
    notifications
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#register-hooks" title="register hooks" class="md-nav__link">
    register hooks
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#storage" title="storage" class="md-nav__link">
    storage
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#users" title="users" class="md-nav__link">
    users
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#uuid" title="uuid" class="md-nav__link">
    uuid
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sql" title="sql" class="md-nav__link">
    sql
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/heroiclabs/nakama-docs/edit/master/docs/runtime-code-function-reference.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="function-reference">Function Reference<a class="headerlink" href="#function-reference" title="Permanent link">&para;</a></h1>
<p>The code runtime built into the server includes a module with functions to implement various logic and custom behavior. It is easy to define authoritative code and conditions on input received by clients.</p>
<h2 id="nakama-module">Nakama module<a class="headerlink" href="#nakama-module" title="Permanent link">&para;</a></h2>
<p>This module contains all the core gameplay APIs, all registration functions used at server startup, utilities for various codecs, and cryptographic primitives.</p>
<div class="codehilite"><pre><span></span><span class="kd">local</span> <span class="n">nk</span> <span class="o">=</span> <span class="nb">require</span><span class="p">(</span><span class="s2">&quot;nakama&quot;</span><span class="p">)</span>
</pre></div>


<div class="admonition note">
<p class="admonition-title">Note</p>
<p>All code examples assume the "nakama" module has been imported.</p>
</div>
<h3 id="base16">base16<a class="headerlink" href="#base16" title="Permanent link">&para;</a></h3>
<p><strong>base16_decode (input)</strong></p>
<p>Base 16 decode the input.</p>
<p><em>Parameters</em></p>
<table>
<thead>
<tr>
<th>Param</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>input</td>
<td>string</td>
<td>The string which will be base16 decoded.</td>
</tr>
</tbody>
</table>
<p><em>Returns</em></p>
<p>The base 16 decoded input.</p>
<p><em>Example</em></p>
<div class="codehilite"><pre><span></span><span class="kd">local</span> <span class="n">decoded</span> <span class="o">=</span> <span class="n">nk</span><span class="p">.</span><span class="n">base16_decode</span><span class="p">(</span><span class="s2">&quot;48656C6C6F20776F726C64&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">decoded</span><span class="p">)</span> <span class="c1">-- outputs &quot;Hello world&quot;</span>
</pre></div>


<hr />
<p><strong>base16_encode (input)</strong></p>
<p>Base 16 encode the input.</p>
<p><em>Parameters</em></p>
<table>
<thead>
<tr>
<th>Param</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>input</td>
<td>string</td>
<td>The string which will be base16 encoded.</td>
</tr>
</tbody>
</table>
<p><em>Returns</em></p>
<p>The base 16 encoded input.</p>
<p><em>Example</em></p>
<div class="codehilite"><pre><span></span><span class="kd">local</span> <span class="n">encoded</span> <span class="o">=</span> <span class="n">nk</span><span class="p">.</span><span class="n">base16_encode</span><span class="p">(</span><span class="s2">&quot;Hello world&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">encoded</span><span class="p">)</span> <span class="c1">-- outputs &quot;48656C6C6F20776F726C64&quot;</span>
</pre></div>


<h3 id="base64">base64<a class="headerlink" href="#base64" title="Permanent link">&para;</a></h3>
<p><strong>base64_decode (input)</strong></p>
<p>Base 64 decode the input.</p>
<p><em>Parameters</em></p>
<table>
<thead>
<tr>
<th>Param</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>input</td>
<td>string</td>
<td>The string which will be base64 decoded.</td>
</tr>
</tbody>
</table>
<p><em>Returns</em></p>
<p>The base 64 decoded input.</p>
<p><em>Example</em></p>
<div class="codehilite"><pre><span></span><span class="kd">local</span> <span class="n">decoded</span> <span class="o">=</span> <span class="n">nk</span><span class="p">.</span><span class="n">base64_decode</span><span class="p">(</span><span class="s2">&quot;SGVsbG8gd29ybGQ=&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">decoded</span><span class="p">)</span> <span class="c1">-- outputs &quot;Hello world&quot;</span>
</pre></div>


<hr />
<p><strong>base64_encode (input)</strong></p>
<p>Base 64 encode the input.</p>
<p><em>Parameters</em></p>
<table>
<thead>
<tr>
<th>Param</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>input</td>
<td>string</td>
<td>The string which will be base64 encoded.</td>
</tr>
</tbody>
</table>
<p><em>Returns</em></p>
<p>The base 64 encoded input.</p>
<p><em>Example</em></p>
<div class="codehilite"><pre><span></span><span class="kd">local</span> <span class="n">encoded</span> <span class="o">=</span> <span class="n">nk</span><span class="p">.</span><span class="n">base64_encode</span><span class="p">(</span><span class="s2">&quot;Hello world&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">encoded</span><span class="p">)</span> <span class="c1">-- outputs &quot;SGVsbG8gd29ybGQ=&quot;</span>
</pre></div>


<h3 id="cron">cron<a class="headerlink" href="#cron" title="Permanent link">&para;</a></h3>
<p><strong>cron_next (expression, timestamp)</strong></p>
<p>Parses a CRON expression and a timestamp in UTC seconds, and returns the next matching timestamp in UTC seconds.</p>
<p><em>Parameters</em></p>
<table>
<thead>
<tr>
<th>Param</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>expression</td>
<td>string</td>
<td>A valid CRON expression in standard format, for example "<em> * </em> * *".</td>
</tr>
<tr>
<td>timestamp</td>
<td>number</td>
<td>A time value expressed as UTC seconds.</td>
</tr>
</tbody>
</table>
<p><em>Returns</em></p>
<p>The next UTC seconds timestamp that matches the given CRON expression, and is immediately after the given timestamp.</p>
<p><em>Example</em></p>
<div class="codehilite"><pre><span></span><span class="c1">-- Based on the current time, return the UTC seconds value representing the</span>
<span class="c1">-- nearest upcoming Monday at 00:00 UTC (midnight.)</span>
<span class="kd">local</span> <span class="n">expr</span> <span class="o">=</span> <span class="s2">&quot;0 0 * * 1&quot;</span>
<span class="kd">local</span> <span class="n">ts</span> <span class="o">=</span> <span class="nb">os.time</span><span class="p">()</span>
<span class="kd">local</span> <span class="nb">next</span> <span class="o">=</span> <span class="n">nk</span><span class="p">.</span><span class="n">cron_next</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="n">ts</span><span class="p">)</span>
</pre></div>


<h3 id="groups">groups<a class="headerlink" href="#groups" title="Permanent link">&para;</a></h3>
<p><strong>groups_create (new_groups)</strong></p>
<p>Setup one or more groups with various configuration settings. The groups will be created if they don't exist or fail if the group names are taken.</p>
<p><em>Parameters</em></p>
<table>
<thead>
<tr>
<th>Param</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>new_groups</td>
<td>table</td>
<td>The Lua table array of new groups to create.</td>
</tr>
</tbody>
</table>
<p><em>Example</em></p>
<div class="codehilite"><pre><span></span><span class="kd">local</span> <span class="n">metadata</span> <span class="o">=</span> <span class="p">{</span> <span class="c1">-- Add whatever custom fields you want.</span>
  <span class="n">my_custom_field</span> <span class="o">=</span> <span class="s2">&quot;some value&quot;</span>
<span class="p">}</span>
<span class="kd">local</span> <span class="n">group</span> <span class="o">=</span> <span class="p">{</span>
  <span class="n">Name</span> <span class="o">=</span> <span class="s2">&quot;Some unique group name&quot;</span><span class="p">,</span>
  <span class="n">Description</span> <span class="o">=</span> <span class="s2">&quot;My awesome group.&quot;</span><span class="p">,</span>
  <span class="n">Lang</span> <span class="o">=</span> <span class="s2">&quot;en&quot;</span><span class="p">,</span>
  <span class="n">Private</span> <span class="o">=</span> <span class="kc">true</span><span class="p">,</span>
  <span class="n">CreatorId</span> <span class="o">=</span> <span class="s2">&quot;4c2ae592-b2a7-445e-98ec-697694478b1c&quot;</span><span class="p">,</span>
  <span class="n">AvatarUrl</span> <span class="o">=</span> <span class="s2">&quot;url://somelink&quot;</span><span class="p">,</span>
  <span class="n">Metadata</span> <span class="o">=</span> <span class="n">metadata</span>
<span class="p">}</span>
<span class="kd">local</span> <span class="n">new_groups</span> <span class="o">=</span> <span class="p">{</span> <span class="n">group</span> <span class="p">}</span>
<span class="n">nk</span><span class="p">.</span><span class="n">groups_create</span><span class="p">(</span><span class="n">new_groups</span><span class="p">)</span>
</pre></div>


<p><strong>groups_update (update_groups)</strong></p>
<p>Update one or more groups with various configuration settings. The groups which are updated can change some or all of their fields.</p>
<p><em>Parameters</em></p>
<table>
<thead>
<tr>
<th>Param</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>update_groups</td>
<td>table</td>
<td>A Lua table of groups to be updated.</td>
</tr>
</tbody>
</table>
<p><em>Example</em></p>
<div class="codehilite"><pre><span></span><span class="kd">local</span> <span class="n">metadata</span> <span class="o">=</span> <span class="p">{</span>
  <span class="n">some_field</span> <span class="o">=</span> <span class="s2">&quot;some value&quot;</span>
<span class="p">}</span>
<span class="kd">local</span> <span class="n">group</span> <span class="o">=</span> <span class="p">{</span>
  <span class="n">GroupId</span> <span class="o">=</span> <span class="s2">&quot;f00fa79a-750f-11e7-8626-0fb79f45ff97&quot;</span><span class="p">,</span>
  <span class="n">Description</span> <span class="o">=</span> <span class="s2">&quot;An updated description.&quot;</span><span class="p">,</span>
  <span class="n">Metadata</span> <span class="o">=</span> <span class="n">metadata</span>
<span class="p">}</span>
<span class="kd">local</span> <span class="n">update_groups</span> <span class="o">=</span> <span class="p">{</span> <span class="n">group</span> <span class="p">}</span>
<span class="n">nk</span><span class="p">.</span><span class="n">groups_update</span><span class="p">(</span><span class="n">update_groups</span><span class="p">)</span>
</pre></div>


<p><strong>groups_user_list (user_id)</strong></p>
<p>List all groups which a user belongs to and whether they've been accepted into the group or if it's an invite.</p>
<p><em>Parameters</em></p>
<table>
<thead>
<tr>
<th>Param</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>user_id</td>
<td>string</td>
<td>The Id of the user who's groups you want to list.</td>
</tr>
</tbody>
</table>
<p><em>Returns</em></p>
<p>A list of groups for the user.</p>
<p><em>Example</em></p>
<div class="codehilite"><pre><span></span><span class="kd">local</span> <span class="n">user_id</span> <span class="o">=</span> <span class="s2">&quot;64ef6cb0-7512-11e7-9e52-d7789d80b70b&quot;</span>
<span class="kd">local</span> <span class="n">groups</span> <span class="o">=</span> <span class="n">nk</span><span class="p">.</span><span class="n">groups_user_list</span><span class="p">(</span><span class="n">user_id</span><span class="p">)</span>
<span class="kr">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">g</span> <span class="kr">in</span> <span class="nb">ipairs</span><span class="p">(</span><span class="n">groups</span><span class="p">)</span>
<span class="kr">do</span>
  <span class="kd">local</span> <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;Group name %q with id %q&quot;</span><span class="p">):</span><span class="n">format</span><span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">Name</span><span class="p">,</span> <span class="n">g</span><span class="p">.</span><span class="n">Id</span><span class="p">)</span>
  <span class="nb">print</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
<span class="kr">end</span>
</pre></div>


<p><strong>group_users_list (group_id)</strong></p>
<p>List all members and admins which belong to a group.</p>
<p><em>Parameters</em></p>
<table>
<thead>
<tr>
<th>Param</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>group_id</td>
<td>string</td>
<td>The Id of the group who's members and admins you want to list.</td>
</tr>
</tbody>
</table>
<p><em>Returns</em></p>
<p>The members and admins for the group.</p>
<p><em>Example</em></p>
<div class="codehilite"><pre><span></span><span class="kd">local</span> <span class="n">group_id</span> <span class="o">=</span> <span class="s2">&quot;a1aafe16-7540-11e7-9738-13777fcc7cd8&quot;</span>
<span class="kd">local</span> <span class="n">members</span> <span class="o">=</span> <span class="n">nk</span><span class="p">.</span><span class="n">group_users_list</span><span class="p">(</span><span class="n">group_id</span><span class="p">)</span>
<span class="kr">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">m</span> <span class="kr">in</span> <span class="nb">ipairs</span><span class="p">(</span><span class="n">members</span><span class="p">)</span>
<span class="kr">do</span>
  <span class="kd">local</span> <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;Member handle %q has status %q&quot;</span><span class="p">):</span><span class="n">format</span><span class="p">(</span><span class="n">m</span><span class="p">.</span><span class="n">Handle</span><span class="p">,</span> <span class="n">m</span><span class="p">.</span><span class="n">Type</span><span class="p">)</span>
  <span class="nb">print</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
<span class="kr">end</span>
</pre></div>


<h3 id="http">http<a class="headerlink" href="#http" title="Permanent link">&para;</a></h3>
<p><strong>http_request (url, method, headers, content)</strong></p>
<p>Send a HTTP request and receive the result as a Lua table.</p>
<p><em>Parameters</em></p>
<table>
<thead>
<tr>
<th>Param</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>url</td>
<td>string</td>
<td>The URL of the web resource to request.</td>
</tr>
<tr>
<td>method</td>
<td>string</td>
<td>The HTTP method verb used with the request.</td>
</tr>
<tr>
<td>headers</td>
<td>table</td>
<td>A table of headers used with the request.</td>
</tr>
<tr>
<td>content</td>
<td>string</td>
<td>The bytes to send with the request.</td>
</tr>
</tbody>
</table>
<p><em>Returns</em></p>
<p><code>code, headers, body</code> - Multiple return values for the HTTP response.</p>
<p><em>Example</em></p>
<div class="codehilite"><pre><span></span><span class="kd">local</span> <span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;https://google.com/&quot;</span>
<span class="kd">local</span> <span class="n">method</span> <span class="o">=</span> <span class="s2">&quot;HEAD&quot;</span>
<span class="kd">local</span> <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
  <span class="p">[</span><span class="s2">&quot;Content-Type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;application/json&quot;</span><span class="p">,</span>
  <span class="p">[</span><span class="s2">&quot;Accept&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;application/json&quot;</span>
<span class="p">}</span>
<span class="kd">local</span> <span class="n">content</span> <span class="o">=</span> <span class="n">nk</span><span class="p">.</span><span class="n">json_encode</span><span class="p">({})</span> <span class="c1">-- encode table as JSON string</span>
<span class="kd">local</span> <span class="n">success</span><span class="p">,</span> <span class="n">code</span><span class="p">,</span> <span class="n">headers</span><span class="p">,</span> <span class="n">body</span> <span class="o">=</span> <span class="nb">pcall</span><span class="p">(</span><span class="n">nk</span><span class="p">.</span><span class="n">http_request</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="n">headers</span><span class="p">,</span> <span class="n">content</span><span class="p">)</span>
<span class="kr">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">success</span><span class="p">)</span> <span class="kr">then</span>
  <span class="n">nk</span><span class="p">.</span><span class="n">logger_error</span><span class="p">((</span><span class="s2">&quot;Failed %q&quot;</span><span class="p">):</span><span class="n">format</span><span class="p">(</span><span class="n">code</span><span class="p">))</span>
<span class="kr">elseif</span> <span class="p">(</span><span class="n">code</span> <span class="o">&gt;=</span> <span class="mi">400</span><span class="p">)</span> <span class="kr">then</span>
  <span class="n">nk</span><span class="p">.</span><span class="n">logger_error</span><span class="p">((</span><span class="s2">&quot;Failed %q %q&quot;</span><span class="p">):</span><span class="n">format</span><span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="n">body</span><span class="p">))</span>
<span class="kr">else</span>
  <span class="n">nk</span><span class="p">.</span><span class="n">logger_info</span><span class="p">((</span><span class="s2">&quot;Success %q %q&quot;</span><span class="p">):</span><span class="n">format</span><span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="n">body</span><span class="p">))</span>
<span class="kr">end</span>
</pre></div>


<h3 id="json">json<a class="headerlink" href="#json" title="Permanent link">&para;</a></h3>
<p><strong>json_decode (input)</strong></p>
<p>Decode the JSON input as a Lua table.</p>
<p><em>Parameters</em></p>
<table>
<thead>
<tr>
<th>Param</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>input</td>
<td>string</td>
<td>The JSON encoded input.</td>
</tr>
</tbody>
</table>
<p><em>Returns</em></p>
<p>A Lua table with the decoded JSON.</p>
<p><em>Example</em></p>
<div class="codehilite"><pre><span></span><span class="kd">local</span> <span class="n">json</span> <span class="o">=</span> <span class="n">nk</span><span class="p">.</span><span class="n">json_decode</span><span class="p">(</span><span class="s1">&#39;{&quot;hello&quot;: &quot;world&quot;}&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">json</span><span class="p">.</span><span class="n">hello</span><span class="p">)</span>
</pre></div>


<hr />
<p><strong>json_encode (input)</strong></p>
<p>Encode the input as JSON.</p>
<p><em>Parameters</em></p>
<table>
<thead>
<tr>
<th>Param</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>input</td>
<td>string</td>
<td>The input to encode as JSON.</td>
</tr>
</tbody>
</table>
<p><em>Returns</em></p>
<p>The encoded JSON string.</p>
<p><em>Example</em></p>
<div class="codehilite"><pre><span></span><span class="kd">local</span> <span class="n">input</span> <span class="o">=</span> <span class="p">{[</span><span class="s2">&quot;some&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;json&quot;</span><span class="p">}</span>
<span class="kd">local</span> <span class="n">json</span> <span class="o">=</span> <span class="n">nk</span><span class="p">.</span><span class="n">json_encode</span><span class="p">(</span><span class="n">input</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">json</span><span class="p">)</span> <span class="c1">-- outputs &#39;{&quot;some&quot;: &quot;json&quot;}&#39;</span>
</pre></div>


<h3 id="leaderboard">leaderboard<a class="headerlink" href="#leaderboard" title="Permanent link">&para;</a></h3>
<p><strong>leaderboard_create (id, sort, reset, metadata, authoritative)</strong></p>
<p>Setup a new dynamic leaderboard with the specified ID and various configuration settings. The leaderboard will be created if it doesn't already exist.</p>
<p><em>Parameters</em></p>
<table>
<thead>
<tr>
<th>Param</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>id</td>
<td>string</td>
<td>The unique identifier for the new leaderboard. This is used by clients to submit scores.</td>
</tr>
<tr>
<td>sort</td>
<td>string</td>
<td>The sort order for records in the leaderboard; possible values are "asc" or "desc".</td>
</tr>
<tr>
<td>reset</td>
<td>string</td>
<td>The cron format used to define the reset schedule for the leaderboard. This controls when a leaderboard is reset and can be used to power daily/weekly/monthly leaderboards.</td>
</tr>
<tr>
<td>metadata</td>
<td>table</td>
<td>The metadata you want associated to the leaderboard. Some good examples are weather conditions for a racing game.</td>
</tr>
<tr>
<td>authoritative</td>
<td>bool</td>
<td>Mark the leaderboard as authoritative which ensures updates can only be made via the Lua runtime. No client can submit a score directly.</td>
</tr>
</tbody>
</table>
<p><em>Example</em></p>
<div class="codehilite"><pre><span></span><span class="kd">local</span> <span class="n">metadata</span> <span class="o">=</span> <span class="p">{</span>
  <span class="n">weather_conditions</span> <span class="o">=</span> <span class="s2">&quot;rain&quot;</span>
<span class="p">}</span>
<span class="kd">local</span> <span class="n">id</span> <span class="o">=</span> <span class="s2">&quot;4ec4f126-3f9d-11e7-84ef-b7c182b36521&quot;</span>
<span class="n">nk</span><span class="p">.</span><span class="n">leaderboard_create</span><span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="s2">&quot;desc&quot;</span><span class="p">,</span> <span class="s2">&quot;0 0 * * 1&quot;</span><span class="p">,</span> <span class="n">metadata</span><span class="p">,</span> <span class="kc">false</span><span class="p">)</span>
</pre></div>


<hr />
<p><strong>leaderboard_submit_set (id, value, owner, handle, lang, location, timezone, metadata)</strong></p>
<p>The set operator will submit the value and replace any current value for the owner.</p>
<p><strong>leaderboard_submit_best (id, value, owner, handle, lang, location, timezone, metadata)</strong></p>
<p>The best operator will check the new score is better than the current score and keep whichever value is best based on the sort order of the leaderboard. If no score exists this operator works like "set".</p>
<p><strong>leaderboard_submit_incr (id, value, owner, handle, lang, location, timezone, metadata)</strong></p>
<p>The increment operator will add the score value to the current score. If no score exists the new score will be added to 0.</p>
<p><strong>leaderboard_submit_decr (id, value, owner, handle, lang, location, timezone, metadata)</strong></p>
<p>The decrement operator will subtract the score value from the current score. If no score exists the new score will be subtracted from 0.</p>
<p><em>Parameters</em></p>
<table>
<thead>
<tr>
<th>Param</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>id</td>
<td>string</td>
<td>The unique identifier for the leaderboard to submit to. Mandatory field.</td>
</tr>
<tr>
<td>value</td>
<td>number</td>
<td>The value to update the leaderboard with. Mandatory field.</td>
</tr>
<tr>
<td>owner</td>
<td>string</td>
<td>The owner of this submission. Mandatory field.</td>
</tr>
<tr>
<td>handle</td>
<td>string</td>
<td>The owner handle of this submission. Optional.</td>
</tr>
<tr>
<td>lang</td>
<td>string</td>
<td>The language you want to associate with this submission. Optional.</td>
</tr>
<tr>
<td>location</td>
<td>string</td>
<td>The location you want to associate with this submission. Optional.</td>
</tr>
<tr>
<td>timezone</td>
<td>string</td>
<td>The timezone you want to associate with this submission. Optional.</td>
</tr>
<tr>
<td>metadata</td>
<td>table</td>
<td>The metadata you want associated to this submission. Some good examples are weather conditions for a racing game.</td>
</tr>
</tbody>
</table>
<p><em>Example</em></p>
<div class="codehilite"><pre><span></span><span class="kd">local</span> <span class="n">metadata</span> <span class="o">=</span> <span class="p">{</span>
  <span class="n">weather_conditions</span> <span class="o">=</span> <span class="s2">&quot;rain&quot;</span>
<span class="p">}</span>
<span class="kd">local</span> <span class="n">id</span> <span class="o">=</span> <span class="s2">&quot;4ec4f126-3f9d-11e7-84ef-b7c182b36521&quot;</span>
<span class="kd">local</span> <span class="n">owner_id</span> <span class="o">=</span> <span class="s2">&quot;4c2ae592-b2a7-445e-98ec-697694478b1c&quot;</span>
<span class="kd">local</span> <span class="n">handle</span> <span class="o">=</span> <span class="s2">&quot;02ebb2c8&quot;</span>
<span class="n">nk</span><span class="p">.</span><span class="n">leaderboard_submit_set</span><span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="n">owner_id</span><span class="p">,</span> <span class="n">handle</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">metadata</span><span class="p">)</span>
</pre></div>


<hr />
<p><strong>leaderboard_records_list_user (id, owner, limit)</strong></p>
<p>List records on the specified leaderboard, automatically paginating down to where the given user is on this leaderboard. If the user has no record on the given leaderboard will return no records.</p>
<p><em>Parameters</em></p>
<table>
<thead>
<tr>
<th>Param</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>id</td>
<td>string</td>
<td>The unique identifier of the leaderboard to list from. Mandatory field.</td>
</tr>
<tr>
<td>owner</td>
<td>string</td>
<td>The record owner to find in the leaderboard. Mandatory field.</td>
</tr>
<tr>
<td>limit</td>
<td>number</td>
<td>The maximum number of records to return, from 10 to 100. Mandatory field.</td>
</tr>
</tbody>
</table>
<p><em>Returns</em></p>
<p>A page of leaderboard records and optionally a cursor that can be used to retrieve the next page, if any.</p>
<p><em>Example</em></p>
<div class="codehilite"><pre><span></span><span class="kd">local</span> <span class="n">id</span> <span class="o">=</span> <span class="s2">&quot;4ec4f126-3f9d-11e7-84ef-b7c182b36521&quot;</span>
<span class="kd">local</span> <span class="n">owner_id</span> <span class="o">=</span> <span class="s2">&quot;4c2ae592-b2a7-445e-98ec-697694478b1c&quot;</span>
<span class="kd">local</span> <span class="n">limit</span> <span class="o">=</span> <span class="mi">10</span>
<span class="kd">local</span> <span class="n">records</span><span class="p">,</span> <span class="n">cursor</span> <span class="o">=</span> <span class="n">nk</span><span class="p">.</span><span class="n">leaderboard_records_list_user</span><span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="n">owner_id</span><span class="p">,</span> <span class="n">limit</span><span class="p">)</span>
</pre></div>


<hr />
<p><strong>leaderboard_records_list_users (id, owners, limit)</strong></p>
<p>List records on the specified leaderboard, filtering to only the records owned by the given list of users. If one or more of the given users have no record on the given leaderboard they will be omitted from the results.</p>
<p><em>Parameters</em></p>
<table>
<thead>
<tr>
<th>Param</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>id</td>
<td>string</td>
<td>The unique identifier of the leaderboard to list from. Mandatory field.</td>
</tr>
<tr>
<td>owners</td>
<td>table</td>
<td>A set of owner IDs to retrieve records for. Mandatory field.</td>
</tr>
<tr>
<td>limit</td>
<td>number</td>
<td>The maximum number of records to return, from 10 to 100. Mandatory field.</td>
</tr>
<tr>
<td>cursor</td>
<td>string</td>
<td>A previous cursor value if paginating to the next page of results. Optional.</td>
</tr>
</tbody>
</table>
<p><em>Returns</em></p>
<p>A page of leaderboard records and optionally a cursor that can be used to retrieve the next page, if any.</p>
<p><em>Example</em></p>
<div class="codehilite"><pre><span></span><span class="kd">local</span> <span class="n">id</span> <span class="o">=</span> <span class="s2">&quot;4ec4f126-3f9d-11e7-84ef-b7c182b36521&quot;</span>
<span class="kd">local</span> <span class="n">owners</span> <span class="o">=</span> <span class="p">{</span>
  <span class="s2">&quot;4c2ae592-b2a7-445e-98ec-697694478b1c&quot;</span><span class="p">,</span>
  <span class="s2">&quot;f15526e8-6cf8-49a8-b4c8-0b1e4c32a1d7&quot;</span>
<span class="p">}</span>
<span class="kd">local</span> <span class="n">limit</span> <span class="o">=</span> <span class="mi">10</span>
<span class="kd">local</span> <span class="n">previous_cursor</span> <span class="o">=</span> <span class="kc">nil</span>
<span class="kd">local</span> <span class="n">records</span><span class="p">,</span> <span class="n">cursor</span> <span class="o">=</span> <span class="n">nk</span><span class="p">.</span><span class="n">leaderboard_records_list_users</span><span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="n">owner_ids</span><span class="p">,</span> <span class="n">limit</span><span class="p">,</span> <span class="n">previous_cursor</span><span class="p">)</span>
</pre></div>


<h3 id="logger">logger<a class="headerlink" href="#logger" title="Permanent link">&para;</a></h3>
<p><strong>logger_error (message)</strong></p>
<p>Write an ERROR level message to the server logs.</p>
<p><em>Parameters</em></p>
<table>
<thead>
<tr>
<th>Param</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>message</td>
<td>string</td>
<td>The message to write to server logs with ERROR level severity.</td>
</tr>
</tbody>
</table>
<p><em>Returns</em></p>
<p>(string) - The message which was written to the logs.</p>
<p><em>Example</em></p>
<div class="codehilite"><pre><span></span><span class="kd">local</span> <span class="n">message</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;%q - %q&quot;</span><span class="p">):</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;hello&quot;</span><span class="p">,</span> <span class="s2">&quot;world&quot;</span><span class="p">)</span>
<span class="n">nk</span><span class="p">.</span><span class="n">logger_error</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
</pre></div>


<hr />
<p><strong>logger_info (message)</strong></p>
<p>Write an INFO level message to the server logs.</p>
<p><em>Parameters</em></p>
<table>
<thead>
<tr>
<th>Param</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>message</td>
<td>string</td>
<td>The message to write to server logs with INFO level severity.</td>
</tr>
</tbody>
</table>
<p><em>Returns</em></p>
<p>(string) - The message which was written to the logs.</p>
<p><em>Example</em></p>
<div class="codehilite"><pre><span></span><span class="kd">local</span> <span class="n">message</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;%q - %q&quot;</span><span class="p">):</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;hello&quot;</span><span class="p">,</span> <span class="s2">&quot;world&quot;</span><span class="p">)</span>
<span class="n">nk</span><span class="p">.</span><span class="n">logger_info</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
</pre></div>


<hr />
<p><strong>logger_warn (message)</strong></p>
<p>Write an WARN level message to the server logs.</p>
<p><em>Parameters</em></p>
<table>
<thead>
<tr>
<th>Param</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>message</td>
<td>string</td>
<td>The message to write to server logs with WARN level severity.</td>
</tr>
</tbody>
</table>
<p><em>Returns</em></p>
<p>(string) - The message which was written to the logs.</p>
<p><em>Example</em></p>
<div class="codehilite"><pre><span></span><span class="kd">local</span> <span class="n">message</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;%q - %q&quot;</span><span class="p">):</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;hello&quot;</span><span class="p">,</span> <span class="s2">&quot;world&quot;</span><span class="p">)</span>
<span class="n">nk</span><span class="p">.</span><span class="n">logger_warn</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
</pre></div>


<h3 id="notifications">notifications<a class="headerlink" href="#notifications" title="Permanent link">&para;</a></h3>
<p><strong>notifications_send_id (new_notifications)</strong></p>
<p>Send one or more in-app notifications to a user. Have a look at the section on <a href="../social-in-app-notifications/">in-app notifications</a>.</p>
<p><em>Parameters</em></p>
<table>
<thead>
<tr>
<th>Param</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>new_notifications</td>
<td>table</td>
<td>The Lua table array of notifications to send.</td>
</tr>
</tbody>
</table>
<p><em>Example</em></p>
<div class="codehilite"><pre><span></span><span class="kd">local</span> <span class="n">subject</span> <span class="o">=</span> <span class="s2">&quot;You&#39;ve unlocked level 100!&quot;</span>
<span class="kd">local</span> <span class="n">content</span> <span class="o">=</span> <span class="n">nk</span><span class="p">.</span><span class="n">json_encode</span><span class="p">({</span>
  <span class="n">reward_coins</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="p">})</span>
<span class="kd">local</span> <span class="n">user_id</span> <span class="o">=</span> <span class="s2">&quot;4c2ae592-b2a7-445e-98ec-697694478b1c&quot;</span> <span class="c1">-- who to send</span>
<span class="kd">local</span> <span class="n">code</span> <span class="o">=</span> <span class="mi">101</span>

<span class="kd">local</span> <span class="n">new_notifications</span> <span class="o">=</span> <span class="p">{</span>
  <span class="p">{</span> <span class="n">Subject</span> <span class="o">=</span> <span class="n">subject</span><span class="p">,</span> <span class="n">Content</span> <span class="o">=</span> <span class="n">content</span><span class="p">,</span> <span class="n">UserId</span> <span class="o">=</span> <span class="n">user_id</span><span class="p">,</span> <span class="n">Code</span> <span class="o">=</span> <span class="n">code</span><span class="p">,</span> <span class="n">Persistent</span> <span class="o">=</span> <span class="kc">true</span><span class="p">}</span>
<span class="p">}</span>
<span class="n">nk</span><span class="p">.</span><span class="n">notifications_send_id</span><span class="p">(</span><span class="n">new_notifications</span><span class="p">)</span>
</pre></div>


<h3 id="register-hooks">register hooks<a class="headerlink" href="#register-hooks" title="Permanent link">&para;</a></h3>
<p><strong>register_after (func, msgname)</strong></p>
<p>Register a function with the server which will be executed after every message with the specified message name.</p>
<p>This can be used to apply custom logic to standard features in the server. Similar to the <code>register_before</code> function but it will not block the execution pipeline. The logic will be executed in parallel to any response message sent back to a client. Have a look at the section on <a href="../runtime-code-basics/">runtime code basics</a>.</p>
<p><em>Parameters</em></p>
<table>
<thead>
<tr>
<th>Param</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>func</td>
<td>function</td>
<td>A function reference which will be executed on each <code>msgname</code> message.</td>
</tr>
<tr>
<td>msgname</td>
<td>string</td>
<td>The specific message name to execute the <code>func</code> function after.</td>
</tr>
</tbody>
</table>
<p><em>Example</em></p>
<div class="codehilite"><pre><span></span><span class="kd">local</span> <span class="kr">function</span> <span class="nf">my_func</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">payload</span><span class="p">)</span>
  <span class="c1">-- run some code</span>
<span class="kr">end</span>
<span class="n">nk</span><span class="p">.</span><span class="n">register_after</span><span class="p">(</span><span class="n">my_func</span><span class="p">,</span> <span class="s2">&quot;tfriendsadd&quot;</span><span class="p">)</span>
</pre></div>


<hr />
<p><strong>register_before (func, msgname)</strong></p>
<p>Register a function with the server which will be executed before every message with the specified message name.</p>
<p>For example <code>register_before(somefunc, "tfriendsadd")</code> will execute the function before the Friend Add message is executed by the server's message pipeline. This can be used to apply custom conditions to standard features in the server. Have a look at the section on <a href="../runtime-code-basics/">runtime code basics</a>.</p>
<p><em>Parameters</em></p>
<table>
<thead>
<tr>
<th>Param</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>func</td>
<td>function</td>
<td>A function reference which will be executed on each <code>msgname</code> message.</td>
</tr>
<tr>
<td>msgname</td>
<td>string</td>
<td>The specific message name to execute the <code>func</code> function before.</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <code>func</code> should pass the <code>payload</code> back as a return argument so the pipeline can continue to execute the standard logic.</p>
</div>
<p><em>Example</em></p>
<div class="codehilite"><pre><span></span><span class="kd">local</span> <span class="kr">function</span> <span class="nf">my_func</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">payload</span><span class="p">)</span>
  <span class="c1">-- run some code</span>
  <span class="kr">return</span> <span class="n">payload</span> <span class="c1">-- important!</span>
<span class="kr">end</span>
<span class="n">nk</span><span class="p">.</span><span class="n">register_before</span><span class="p">(</span><span class="n">my_func</span><span class="p">,</span> <span class="s2">&quot;tfriendsadd&quot;</span><span class="p">)</span>
</pre></div>


<hr />
<p><strong>register_http (func, path)</strong></p>
<p>Registers a HTTP endpoint within the server.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>This should not be used to implement custom client functions instead have a look at <code>register_rpc</code>.</p>
</div>
<p>This can be useful to define web callbacks to handle various Ad networks. It can also be used to enable server to server communication to ease the integration of Nakama server into various server stacks. Have a look at the section on <a href="../runtime-code-basics/">runtime code basics</a>.</p>
<p><em>Parameters</em></p>
<table>
<thead>
<tr>
<th>Param</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>func</td>
<td>function</td>
<td>A function reference which will be executed on each HTTP call.</td>
</tr>
<tr>
<td>path</td>
<td>string</td>
<td>The path that should be registered as a HTTP endpoint.</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <code>func</code> can pass <code>nil</code> or <code>table</code> back as a return argument which will determine the HTTP response code returned.</p>
</div>
<p><em>Example</em></p>
<div class="codehilite"><pre><span></span><span class="kd">local</span> <span class="kr">function</span> <span class="nf">my_func</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">payload</span><span class="p">)</span>
  <span class="c1">-- let&#39;s return the &quot;context&quot; as JSON back in the HTTP response body</span>
  <span class="kr">return</span> <span class="n">context</span>
<span class="kr">end</span>
<span class="n">nk</span><span class="p">.</span><span class="n">register_http</span><span class="p">(</span><span class="n">my_func</span><span class="p">,</span> <span class="s2">&quot;/my_endpoint&quot;</span><span class="p">)</span>
<span class="c1">-- &quot;my_func&quot; will be registered at &#39;POST /runtime/my_endpoint&#39;</span>
</pre></div>


<p>You can send a request to the HTTP endpoint with JSON and responses will be returned in JSON.</p>
<div class="codehilite"><pre><span></span>curl -X POST http://127.0.0.1:7350/runtime/my_endpoint?key<span class="o">=</span>defaultkey <span class="se">\</span>
     -d <span class="s1">&#39;{&quot;some&quot;: &quot;data&quot;}&#39;</span> <span class="se">\</span>
     -H <span class="s1">&#39;Content-Type: application/json&#39;</span> <span class="se">\</span>
     -H <span class="s1">&#39;Accept: application/json&#39;</span>
</pre></div>


<hr />
<p><strong>register_rpc (func, id)</strong></p>
<p>Registers a function for use with client RPC to the server.</p>
<p>The ID can be any string identifier and is sent by the client. The ID is used to map the client RPC message to the specific function to execute. Have a look at the section on <a href="../runtime-code-basics/">runtime code basics</a>.</p>
<p><em>Parameters</em></p>
<table>
<thead>
<tr>
<th>Param</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>func</td>
<td>function</td>
<td>A function reference which will be executed on each RPC message.</td>
</tr>
<tr>
<td>id</td>
<td>string</td>
<td>The unique identifier used to register the <code>func</code> function for RPC.</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <code>func</code> can pass <code>nil</code> or <code>string</code> back as a return argument which will returned as bytes in the RPC response.</p>
</div>
<p><em>Example</em></p>
<div class="codehilite"><pre><span></span><span class="kd">local</span> <span class="kr">function</span> <span class="nf">my_func</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">payload</span><span class="p">)</span>
  <span class="c1">-- run some code</span>
<span class="kr">end</span>
<span class="n">nk</span><span class="p">.</span><span class="n">register_rpc</span><span class="p">(</span><span class="n">my_func</span><span class="p">,</span> <span class="s2">&quot;my_func_id&quot;</span><span class="p">)</span>
</pre></div>


<h3 id="storage">storage<a class="headerlink" href="#storage" title="Permanent link">&para;</a></h3>
<p><strong>storage_fetch (record_keys)</strong></p>
<p>Fetch one or more records by their bucket/collection/keyname and optional user.</p>
<p><em>Parameters</em></p>
<table>
<thead>
<tr>
<th>Param</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>record_keys</td>
<td>table</td>
<td>A table array of record identifiers to be fetched.</td>
</tr>
</tbody>
</table>
<p><em>Returns</em></p>
<p>A table array of the records result set.</p>
<p><em>Example</em></p>
<div class="codehilite"><pre><span></span><span class="kd">local</span> <span class="n">user_id</span> <span class="o">=</span> <span class="s2">&quot;4ec4f126-3f9d-11e7-84ef-b7c182b36521&quot;</span> <span class="c1">-- some user ID.</span>
<span class="kd">local</span> <span class="n">record_keys</span> <span class="o">=</span> <span class="p">{</span>
  <span class="p">{</span><span class="n">Bucket</span> <span class="o">=</span> <span class="s2">&quot;mygame&quot;</span><span class="p">,</span> <span class="n">Collection</span> <span class="o">=</span> <span class="s2">&quot;save&quot;</span><span class="p">,</span> <span class="n">Record</span> <span class="o">=</span> <span class="s2">&quot;save1&quot;</span><span class="p">,</span> <span class="n">UserId</span> <span class="o">=</span> <span class="n">user_id</span><span class="p">},</span>
  <span class="p">{</span><span class="n">Bucket</span> <span class="o">=</span> <span class="s2">&quot;mygame&quot;</span><span class="p">,</span> <span class="n">Collection</span> <span class="o">=</span> <span class="s2">&quot;save&quot;</span><span class="p">,</span> <span class="n">Record</span> <span class="o">=</span> <span class="s2">&quot;save2&quot;</span><span class="p">,</span> <span class="n">UserId</span> <span class="o">=</span> <span class="n">user_id</span><span class="p">},</span>
  <span class="p">{</span><span class="n">Bucket</span> <span class="o">=</span> <span class="s2">&quot;mygame&quot;</span><span class="p">,</span> <span class="n">Collection</span> <span class="o">=</span> <span class="s2">&quot;save&quot;</span><span class="p">,</span> <span class="n">Record</span> <span class="o">=</span> <span class="s2">&quot;save3&quot;</span><span class="p">,</span> <span class="n">UserId</span> <span class="o">=</span> <span class="n">user_id</span><span class="p">}</span>
<span class="p">}</span>
<span class="kd">local</span> <span class="n">records</span> <span class="o">=</span> <span class="n">nk</span><span class="p">.</span><span class="n">storage_fetch</span><span class="p">(</span><span class="n">record_keys</span><span class="p">)</span>
<span class="kr">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">r</span> <span class="kr">in</span> <span class="nb">ipairs</span><span class="p">(</span><span class="n">records</span><span class="p">)</span>
<span class="kr">do</span>
  <span class="kd">local</span> <span class="n">message</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;read: %q, write: %q, value: %q&quot;</span><span class="p">):</span><span class="n">format</span><span class="p">(</span><span class="n">r</span><span class="p">.</span><span class="n">PermissionRead</span><span class="p">,</span> <span class="n">r</span><span class="p">.</span><span class="n">PermissionWrite</span><span class="p">,</span> <span class="n">r</span><span class="p">.</span><span class="n">Value</span><span class="p">)</span>
  <span class="nb">print</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
<span class="kr">end</span>
</pre></div>


<hr />
<p><strong>storage_list (user_id, bucket, collection, limit, cursor)</strong></p>
<p>You can list records in a collection and page through results. The records returned can be filtered to those owned by the user or "" for public records which aren't owned by a user.</p>
<p><em>Parameters</em></p>
<table>
<thead>
<tr>
<th>Param</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>user_id</td>
<td>string</td>
<td>User ID or "" (empty string) for public records.</td>
</tr>
<tr>
<td>bucket</td>
<td>string</td>
<td>Bucket to list data from.</td>
</tr>
<tr>
<td>collection</td>
<td>string</td>
<td>Collection to list data from.</td>
</tr>
<tr>
<td>limit</td>
<td>number</td>
<td>Limit number of records retrieved. Min 10, Max 100.</td>
</tr>
<tr>
<td>cursor</td>
<td>string</td>
<td>Pagination cursor from previous result. If none available set to nil or "" (empty string).</td>
</tr>
</tbody>
</table>
<p><em>Returns</em></p>
<p>A table array of the records result set.</p>
<p><em>Example</em></p>
<div class="codehilite"><pre><span></span><span class="kd">local</span> <span class="n">user_id</span> <span class="o">=</span> <span class="s2">&quot;4ec4f126-3f9d-11e7-84ef-b7c182b36521&quot;</span> <span class="c1">-- some user ID.</span>
<span class="kd">local</span> <span class="n">records</span> <span class="o">=</span> <span class="n">nk</span><span class="p">.</span><span class="n">storage_list</span><span class="p">(</span><span class="n">user_id</span><span class="p">,</span> <span class="s2">&quot;bucket&quot;</span><span class="p">,</span> <span class="s2">&quot;collection&quot;</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
<span class="kr">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">r</span> <span class="kr">in</span> <span class="nb">ipairs</span><span class="p">(</span><span class="n">records</span><span class="p">)</span>
<span class="kr">do</span>
  <span class="kd">local</span> <span class="n">message</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;read: %q, write: %q, value: %q&quot;</span><span class="p">):</span><span class="n">format</span><span class="p">(</span><span class="n">r</span><span class="p">.</span><span class="n">PermissionRead</span><span class="p">,</span> <span class="n">r</span><span class="p">.</span><span class="n">PermissionWrite</span><span class="p">,</span> <span class="n">r</span><span class="p">.</span><span class="n">Value</span><span class="p">)</span>
  <span class="nb">print</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
<span class="kr">end</span>
</pre></div>


<hr />
<p><strong>storage_remove (record_keys)</strong></p>
<p>Remove one or more records by their bucket/collection/keyname and optional user.</p>
<p><em>Parameters</em></p>
<table>
<thead>
<tr>
<th>Param</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>record_keys</td>
<td>table</td>
<td>A table array of record identifiers to be removed.</td>
</tr>
</tbody>
</table>
<p><em>Example</em></p>
<div class="codehilite"><pre><span></span><span class="kd">local</span> <span class="n">user_id</span> <span class="o">=</span> <span class="s2">&quot;4ec4f126-3f9d-11e7-84ef-b7c182b36521&quot;</span> <span class="c1">-- some user ID.</span>
<span class="kd">local</span> <span class="n">friend_user_id</span> <span class="o">=</span> <span class="s2">&quot;8d98ee3f-8c9f-42c5-b6c9-c8f79ad1b820&quot;</span> <span class="c1">-- friend ID.</span>
<span class="kd">local</span> <span class="n">record_keys</span> <span class="o">=</span> <span class="p">{</span>
  <span class="p">{</span><span class="n">Bucket</span> <span class="o">=</span> <span class="s2">&quot;mygame&quot;</span><span class="p">,</span> <span class="n">Collection</span> <span class="o">=</span> <span class="s2">&quot;save&quot;</span><span class="p">,</span> <span class="n">Record</span> <span class="o">=</span> <span class="s2">&quot;save1&quot;</span><span class="p">,</span> <span class="n">UserId</span> <span class="o">=</span> <span class="n">user_id</span><span class="p">},</span>
  <span class="p">{</span><span class="n">Bucket</span> <span class="o">=</span> <span class="s2">&quot;mygame&quot;</span><span class="p">,</span> <span class="n">Collection</span> <span class="o">=</span> <span class="s2">&quot;save&quot;</span><span class="p">,</span> <span class="n">Record</span> <span class="o">=</span> <span class="s2">&quot;save2&quot;</span><span class="p">,</span> <span class="n">UserId</span> <span class="o">=</span> <span class="n">user_id</span><span class="p">},</span>
  <span class="p">{</span><span class="n">Bucket</span> <span class="o">=</span> <span class="s2">&quot;mygame&quot;</span><span class="p">,</span> <span class="n">Collection</span> <span class="o">=</span> <span class="s2">&quot;public&quot;</span><span class="p">,</span> <span class="n">Record</span> <span class="o">=</span> <span class="s2">&quot;progress&quot;</span><span class="p">,</span> <span class="n">UserId</span> <span class="o">=</span> <span class="n">friend_user_id</span><span class="p">}</span>
<span class="p">}</span>
<span class="n">nk</span><span class="p">.</span><span class="n">storage_remove</span><span class="p">(</span><span class="n">record_keys</span><span class="p">)</span>
</pre></div>


<hr />
<p><strong>storage_update (record_keys)</strong></p>
<p>Update one or more records by their bucket/collection/keyname and optional user. Have a look at the section on <a href="../storage-collections/">storage collections</a>.</p>
<p><em>Parameters</em></p>
<table>
<thead>
<tr>
<th>Param</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>record_keys</td>
<td>table</td>
<td>A table array of records to update.</td>
</tr>
</tbody>
</table>
<p><em>Example</em></p>
<div class="codehilite"><pre><span></span><span class="kd">local</span> <span class="n">user_id</span> <span class="o">=</span> <span class="s2">&quot;4ec4f126-3f9d-11e7-84ef-b7c182b36521&quot;</span> <span class="c1">-- some user ID.</span>
<span class="kd">local</span> <span class="n">now</span> <span class="o">=</span> <span class="nb">os.time</span><span class="p">()</span> <span class="o">*</span> <span class="mi">1000</span> <span class="c1">-- current time converted for msec</span>
<span class="kd">local</span> <span class="n">update_ops</span> <span class="o">=</span> <span class="p">{</span>
  <span class="p">{</span><span class="n">Op</span> <span class="o">=</span> <span class="s2">&quot;init&quot;</span><span class="p">,</span> <span class="n">Path</span> <span class="o">=</span> <span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="n">Value</span> <span class="o">=</span> <span class="p">{</span> <span class="n">progress</span> <span class="o">=</span> <span class="mi">1</span> <span class="p">}},</span>
  <span class="p">{</span><span class="n">Op</span> <span class="o">=</span> <span class="s2">&quot;incr&quot;</span><span class="p">,</span> <span class="n">Path</span> <span class="o">=</span> <span class="s2">&quot;/progress&quot;</span><span class="p">,</span> <span class="n">Value</span> <span class="o">=</span> <span class="mi">1</span><span class="p">},</span>
  <span class="p">{</span><span class="n">Op</span> <span class="o">=</span> <span class="s2">&quot;replace&quot;</span><span class="p">,</span> <span class="n">Path</span> <span class="o">=</span> <span class="s2">&quot;/updated_at&quot;</span><span class="p">,</span> <span class="n">Value</span> <span class="o">=</span> <span class="n">now</span><span class="p">}</span>
<span class="p">}</span>
<span class="kd">local</span> <span class="n">record_keys</span> <span class="o">=</span> <span class="p">{</span>
  <span class="p">{</span><span class="n">Bucket</span> <span class="o">=</span> <span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="n">Collection</span> <span class="o">=</span> <span class="s2">&quot;c&quot;</span><span class="p">,</span> <span class="n">Record</span> <span class="o">=</span> <span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">UserId</span> <span class="o">=</span> <span class="n">user_id</span><span class="p">,</span> <span class="n">Update</span> <span class="o">=</span> <span class="n">update_ops</span><span class="p">},</span>
  <span class="p">{</span><span class="n">Bucket</span> <span class="o">=</span> <span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="n">Collection</span> <span class="o">=</span> <span class="s2">&quot;c&quot;</span><span class="p">,</span> <span class="n">Record</span> <span class="o">=</span> <span class="s2">&quot;r2&quot;</span><span class="p">,</span> <span class="n">UserId</span> <span class="o">=</span> <span class="n">user_id</span><span class="p">,</span> <span class="n">Update</span> <span class="o">=</span> <span class="n">update_ops</span><span class="p">,</span> <span class="n">PermissionRead</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">PermissionWrite</span> <span class="o">=</span> <span class="mi">1</span><span class="p">}</span>
  <span class="p">{</span><span class="n">Bucket</span> <span class="o">=</span> <span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="n">Collection</span> <span class="o">=</span> <span class="s2">&quot;c&quot;</span><span class="p">,</span> <span class="n">Record</span> <span class="o">=</span> <span class="s2">&quot;r3&quot;</span><span class="p">,</span> <span class="n">UserId</span> <span class="o">=</span> <span class="n">user_id</span><span class="p">,</span> <span class="n">Update</span> <span class="o">=</span> <span class="n">update_ops</span><span class="p">,</span> <span class="n">Version</span><span class="o">=</span><span class="s2">&quot;*&quot;</span><span class="p">,</span> <span class="n">PermissionRead</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">PermissionWrite</span> <span class="o">=</span> <span class="mi">1</span><span class="p">}</span>
<span class="p">}</span>
<span class="n">nk</span><span class="p">.</span><span class="n">storage_update</span><span class="p">(</span><span class="n">record_keys</span><span class="p">)</span>
</pre></div>


<hr />
<p><strong>storage_write (new_records)</strong></p>
<p>Write one or more records by their bucket/collection/keyname and optional user.</p>
<p><em>Parameters</em></p>
<table>
<thead>
<tr>
<th>Param</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>new_records</td>
<td>table</td>
<td>A table array of new records to write.</td>
</tr>
</tbody>
</table>
<p><em>Example</em></p>
<div class="codehilite"><pre><span></span><span class="kd">local</span> <span class="n">user_id</span> <span class="o">=</span> <span class="s2">&quot;4ec4f126-3f9d-11e7-84ef-b7c182b36521&quot;</span> <span class="c1">-- some user ID.</span>
<span class="kd">local</span> <span class="n">new_records</span> <span class="o">=</span> <span class="p">{</span>
  <span class="p">{</span><span class="n">Bucket</span> <span class="o">=</span> <span class="s2">&quot;mygame&quot;</span><span class="p">,</span> <span class="n">Collection</span> <span class="o">=</span> <span class="s2">&quot;save&quot;</span><span class="p">,</span> <span class="n">Record</span> <span class="o">=</span> <span class="s2">&quot;save1&quot;</span><span class="p">,</span> <span class="n">UserId</span> <span class="o">=</span> <span class="n">user_id</span><span class="p">,</span> <span class="n">Value</span> <span class="o">=</span> <span class="p">{}},</span>
  <span class="p">{</span><span class="n">Bucket</span> <span class="o">=</span> <span class="s2">&quot;mygame&quot;</span><span class="p">,</span> <span class="n">Collection</span> <span class="o">=</span> <span class="s2">&quot;save&quot;</span><span class="p">,</span> <span class="n">Record</span> <span class="o">=</span> <span class="s2">&quot;save2&quot;</span><span class="p">,</span> <span class="n">UserId</span> <span class="o">=</span> <span class="n">user_id</span><span class="p">,</span> <span class="n">Value</span> <span class="o">=</span> <span class="p">{}},</span>
  <span class="p">{</span><span class="n">Bucket</span> <span class="o">=</span> <span class="s2">&quot;mygame&quot;</span><span class="p">,</span> <span class="n">Collection</span> <span class="o">=</span> <span class="s2">&quot;save&quot;</span><span class="p">,</span> <span class="n">Record</span> <span class="o">=</span> <span class="s2">&quot;save3&quot;</span><span class="p">,</span> <span class="n">UserId</span> <span class="o">=</span> <span class="n">user_id</span><span class="p">,</span> <span class="n">Value</span> <span class="o">=</span> <span class="p">{},</span> <span class="n">PermissionRead</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">PermissionWrite</span> <span class="o">=</span> <span class="mi">1</span><span class="p">},</span>
  <span class="p">{</span><span class="n">Bucket</span> <span class="o">=</span> <span class="s2">&quot;mygame&quot;</span><span class="p">,</span> <span class="n">Collection</span> <span class="o">=</span> <span class="s2">&quot;save&quot;</span><span class="p">,</span> <span class="n">Record</span> <span class="o">=</span> <span class="s2">&quot;save3&quot;</span><span class="p">,</span> <span class="n">UserId</span> <span class="o">=</span> <span class="n">user_id</span><span class="p">,</span> <span class="n">Value</span> <span class="o">=</span> <span class="p">{},</span> <span class="n">Version</span><span class="o">=</span><span class="s2">&quot;*&quot;</span><span class="p">,</span> <span class="n">PermissionRead</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">PermissionWrite</span> <span class="o">=</span> <span class="mi">1</span><span class="p">}</span>
<span class="p">}</span>
<span class="n">nk</span><span class="p">.</span><span class="n">storage_write</span><span class="p">(</span><span class="n">new_records</span><span class="p">)</span>
</pre></div>


<h3 id="users">users<a class="headerlink" href="#users" title="Permanent link">&para;</a></h3>
<p><strong>users_ban (user_ids)</strong></p>
<p>Ban one or more users from the server.</p>
<p><em>Parameters</em></p>
<table>
<thead>
<tr>
<th>Param</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>user_ids</td>
<td>table</td>
<td>A table array of user IDs to be banned.</td>
</tr>
</tbody>
</table>
<p><em>Example</em></p>
<div class="codehilite"><pre><span></span><span class="kd">local</span> <span class="n">user_ids</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;4c2ae592-b2a7-445e-98ec-697694478b1c&quot;</span><span class="p">}</span>
<span class="kd">local</span> <span class="n">status</span><span class="p">,</span> <span class="n">result</span> <span class="o">=</span> <span class="nb">pcall</span><span class="p">(</span><span class="n">nk</span><span class="p">.</span><span class="n">users_ban</span><span class="p">,</span> <span class="n">user_ids</span><span class="p">)</span>
<span class="kr">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">status</span><span class="p">)</span> <span class="kr">then</span>
  <span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<span class="kr">end</span>
</pre></div>


<hr />
<p><strong>users_fetch_handle (user_handles)</strong></p>
<p>Fetch a set of users by handle.</p>
<p><em>Parameters</em></p>
<table>
<thead>
<tr>
<th>Param</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>user_handles</td>
<td>table</td>
<td>A table array of user handles to fetch.</td>
</tr>
</tbody>
</table>
<p><em>Returns</em></p>
<p>A table array of the user result set.</p>
<p><em>Example</em></p>
<div class="codehilite"><pre><span></span><span class="kd">local</span> <span class="n">user_handles</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;b7865e7e&quot;</span><span class="p">,</span> <span class="s2">&quot;c048ba7a&quot;</span><span class="p">}</span>
<span class="kd">local</span> <span class="n">users</span> <span class="o">=</span> <span class="n">nk</span><span class="p">.</span><span class="n">users_fetch_handle</span><span class="p">(</span><span class="n">user_handles</span><span class="p">)</span>
<span class="kr">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">u</span> <span class="kr">in</span> <span class="nb">ipairs</span><span class="p">(</span><span class="n">users</span><span class="p">)</span>
<span class="kr">do</span>
  <span class="kd">local</span> <span class="n">message</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;id: %q, fullname: %q&quot;</span><span class="p">):</span><span class="n">format</span><span class="p">(</span><span class="n">u</span><span class="p">.</span><span class="n">Id</span><span class="p">,</span> <span class="n">u</span><span class="p">.</span><span class="n">Fullname</span><span class="p">)</span>
  <span class="nb">print</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
<span class="kr">end</span>
</pre></div>


<hr />
<p><strong>users_fetch_id (user_ids)</strong></p>
<p>Fetch one or more users by ID.</p>
<p><em>Parameters</em></p>
<table>
<thead>
<tr>
<th>Param</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>user_ids</td>
<td>table</td>
<td>A table array of user IDs to fetch.</td>
</tr>
</tbody>
</table>
<p><em>Returns</em></p>
<p>A table array of the user result set.</p>
<p><em>Example</em></p>
<div class="codehilite"><pre><span></span><span class="kd">local</span> <span class="n">user_ids</span> <span class="o">=</span> <span class="p">{</span>
  <span class="s2">&quot;3ea5608a-43c3-11e7-90f9-7b9397165f34&quot;</span><span class="p">,</span>
  <span class="s2">&quot;447524be-43c3-11e7-af09-3f7172f05936&quot;</span>
<span class="p">}</span>
<span class="kd">local</span> <span class="n">users</span> <span class="o">=</span> <span class="n">nk</span><span class="p">.</span><span class="n">users_fetch_id</span><span class="p">(</span><span class="n">user_ids</span><span class="p">)</span>
<span class="kr">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">u</span> <span class="kr">in</span> <span class="nb">ipairs</span><span class="p">(</span><span class="n">users</span><span class="p">)</span>
<span class="kr">do</span>
  <span class="kd">local</span> <span class="n">message</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;handle: %q, fullname: %q&quot;</span><span class="p">):</span><span class="n">format</span><span class="p">(</span><span class="n">u</span><span class="p">.</span><span class="n">Handle</span><span class="p">,</span> <span class="n">u</span><span class="p">.</span><span class="n">Fullname</span><span class="p">)</span>
  <span class="nb">print</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
<span class="kr">end</span>
</pre></div>


<hr />
<p><strong>users_update (user_updates)</strong></p>
<p>Update one or more users.</p>
<p><em>Parameters</em></p>
<table>
<thead>
<tr>
<th>Param</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>user_updates</td>
<td>table</td>
<td>The table array of users to update.</td>
</tr>
</tbody>
</table>
<p><em>Example</em></p>
<div class="codehilite"><pre><span></span><span class="kd">local</span> <span class="n">user_id</span> <span class="o">=</span> <span class="s2">&quot;4ec4f126-3f9d-11e7-84ef-b7c182b36521&quot;</span> <span class="c1">-- some user ID.</span>
<span class="kd">local</span> <span class="n">user_updates</span> <span class="o">=</span> <span class="p">{</span>
  <span class="p">{</span> <span class="n">UserId</span> <span class="o">=</span> <span class="n">user_id</span><span class="p">,</span> <span class="n">Metadata</span> <span class="o">=</span> <span class="p">{}</span> <span class="p">}</span>
<span class="p">}</span>
<span class="kd">local</span> <span class="n">status</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="nb">pcall</span><span class="p">(</span><span class="n">nk</span><span class="p">.</span><span class="n">users_update</span><span class="p">,</span> <span class="n">user_updates</span><span class="p">)</span>
<span class="kr">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">status</span><span class="p">)</span> <span class="kr">then</span>
  <span class="nb">print</span><span class="p">((</span><span class="s2">&quot;User update error: %q&quot;</span><span class="p">):</span><span class="n">format</span><span class="p">(</span><span class="n">err</span><span class="p">))</span>
<span class="kr">end</span>
</pre></div>


<h3 id="uuid">uuid<a class="headerlink" href="#uuid" title="Permanent link">&para;</a></h3>
<p><strong>uuid_v4 ()</strong></p>
<p>Generate a version 4 UUID in the standard 36-character string representation.</p>
<p><em>Returns</em></p>
<p>The generated version 4 UUID identifier.</p>
<p><em>Example</em></p>
<div class="codehilite"><pre><span></span><span class="kd">local</span> <span class="n">uuid</span> <span class="o">=</span> <span class="n">nk</span><span class="p">.</span><span class="n">uuid_v4</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">uuid</span><span class="p">)</span>
</pre></div>


<hr />
<p><strong>uuid_bytes_to_string (uuid_bytes)</strong></p>
<p>Convert the 16-byte raw representation of a UUID into the equivalent 36-character standard UUID string representation. Will raise an error if the input is not valid and cannot be converted.</p>
<p><em>Parameters</em></p>
<table>
<thead>
<tr>
<th>Param</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>uuid_bytes</td>
<td>string</td>
<td>The UUID bytes to convert.</td>
</tr>
</tbody>
</table>
<p><em>Returns</em></p>
<p>A string containing the equivalent 36-character standard representation of the UUID.</p>
<p><em>Example</em></p>
<div class="codehilite"><pre><span></span><span class="kd">local</span> <span class="n">uuid_bytes</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\78\196\241\38\63\157\17\231\132\239\183\193\130\179\101\33</span><span class="s2">&quot;</span> <span class="c1">-- some uuid bytes.</span>
<span class="kd">local</span> <span class="n">uuid_string</span> <span class="o">=</span> <span class="n">nk</span><span class="p">.</span><span class="n">uuid_bytes_to_string</span><span class="p">(</span><span class="n">uuid_bytes</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">uuid_string</span><span class="p">)</span>
</pre></div>


<hr />
<p><strong>uuid_string_to_bytes (uuid_string)</strong></p>
<p>Convert the 36-character string representation of a UUID into the equivalent 16-byte raw UUID representation. Will raise an error if the input is not valid and cannot be converted.</p>
<p><em>Parameters</em></p>
<table>
<thead>
<tr>
<th>Param</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>uuid_string</td>
<td>string</td>
<td>The UUID string to convert.</td>
</tr>
</tbody>
</table>
<p><em>Returns</em></p>
<p>A string containing the equivalent 16-byte representation of the UUID.</p>
<p><em>Example</em></p>
<div class="codehilite"><pre><span></span><span class="kd">local</span> <span class="n">uuid_string</span> <span class="o">=</span> <span class="s2">&quot;4ec4f126-3f9d-11e7-84ef-b7c182b36521&quot;</span> <span class="c1">-- some uuid string.</span>
<span class="kd">local</span> <span class="n">uuid_bytes</span> <span class="o">=</span> <span class="n">nk</span><span class="p">.</span><span class="n">uuid_string_to_bytes</span><span class="p">(</span><span class="n">uuid_string</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">uuid_bytes</span><span class="p">)</span>
</pre></div>


<h3 id="sql">sql<a class="headerlink" href="#sql" title="Permanent link">&para;</a></h3>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>These functions allow your Lua scripts to run arbitrary SQL staments beyond the ones built into Nakama itself. It is your responsibility to manage the performance of these queries.</p>
</div>
<p><strong>sql_exec (query, parameters)</strong></p>
<p>Execute an arbitrary SQL query and return the number of rows affected. Typically an <code>INSERT</code>, <code>DELETE</code>, or <code>UPDATE</code> statement with no return columns.</p>
<table>
<thead>
<tr>
<th>Param</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>query</td>
<td>string</td>
<td>A SQL query to execute.</td>
</tr>
<tr>
<td>parameters</td>
<td>table</td>
<td>Arbitrary parameters to pass to placeholders in the query.</td>
</tr>
</tbody>
</table>
<p><em>Returns</em></p>
<p>A single number indicating the number of rows affected by the query.</p>
<p><em>Example</em></p>
<div class="codehilite"><pre><span></span><span class="c1">-- This example query deletes all expired leaderboard records.</span>
<span class="kd">local</span> <span class="n">query</span> <span class="o">=</span> <span class="s">[[DELETE FROM leaderboard_record</span>
<span class="s">                WHERE expires_at &gt; 0 AND expires_at &lt;= $1]]</span>
<span class="kd">local</span> <span class="n">parameters</span> <span class="o">=</span> <span class="p">{</span><span class="nb">os.time</span><span class="p">()</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">}</span>
<span class="kd">local</span> <span class="n">affected_rows_count</span> <span class="o">=</span> <span class="n">nk</span><span class="p">.</span><span class="n">sql_exec</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">parameters</span><span class="p">)</span>
</pre></div>


<hr />
<p><strong>sql_query (query, parameters)</strong></p>
<p>Execute an arbitrary SQL query that is expected to return row data. Typically a <code>SELECT</code> statement.</p>
<table>
<thead>
<tr>
<th>Param</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>query</td>
<td>string</td>
<td>A SQL query to execute.</td>
</tr>
<tr>
<td>parameters</td>
<td>table</td>
<td>Arbitrary parameters to pass to placeholders in the query.</td>
</tr>
</tbody>
</table>
<p><em>Returns</em></p>
<p>A Lua table containing the result rows in the format:</p>
<div class="codehilite"><pre><span></span><span class="p">{</span>
  <span class="p">{</span><span class="n">column1</span> <span class="o">=</span> <span class="s2">&quot;value1&quot;</span><span class="p">,</span> <span class="n">column2</span> <span class="o">=</span> <span class="s2">&quot;value2&quot;</span><span class="p">,</span> <span class="p">...},</span> <span class="c1">-- Row 1.</span>
  <span class="p">{</span><span class="n">column1</span> <span class="o">=</span> <span class="s2">&quot;value1&quot;</span><span class="p">,</span> <span class="n">column2</span> <span class="o">=</span> <span class="s2">&quot;value2&quot;</span><span class="p">,</span> <span class="p">...},</span> <span class="c1">-- Row 2.</span>
  <span class="p">...</span>
<span class="p">}</span>
</pre></div>


<p><em>Example</em></p>
<div class="codehilite"><pre><span></span><span class="c1">-- Example fetching a list of handles for the 100 most recetly signed up users.</span>
<span class="kd">local</span> <span class="n">query</span> <span class="o">=</span> <span class="s">[[SELECT handle, updated_at</span>
<span class="s">                FROM users</span>
<span class="s">                ORDER BY created_at DESC</span>
<span class="s">                LIMIT 100]]</span>
<span class="kd">local</span> <span class="n">parameters</span> <span class="o">=</span> <span class="p">{}</span>
<span class="kd">local</span> <span class="n">rows</span> <span class="o">=</span> <span class="n">nk</span><span class="p">.</span><span class="n">sql_query</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">parameters</span><span class="p">)</span>

<span class="c1">-- Example of processing the rows.</span>
<span class="n">nk</span><span class="p">.</span><span class="n">logger_info</span><span class="p">(</span><span class="s2">&quot;Selected &quot;</span> <span class="o">..</span> <span class="o">#</span><span class="n">rows</span> <span class="o">..</span> <span class="s2">&quot; rows.&quot;</span><span class="p">)</span>
<span class="kr">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">row</span> <span class="kr">in</span> <span class="nb">ipairs</span><span class="p">(</span><span class="n">rows</span><span class="p">)</span> <span class="kr">do</span>
  <span class="n">nk</span><span class="p">.</span><span class="n">logger_info</span><span class="p">(</span><span class="s2">&quot;User handle &quot;</span> <span class="o">..</span> <span class="n">row</span><span class="p">.</span><span class="n">handle</span> <span class="o">..</span> <span class="s2">&quot; created at &quot;</span> <span class="o">..</span> <span class="n">row</span><span class="p">.</span><span class="n">created_at</span><span class="p">)</span>
<span class="kr">end</span>
</pre></div>
                
                  
                
              
              
                
              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../runtime-code-basics/" title="Basics" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Basics
              </span>
            </div>
          </a>
        
        
          <a href="../benchmarks/" title="Benchmarks" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Benchmarks
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; 2017 Heroic Labs
          </div>
        
        powered by
        <a href="http://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
        
  <div class="md-footer-social">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    
      <a href="https://heroiclabs.com" class="md-footer-social__link fa fa-globe"></a>
    
      <a href="https://github.com/heroiclabs" class="md-footer-social__link fa fa-github"></a>
    
      <a href="https://twitter.com/heroicdev" class="md-footer-social__link fa fa-twitter"></a>
    
      <a href="https://www.linkedin.com/company/heroic-labs" class="md-footer-social__link fa fa-linkedin"></a>
    
  </div>

      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/application.6cdc17f0.js"></script>
      
      <script>app.initialize({version:"0.17.2",url:{base:".."}})</script>
      
        <script src="../javascripts/main.js"></script>
      
    
    
      
    
  </body>
</html>